import{B as xa,D as Ca,E as gi,c as Ia,e as Ta,f as Ea,l as Aa,m as Sa,u as ye,v as Ra,w as Rt,x as ba,y as Pa,z as Va}from"./chunk-GICCHK2Q.js";import{d as C}from"./chunk-XUATYPQO.js";var Da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Na={};var Mt,pi;(function(){var n;function t(v,m){function p(){}p.prototype=m.prototype,v.D=m.prototype,v.prototype=new p,v.prototype.constructor=v,v.C=function(y,w,T){for(var g=Array(arguments.length-2),Nt=2;Nt<arguments.length;Nt++)g[Nt-2]=arguments[Nt];return m.prototype[w].apply(y,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,m,p){p||(p=0);var y=Array(16);if(typeof m=="string")for(var w=0;16>w;++w)y[w]=m.charCodeAt(p++)|m.charCodeAt(p++)<<8|m.charCodeAt(p++)<<16|m.charCodeAt(p++)<<24;else for(w=0;16>w;++w)y[w]=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24;m=v.g[0],p=v.g[1],w=v.g[2];var T=v.g[3],g=m+(T^p&(w^T))+y[0]+3614090360&4294967295;m=p+(g<<7&4294967295|g>>>25),g=T+(w^m&(p^w))+y[1]+3905402710&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(p^T&(m^p))+y[2]+606105819&4294967295,w=T+(g<<17&4294967295|g>>>15),g=p+(m^w&(T^m))+y[3]+3250441966&4294967295,p=w+(g<<22&4294967295|g>>>10),g=m+(T^p&(w^T))+y[4]+4118548399&4294967295,m=p+(g<<7&4294967295|g>>>25),g=T+(w^m&(p^w))+y[5]+1200080426&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(p^T&(m^p))+y[6]+2821735955&4294967295,w=T+(g<<17&4294967295|g>>>15),g=p+(m^w&(T^m))+y[7]+4249261313&4294967295,p=w+(g<<22&4294967295|g>>>10),g=m+(T^p&(w^T))+y[8]+1770035416&4294967295,m=p+(g<<7&4294967295|g>>>25),g=T+(w^m&(p^w))+y[9]+2336552879&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(p^T&(m^p))+y[10]+4294925233&4294967295,w=T+(g<<17&4294967295|g>>>15),g=p+(m^w&(T^m))+y[11]+2304563134&4294967295,p=w+(g<<22&4294967295|g>>>10),g=m+(T^p&(w^T))+y[12]+1804603682&4294967295,m=p+(g<<7&4294967295|g>>>25),g=T+(w^m&(p^w))+y[13]+4254626195&4294967295,T=m+(g<<12&4294967295|g>>>20),g=w+(p^T&(m^p))+y[14]+2792965006&4294967295,w=T+(g<<17&4294967295|g>>>15),g=p+(m^w&(T^m))+y[15]+1236535329&4294967295,p=w+(g<<22&4294967295|g>>>10),g=m+(w^T&(p^w))+y[1]+4129170786&4294967295,m=p+(g<<5&4294967295|g>>>27),g=T+(p^w&(m^p))+y[6]+3225465664&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^p&(T^m))+y[11]+643717713&4294967295,w=T+(g<<14&4294967295|g>>>18),g=p+(T^m&(w^T))+y[0]+3921069994&4294967295,p=w+(g<<20&4294967295|g>>>12),g=m+(w^T&(p^w))+y[5]+3593408605&4294967295,m=p+(g<<5&4294967295|g>>>27),g=T+(p^w&(m^p))+y[10]+38016083&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^p&(T^m))+y[15]+3634488961&4294967295,w=T+(g<<14&4294967295|g>>>18),g=p+(T^m&(w^T))+y[4]+3889429448&4294967295,p=w+(g<<20&4294967295|g>>>12),g=m+(w^T&(p^w))+y[9]+568446438&4294967295,m=p+(g<<5&4294967295|g>>>27),g=T+(p^w&(m^p))+y[14]+3275163606&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^p&(T^m))+y[3]+4107603335&4294967295,w=T+(g<<14&4294967295|g>>>18),g=p+(T^m&(w^T))+y[8]+1163531501&4294967295,p=w+(g<<20&4294967295|g>>>12),g=m+(w^T&(p^w))+y[13]+2850285829&4294967295,m=p+(g<<5&4294967295|g>>>27),g=T+(p^w&(m^p))+y[2]+4243563512&4294967295,T=m+(g<<9&4294967295|g>>>23),g=w+(m^p&(T^m))+y[7]+1735328473&4294967295,w=T+(g<<14&4294967295|g>>>18),g=p+(T^m&(w^T))+y[12]+2368359562&4294967295,p=w+(g<<20&4294967295|g>>>12),g=m+(p^w^T)+y[5]+4294588738&4294967295,m=p+(g<<4&4294967295|g>>>28),g=T+(m^p^w)+y[8]+2272392833&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^p)+y[11]+1839030562&4294967295,w=T+(g<<16&4294967295|g>>>16),g=p+(w^T^m)+y[14]+4259657740&4294967295,p=w+(g<<23&4294967295|g>>>9),g=m+(p^w^T)+y[1]+2763975236&4294967295,m=p+(g<<4&4294967295|g>>>28),g=T+(m^p^w)+y[4]+1272893353&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^p)+y[7]+4139469664&4294967295,w=T+(g<<16&4294967295|g>>>16),g=p+(w^T^m)+y[10]+3200236656&4294967295,p=w+(g<<23&4294967295|g>>>9),g=m+(p^w^T)+y[13]+681279174&4294967295,m=p+(g<<4&4294967295|g>>>28),g=T+(m^p^w)+y[0]+3936430074&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^p)+y[3]+3572445317&4294967295,w=T+(g<<16&4294967295|g>>>16),g=p+(w^T^m)+y[6]+76029189&4294967295,p=w+(g<<23&4294967295|g>>>9),g=m+(p^w^T)+y[9]+3654602809&4294967295,m=p+(g<<4&4294967295|g>>>28),g=T+(m^p^w)+y[12]+3873151461&4294967295,T=m+(g<<11&4294967295|g>>>21),g=w+(T^m^p)+y[15]+530742520&4294967295,w=T+(g<<16&4294967295|g>>>16),g=p+(w^T^m)+y[2]+3299628645&4294967295,p=w+(g<<23&4294967295|g>>>9),g=m+(w^(p|~T))+y[0]+4096336452&4294967295,m=p+(g<<6&4294967295|g>>>26),g=T+(p^(m|~w))+y[7]+1126891415&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~p))+y[14]+2878612391&4294967295,w=T+(g<<15&4294967295|g>>>17),g=p+(T^(w|~m))+y[5]+4237533241&4294967295,p=w+(g<<21&4294967295|g>>>11),g=m+(w^(p|~T))+y[12]+1700485571&4294967295,m=p+(g<<6&4294967295|g>>>26),g=T+(p^(m|~w))+y[3]+2399980690&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~p))+y[10]+4293915773&4294967295,w=T+(g<<15&4294967295|g>>>17),g=p+(T^(w|~m))+y[1]+2240044497&4294967295,p=w+(g<<21&4294967295|g>>>11),g=m+(w^(p|~T))+y[8]+1873313359&4294967295,m=p+(g<<6&4294967295|g>>>26),g=T+(p^(m|~w))+y[15]+4264355552&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~p))+y[6]+2734768916&4294967295,w=T+(g<<15&4294967295|g>>>17),g=p+(T^(w|~m))+y[13]+1309151649&4294967295,p=w+(g<<21&4294967295|g>>>11),g=m+(w^(p|~T))+y[4]+4149444226&4294967295,m=p+(g<<6&4294967295|g>>>26),g=T+(p^(m|~w))+y[11]+3174756917&4294967295,T=m+(g<<10&4294967295|g>>>22),g=w+(m^(T|~p))+y[2]+718787259&4294967295,w=T+(g<<15&4294967295|g>>>17),g=p+(T^(w|~m))+y[9]+3951481745&4294967295,v.g[0]=v.g[0]+m&4294967295,v.g[1]=v.g[1]+(w+(g<<21&4294967295|g>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+T&4294967295}r.prototype.u=function(v,m){m===void 0&&(m=v.length);for(var p=m-this.blockSize,y=this.B,w=this.h,T=0;T<m;){if(w==0)for(;T<=p;)s(this,v,T),T+=this.blockSize;if(typeof v=="string"){for(;T<m;)if(y[w++]=v.charCodeAt(T++),w==this.blockSize){s(this,y),w=0;break}}else for(;T<m;)if(y[w++]=v[T++],w==this.blockSize){s(this,y),w=0;break}}this.h=w,this.o+=m},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var m=1;m<v.length-8;++m)v[m]=0;var p=8*this.o;for(m=v.length-8;m<v.length;++m)v[m]=p&255,p/=256;for(this.u(v),v=Array(16),m=p=0;4>m;++m)for(var y=0;32>y;y+=8)v[p++]=this.g[m]>>>y&255;return v};function o(v,m){var p=l;return Object.prototype.hasOwnProperty.call(p,v)?p[v]:p[v]=m(v)}function u(v,m){this.h=m;for(var p=[],y=!0,w=v.length-1;0<=w;w--){var T=v[w]|0;y&&T==m||(p[w]=T,y=!1)}this.g=p}var l={};function d(v){return-128<=v&&128>v?o(v,function(m){return new u([m|0],0>m?-1:0)}):new u([v|0],0>v?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return E;if(0>v)return x(f(-v));for(var m=[],p=1,y=0;v>=p;y++)m[y]=v/p|0,p*=4294967296;return new u(m,0)}function _(v,m){if(v.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(v.charAt(0)=="-")return x(_(v.substring(1),m));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var p=f(Math.pow(m,8)),y=E,w=0;w<v.length;w+=8){var T=Math.min(8,v.length-w),g=parseInt(v.substring(w,w+T),m);8>T?(T=f(Math.pow(m,T)),y=y.j(T).add(f(g))):(y=y.j(p),y=y.add(f(g)))}return y}var E=d(0),S=d(1),P=d(16777216);n=u.prototype,n.m=function(){if(F(this))return-x(this).m();for(var v=0,m=1,p=0;p<this.g.length;p++){var y=this.i(p);v+=(0<=y?y:4294967296+y)*m,m*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(N(this))return"0";if(F(this))return"-"+x(this).toString(v);for(var m=f(Math.pow(v,6)),p=this,y="";;){var w=Y(p,m).g;p=z(p,w.j(m));var T=((0<p.g.length?p.g[0]:p.h)>>>0).toString(v);if(p=w,N(p))return T+y;for(;6>T.length;)T="0"+T;y=T+y}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function N(v){if(v.h!=0)return!1;for(var m=0;m<v.g.length;m++)if(v.g[m]!=0)return!1;return!0}function F(v){return v.h==-1}n.l=function(v){return v=z(this,v),F(v)?-1:N(v)?0:1};function x(v){for(var m=v.g.length,p=[],y=0;y<m;y++)p[y]=~v.g[y];return new u(p,~v.h).add(S)}n.abs=function(){return F(this)?x(this):this},n.add=function(v){for(var m=Math.max(this.g.length,v.g.length),p=[],y=0,w=0;w<=m;w++){var T=y+(this.i(w)&65535)+(v.i(w)&65535),g=(T>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);y=g>>>16,T&=65535,g&=65535,p[w]=g<<16|T}return new u(p,p[p.length-1]&-2147483648?-1:0)};function z(v,m){return v.add(x(m))}n.j=function(v){if(N(this)||N(v))return E;if(F(this))return F(v)?x(this).j(x(v)):x(x(this).j(v));if(F(v))return x(this.j(x(v)));if(0>this.l(P)&&0>v.l(P))return f(this.m()*v.m());for(var m=this.g.length+v.g.length,p=[],y=0;y<2*m;y++)p[y]=0;for(y=0;y<this.g.length;y++)for(var w=0;w<v.g.length;w++){var T=this.i(y)>>>16,g=this.i(y)&65535,Nt=v.i(w)>>>16,je=v.i(w)&65535;p[2*y+2*w]+=g*je,j(p,2*y+2*w),p[2*y+2*w+1]+=T*je,j(p,2*y+2*w+1),p[2*y+2*w+1]+=g*Nt,j(p,2*y+2*w+1),p[2*y+2*w+2]+=T*Nt,j(p,2*y+2*w+2)}for(y=0;y<m;y++)p[y]=p[2*y+1]<<16|p[2*y];for(y=m;y<2*m;y++)p[y]=0;return new u(p,0)};function j(v,m){for(;(v[m]&65535)!=v[m];)v[m+1]+=v[m]>>>16,v[m]&=65535,m++}function $(v,m){this.g=v,this.h=m}function Y(v,m){if(N(m))throw Error("division by zero");if(N(v))return new $(E,E);if(F(v))return m=Y(x(v),m),new $(x(m.g),x(m.h));if(F(m))return m=Y(v,x(m)),new $(x(m.g),m.h);if(30<v.g.length){if(F(v)||F(m))throw Error("slowDivide_ only works with positive integers.");for(var p=S,y=m;0>=y.l(v);)p=vt(p),y=vt(y);var w=H(p,1),T=H(y,1);for(y=H(y,2),p=H(p,2);!N(y);){var g=T.add(y);0>=g.l(v)&&(w=w.add(p),T=g),y=H(y,1),p=H(p,1)}return m=z(v,w.j(m)),new $(w,m)}for(w=E;0<=v.l(m);){for(p=Math.max(1,Math.floor(v.m()/m.m())),y=Math.ceil(Math.log(p)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),T=f(p),g=T.j(m);F(g)||0<g.l(v);)p-=y,T=f(p),g=T.j(m);N(T)&&(T=S),w=w.add(T),v=z(v,g)}return new $(w,v)}n.A=function(v){return Y(this,v).h},n.and=function(v){for(var m=Math.max(this.g.length,v.g.length),p=[],y=0;y<m;y++)p[y]=this.i(y)&v.i(y);return new u(p,this.h&v.h)},n.or=function(v){for(var m=Math.max(this.g.length,v.g.length),p=[],y=0;y<m;y++)p[y]=this.i(y)|v.i(y);return new u(p,this.h|v.h)},n.xor=function(v){for(var m=Math.max(this.g.length,v.g.length),p=[],y=0;y<m;y++)p[y]=this.i(y)^v.i(y);return new u(p,this.h^v.h)};function vt(v){for(var m=v.g.length+1,p=[],y=0;y<m;y++)p[y]=v.i(y)<<1|v.i(y-1)>>>31;return new u(p,v.h)}function H(v,m){var p=m>>5;m%=32;for(var y=v.g.length-p,w=[],T=0;T<y;T++)w[T]=0<m?v.i(T+p)>>>m|v.i(T+p+1)<<32-m:v.i(T+p);return new u(w,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,pi=Na.Md5=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=f,u.fromString=_,Mt=Na.Integer=u}).apply(typeof Da<"u"?Da:typeof self<"u"?self:typeof window<"u"?window:{});var Wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ot={};var _i,Jc,we,yi,ln,Hn,wi,vi,Ii;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,a,c){return i==Array.prototype||i==Object.prototype||(i[a]=c.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Wn=="object"&&Wn];for(var a=0;a<i.length;++a){var c=i[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}var r=e(this);function s(i,a){if(a)t:{var c=r;i=i.split(".");for(var h=0;h<i.length-1;h++){var I=i[h];if(!(I in c))break t;c=c[I]}i=i[i.length-1],h=c[i],a=a(h),a!=h&&a!=null&&t(c,i,{configurable:!0,writable:!0,value:a})}}function o(i,a){i instanceof String&&(i+="");var c=0,h=!1,I={next:function(){if(!h&&c<i.length){var A=c++;return{value:a(A,i[A]),done:!1}}return h=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}s("Array.prototype.values",function(i){return i||function(){return o(this,function(a,c){return c})}});var u=u||{},l=this||self;function d(i){var a=typeof i;return a=a!="object"?a:i?Array.isArray(i)?"array":a:"null",a=="array"||a=="object"&&typeof i.length=="number"}function f(i){var a=typeof i;return a=="object"&&i!=null||a=="function"}function _(i,a,c){return i.call.apply(i.bind,arguments)}function E(i,a,c){if(!i)throw Error();if(2<arguments.length){var h=Array.prototype.slice.call(arguments,2);return function(){var I=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(I,h),i.apply(a,I)}}return function(){return i.apply(a,arguments)}}function S(i,a,c){return S=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?_:E,S.apply(null,arguments)}function P(i,a){var c=Array.prototype.slice.call(arguments,1);return function(){var h=c.slice();return h.push.apply(h,arguments),i.apply(this,h)}}function N(i,a){function c(){}c.prototype=a.prototype,i.aa=a.prototype,i.prototype=new c,i.prototype.constructor=i,i.Qb=function(h,I,A){for(var V=Array(arguments.length-2),W=2;W<arguments.length;W++)V[W-2]=arguments[W];return a.prototype[I].apply(h,V)}}function F(i){let a=i.length;if(0<a){let c=Array(a);for(let h=0;h<a;h++)c[h]=i[h];return c}return[]}function x(i,a){for(let c=1;c<arguments.length;c++){let h=arguments[c];if(d(h)){let I=i.length||0,A=h.length||0;i.length=I+A;for(let V=0;V<A;V++)i[I+V]=h[V]}else i.push(h)}}class z{constructor(a,c){this.i=a,this.j=c,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function j(i){return/^[\s\xa0]*$/.test(i)}function $(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function Y(i){return Y[" "](i),i}Y[" "]=function(){};var vt=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function H(i,a,c){for(let h in i)a.call(c,i[h],h,i)}function v(i,a){for(let c in i)a.call(void 0,i[c],c,i)}function m(i){let a={};for(let c in i)a[c]=i[c];return a}let p="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y(i,a){let c,h;for(let I=1;I<arguments.length;I++){h=arguments[I];for(c in h)i[c]=h[c];for(let A=0;A<p.length;A++)c=p[A],Object.prototype.hasOwnProperty.call(h,c)&&(i[c]=h[c])}}function w(i){var a=1;i=i.split(":");let c=[];for(;0<a&&i.length;)c.push(i.shift()),a--;return i.length&&c.push(i.join(":")),c}function T(i){l.setTimeout(()=>{throw i},0)}function g(){var i=jr;let a=null;return i.g&&(a=i.g,i.g=i.g.next,i.g||(i.h=null),a.next=null),a}class Nt{constructor(){this.h=this.g=null}add(a,c){let h=je.get();h.set(a,c),this.h?this.h.next=h:this.g=h,this.h=h}}var je=new z(()=>new pc,i=>i.reset());class pc{constructor(){this.next=this.g=this.h=null}set(a,c){this.h=a,this.g=c,this.next=null}reset(){this.next=this.g=this.h=null}}let Ke,$e=!1,jr=new Nt,vo=()=>{let i=l.Promise.resolve(void 0);Ke=()=>{i.then(_c)}};var _c=()=>{for(var i;i=g();){try{i.h.call(i.g)}catch(c){T(c)}var a=je;a.j(i),100>a.h&&(a.h++,i.next=a.g,a.g=i)}$e=!1};function jt(){this.s=this.s,this.C=this.C}jt.prototype.s=!1,jt.prototype.ma=function(){this.s||(this.s=!0,this.N())},jt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ct(i,a){this.type=i,this.g=this.target=a,this.defaultPrevented=!1}ct.prototype.h=function(){this.defaultPrevented=!0};var yc=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,a=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let c=()=>{};l.addEventListener("test",c,a),l.removeEventListener("test",c,a)}catch{}return i}();function Qe(i,a){if(ct.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var c=this.type=i.type,h=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=a,a=i.relatedTarget){if(vt){t:{try{Y(a.nodeName);var I=!0;break t}catch{}I=!1}I||(a=null)}}else c=="mouseover"?a=i.fromElement:c=="mouseout"&&(a=i.toElement);this.relatedTarget=a,h?(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:wc[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&Qe.aa.h.call(this)}}N(Qe,ct);var wc={2:"touch",3:"pen",4:"mouse"};Qe.prototype.h=function(){Qe.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var We="closure_listenable_"+(1e6*Math.random()|0),vc=0;function Ic(i,a,c,h,I){this.listener=i,this.proxy=null,this.src=a,this.type=c,this.capture=!!h,this.ha=I,this.key=++vc,this.da=this.fa=!1}function Cn(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Dn(i){this.src=i,this.g={},this.h=0}Dn.prototype.add=function(i,a,c,h,I){var A=i.toString();i=this.g[A],i||(i=this.g[A]=[],this.h++);var V=$r(i,a,h,I);return-1<V?(a=i[V],c||(a.fa=!1)):(a=new Ic(a,this.src,A,!!h,I),a.fa=c,i.push(a)),a};function Kr(i,a){var c=a.type;if(c in i.g){var h=i.g[c],I=Array.prototype.indexOf.call(h,a,void 0),A;(A=0<=I)&&Array.prototype.splice.call(h,I,1),A&&(Cn(a),i.g[c].length==0&&(delete i.g[c],i.h--))}}function $r(i,a,c,h){for(var I=0;I<i.length;++I){var A=i[I];if(!A.da&&A.listener==a&&A.capture==!!c&&A.ha==h)return I}return-1}var Qr="closure_lm_"+(1e6*Math.random()|0),Wr={};function Io(i,a,c,h,I){if(h&&h.once)return Eo(i,a,c,h,I);if(Array.isArray(a)){for(var A=0;A<a.length;A++)Io(i,a[A],c,h,I);return null}return c=Yr(c),i&&i[We]?i.K(a,c,f(h)?!!h.capture:!!h,I):To(i,a,c,!1,h,I)}function To(i,a,c,h,I,A){if(!a)throw Error("Invalid event type");var V=f(I)?!!I.capture:!!I,W=Jr(i);if(W||(i[Qr]=W=new Dn(i)),c=W.add(a,c,h,V,A),c.proxy)return c;if(h=Tc(),c.proxy=h,h.src=i,h.listener=c,i.addEventListener)yc||(I=V),I===void 0&&(I=!1),i.addEventListener(a.toString(),h,I);else if(i.attachEvent)i.attachEvent(So(a.toString()),h);else if(i.addListener&&i.removeListener)i.addListener(h);else throw Error("addEventListener and attachEvent are unavailable.");return c}function Tc(){function i(c){return a.call(i.src,i.listener,c)}let a=Ec;return i}function Eo(i,a,c,h,I){if(Array.isArray(a)){for(var A=0;A<a.length;A++)Eo(i,a[A],c,h,I);return null}return c=Yr(c),i&&i[We]?i.L(a,c,f(h)?!!h.capture:!!h,I):To(i,a,c,!0,h,I)}function Ao(i,a,c,h,I){if(Array.isArray(a))for(var A=0;A<a.length;A++)Ao(i,a[A],c,h,I);else h=f(h)?!!h.capture:!!h,c=Yr(c),i&&i[We]?(i=i.i,a=String(a).toString(),a in i.g&&(A=i.g[a],c=$r(A,c,h,I),-1<c&&(Cn(A[c]),Array.prototype.splice.call(A,c,1),A.length==0&&(delete i.g[a],i.h--)))):i&&(i=Jr(i))&&(a=i.g[a.toString()],i=-1,a&&(i=$r(a,c,h,I)),(c=-1<i?a[i]:null)&&Hr(c))}function Hr(i){if(typeof i!="number"&&i&&!i.da){var a=i.src;if(a&&a[We])Kr(a.i,i);else{var c=i.type,h=i.proxy;a.removeEventListener?a.removeEventListener(c,h,i.capture):a.detachEvent?a.detachEvent(So(c),h):a.addListener&&a.removeListener&&a.removeListener(h),(c=Jr(a))?(Kr(c,i),c.h==0&&(c.src=null,a[Qr]=null)):Cn(i)}}}function So(i){return i in Wr?Wr[i]:Wr[i]="on"+i}function Ec(i,a){if(i.da)i=!0;else{a=new Qe(a,this);var c=i.listener,h=i.ha||i.src;i.fa&&Hr(i),i=c.call(h,a)}return i}function Jr(i){return i=i[Qr],i instanceof Dn?i:null}var Xr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yr(i){return typeof i=="function"?i:(i[Xr]||(i[Xr]=function(a){return i.handleEvent(a)}),i[Xr])}function lt(){jt.call(this),this.i=new Dn(this),this.M=this,this.F=null}N(lt,jt),lt.prototype[We]=!0,lt.prototype.removeEventListener=function(i,a,c,h){Ao(this,i,a,c,h)};function gt(i,a){var c,h=i.F;if(h)for(c=[];h;h=h.F)c.push(h);if(i=i.M,h=a.type||a,typeof a=="string")a=new ct(a,i);else if(a instanceof ct)a.target=a.target||i;else{var I=a;a=new ct(h,i),y(a,I)}if(I=!0,c)for(var A=c.length-1;0<=A;A--){var V=a.g=c[A];I=Nn(V,h,!0,a)&&I}if(V=a.g=i,I=Nn(V,h,!0,a)&&I,I=Nn(V,h,!1,a)&&I,c)for(A=0;A<c.length;A++)V=a.g=c[A],I=Nn(V,h,!1,a)&&I}lt.prototype.N=function(){if(lt.aa.N.call(this),this.i){var i=this.i,a;for(a in i.g){for(var c=i.g[a],h=0;h<c.length;h++)Cn(c[h]);delete i.g[a],i.h--}}this.F=null},lt.prototype.K=function(i,a,c,h){return this.i.add(String(i),a,!1,c,h)},lt.prototype.L=function(i,a,c,h){return this.i.add(String(i),a,!0,c,h)};function Nn(i,a,c,h){if(a=i.i.g[String(a)],!a)return!0;a=a.concat();for(var I=!0,A=0;A<a.length;++A){var V=a[A];if(V&&!V.da&&V.capture==c){var W=V.listener,at=V.ha||V.src;V.fa&&Kr(i.i,V),I=W.call(at,h)!==!1&&I}}return I&&!h.defaultPrevented}function Ro(i,a,c){if(typeof i=="function")c&&(i=S(i,c));else if(i&&typeof i.handleEvent=="function")i=S(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(a)?-1:l.setTimeout(i,a||0)}function bo(i){i.g=Ro(()=>{i.g=null,i.i&&(i.i=!1,bo(i))},i.l);let a=i.h;i.h=null,i.m.apply(null,a)}class Ac extends jt{constructor(a,c){super(),this.m=a,this.l=c,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:bo(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function He(i){jt.call(this),this.h=i,this.g={}}N(He,jt);var Po=[];function Vo(i){H(i.g,function(a,c){this.g.hasOwnProperty(c)&&Hr(a)},i),i.g={}}He.prototype.N=function(){He.aa.N.call(this),Vo(this)},He.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zr=l.JSON.stringify,Sc=l.JSON.parse,Rc=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function ti(){}ti.prototype.h=null;function xo(i){return i.h||(i.h=i.i())}function Co(){}var Je={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ei(){ct.call(this,"d")}N(ei,ct);function ni(){ct.call(this,"c")}N(ni,ct);var Zt={},Do=null;function kn(){return Do=Do||new lt}Zt.La="serverreachability";function No(i){ct.call(this,Zt.La,i)}N(No,ct);function Xe(i){let a=kn();gt(a,new No(a))}Zt.STAT_EVENT="statevent";function ko(i,a){ct.call(this,Zt.STAT_EVENT,i),this.stat=a}N(ko,ct);function pt(i){let a=kn();gt(a,new ko(a,i))}Zt.Ma="timingevent";function Fo(i,a){ct.call(this,Zt.Ma,i),this.size=a}N(Fo,ct);function Ye(i,a){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},a)}function Ze(){this.g=!0}Ze.prototype.xa=function(){this.g=!1};function bc(i,a,c,h,I,A){i.info(function(){if(i.g)if(A)for(var V="",W=A.split("&"),at=0;at<W.length;at++){var K=W[at].split("=");if(1<K.length){var ht=K[0];K=K[1];var dt=ht.split("_");V=2<=dt.length&&dt[1]=="type"?V+(ht+"="+K+"&"):V+(ht+"=redacted&")}}else V=null;else V=A;return"XMLHTTP REQ ("+h+") [attempt "+I+"]: "+a+`
`+c+`
`+V})}function Pc(i,a,c,h,I,A,V){i.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+I+"]: "+a+`
`+c+`
`+A+" "+V})}function me(i,a,c,h){i.info(function(){return"XMLHTTP TEXT ("+a+"): "+xc(i,c)+(h?" "+h:"")})}function Vc(i,a){i.info(function(){return"TIMEOUT: "+a})}Ze.prototype.info=function(){};function xc(i,a){if(!i.g)return a;if(!a)return null;try{var c=JSON.parse(a);if(c){for(i=0;i<c.length;i++)if(Array.isArray(c[i])){var h=c[i];if(!(2>h.length)){var I=h[1];if(Array.isArray(I)&&!(1>I.length)){var A=I[0];if(A!="noop"&&A!="stop"&&A!="close")for(var V=1;V<I.length;V++)I[V]=""}}}}return Zr(c)}catch{return a}}var Fn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Mo={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ri;function Mn(){}N(Mn,ti),Mn.prototype.g=function(){return new XMLHttpRequest},Mn.prototype.i=function(){return{}},ri=new Mn;function Kt(i,a,c,h){this.j=i,this.i=a,this.l=c,this.R=h||1,this.U=new He(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Oo}function Oo(){this.i=null,this.g="",this.h=!1}var Lo={},ii={};function si(i,a,c){i.L=1,i.v=Bn(kt(a)),i.m=c,i.P=!0,qo(i,null)}function qo(i,a){i.F=Date.now(),On(i),i.A=kt(i.v);var c=i.A,h=i.R;Array.isArray(h)||(h=[String(h)]),Zo(c.i,"t",h),i.C=0,c=i.j.J,i.h=new Oo,i.g=_a(i.j,c?a:null,!i.m),0<i.O&&(i.M=new Ac(S(i.Y,i,i.g),i.O)),a=i.U,c=i.g,h=i.ca;var I="readystatechange";Array.isArray(I)||(I&&(Po[0]=I.toString()),I=Po);for(var A=0;A<I.length;A++){var V=Io(c,I[A],h||a.handleEvent,!1,a.h||a);if(!V)break;a.g[V.key]=V}a=i.H?m(i.H):{},i.m?(i.u||(i.u="POST"),a["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,a)):(i.u="GET",i.g.ea(i.A,i.u,null,a)),Xe(),bc(i.i,i.u,i.A,i.l,i.R,i.m)}Kt.prototype.ca=function(i){i=i.target;let a=this.M;a&&Ft(i)==3?a.j():this.Y(i)},Kt.prototype.Y=function(i){try{if(i==this.g)t:{let dt=Ft(this.g);var a=this.g.Ba();let _e=this.g.Z();if(!(3>dt)&&(dt!=3||this.g&&(this.h.h||this.g.oa()||oa(this.g)))){this.J||dt!=4||a==7||(a==8||0>=_e?Xe(3):Xe(2)),oi(this);var c=this.g.Z();this.X=c;e:if(Bo(this)){var h=oa(this.g);i="";var I=h.length,A=Ft(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){te(this),tn(this);var V="";break e}this.h.i=new l.TextDecoder}for(a=0;a<I;a++)this.h.h=!0,i+=this.h.i.decode(h[a],{stream:!(A&&a==I-1)});h.length=0,this.h.g+=i,this.C=0,V=this.h.g}else V=this.g.oa();if(this.o=c==200,Pc(this.i,this.u,this.A,this.l,this.R,dt,c),this.o){if(this.T&&!this.K){e:{if(this.g){var W,at=this.g;if((W=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(W)){var K=W;break e}}K=null}if(c=K)me(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ai(this,c);else{this.o=!1,this.s=3,pt(12),te(this),tn(this);break t}}if(this.P){c=!0;let Et;for(;!this.J&&this.C<V.length;)if(Et=Cc(this,V),Et==ii){dt==4&&(this.s=4,pt(14),c=!1),me(this.i,this.l,null,"[Incomplete Response]");break}else if(Et==Lo){this.s=4,pt(15),me(this.i,this.l,V,"[Invalid Chunk]"),c=!1;break}else me(this.i,this.l,Et,null),ai(this,Et);if(Bo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),dt!=4||V.length!=0||this.h.h||(this.s=1,pt(16),c=!1),this.o=this.o&&c,!c)me(this.i,this.l,V,"[Invalid Chunked Response]"),te(this),tn(this);else if(0<V.length&&!this.W){this.W=!0;var ht=this.j;ht.g==this&&ht.ba&&!ht.M&&(ht.j.info("Great, no buffering proxy detected. Bytes received: "+V.length),fi(ht),ht.M=!0,pt(11))}}else me(this.i,this.l,V,null),ai(this,V);dt==4&&te(this),this.o&&!this.J&&(dt==4?fa(this.j,this):(this.o=!1,On(this)))}else Wc(this.g),c==400&&0<V.indexOf("Unknown SID")?(this.s=3,pt(12)):(this.s=0,pt(13)),te(this),tn(this)}}}catch{}finally{}};function Bo(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function Cc(i,a){var c=i.C,h=a.indexOf(`
`,c);return h==-1?ii:(c=Number(a.substring(c,h)),isNaN(c)?Lo:(h+=1,h+c>a.length?ii:(a=a.slice(h,h+c),i.C=h+c,a)))}Kt.prototype.cancel=function(){this.J=!0,te(this)};function On(i){i.S=Date.now()+i.I,Uo(i,i.I)}function Uo(i,a){if(i.B!=null)throw Error("WatchDog timer not null");i.B=Ye(S(i.ba,i),a)}function oi(i){i.B&&(l.clearTimeout(i.B),i.B=null)}Kt.prototype.ba=function(){this.B=null;let i=Date.now();0<=i-this.S?(Vc(this.i,this.A),this.L!=2&&(Xe(),pt(17)),te(this),this.s=2,tn(this)):Uo(this,this.S-i)};function tn(i){i.j.G==0||i.J||fa(i.j,i)}function te(i){oi(i);var a=i.M;a&&typeof a.ma=="function"&&a.ma(),i.M=null,Vo(i.U),i.g&&(a=i.g,i.g=null,a.abort(),a.ma())}function ai(i,a){try{var c=i.j;if(c.G!=0&&(c.g==i||ui(c.h,i))){if(!i.K&&ui(c.h,i)&&c.G==3){try{var h=c.Da.g.parse(a)}catch{h=null}if(Array.isArray(h)&&h.length==3){var I=h;if(I[0]==0){t:if(!c.u){if(c.g)if(c.g.F+3e3<i.F)Kn(c),zn(c);else break t;di(c),pt(18)}}else c.za=I[1],0<c.za-c.T&&37500>I[2]&&c.F&&c.v==0&&!c.C&&(c.C=Ye(S(c.Za,c),6e3));if(1>=jo(c.h)&&c.ca){try{c.ca()}catch{}c.ca=void 0}}else ne(c,11)}else if((i.K||c.g==i)&&Kn(c),!j(a))for(I=c.Da.g.parse(a),a=0;a<I.length;a++){let K=I[a];if(c.T=K[0],K=K[1],c.G==2)if(K[0]=="c"){c.K=K[1],c.ia=K[2];let ht=K[3];ht!=null&&(c.la=ht,c.j.info("VER="+c.la));let dt=K[4];dt!=null&&(c.Aa=dt,c.j.info("SVER="+c.Aa));let _e=K[5];_e!=null&&typeof _e=="number"&&0<_e&&(h=1.5*_e,c.L=h,c.j.info("backChannelRequestTimeoutMs_="+h)),h=c;let Et=i.g;if(Et){let Qn=Et.g?Et.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Qn){var A=h.h;A.g||Qn.indexOf("spdy")==-1&&Qn.indexOf("quic")==-1&&Qn.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(ci(A,A.h),A.h=null))}if(h.D){let mi=Et.g?Et.g.getResponseHeader("X-HTTP-Session-Id"):null;mi&&(h.ya=mi,J(h.I,h.D,mi))}}c.G=3,c.l&&c.l.ua(),c.ba&&(c.R=Date.now()-i.F,c.j.info("Handshake RTT: "+c.R+"ms")),h=c;var V=i;if(h.qa=pa(h,h.J?h.ia:null,h.W),V.K){Ko(h.h,V);var W=V,at=h.L;at&&(W.I=at),W.B&&(oi(W),On(W)),h.g=V}else ha(h);0<c.i.length&&jn(c)}else K[0]!="stop"&&K[0]!="close"||ne(c,7);else c.G==3&&(K[0]=="stop"||K[0]=="close"?K[0]=="stop"?ne(c,7):hi(c):K[0]!="noop"&&c.l&&c.l.ta(K),c.v=0)}}Xe(4)}catch{}}var Dc=class{constructor(i,a){this.g=i,this.map=a}};function Go(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function zo(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function jo(i){return i.h?1:i.g?i.g.size:0}function ui(i,a){return i.h?i.h==a:i.g?i.g.has(a):!1}function ci(i,a){i.g?i.g.add(a):i.h=a}function Ko(i,a){i.h&&i.h==a?i.h=null:i.g&&i.g.has(a)&&i.g.delete(a)}Go.prototype.cancel=function(){if(this.i=$o(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function $o(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let a=i.i;for(let c of i.g.values())a=a.concat(c.D);return a}return F(i.i)}function Nc(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(d(i)){for(var a=[],c=i.length,h=0;h<c;h++)a.push(i[h]);return a}a=[],c=0;for(h in i)a[c++]=i[h];return a}function kc(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(d(i)||typeof i=="string"){var a=[];i=i.length;for(var c=0;c<i;c++)a.push(c);return a}a=[],c=0;for(let h in i)a[c++]=h;return a}}}function Qo(i,a){if(i.forEach&&typeof i.forEach=="function")i.forEach(a,void 0);else if(d(i)||typeof i=="string")Array.prototype.forEach.call(i,a,void 0);else for(var c=kc(i),h=Nc(i),I=h.length,A=0;A<I;A++)a.call(void 0,h[A],c&&c[A],i)}var Wo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Fc(i,a){if(i){i=i.split("&");for(var c=0;c<i.length;c++){var h=i[c].indexOf("="),I=null;if(0<=h){var A=i[c].substring(0,h);I=i[c].substring(h+1)}else A=i[c];a(A,I?decodeURIComponent(I.replace(/\+/g," ")):"")}}}function ee(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof ee){this.h=i.h,Ln(this,i.j),this.o=i.o,this.g=i.g,qn(this,i.s),this.l=i.l;var a=i.i,c=new rn;c.i=a.i,a.g&&(c.g=new Map(a.g),c.h=a.h),Ho(this,c),this.m=i.m}else i&&(a=String(i).match(Wo))?(this.h=!1,Ln(this,a[1]||"",!0),this.o=en(a[2]||""),this.g=en(a[3]||"",!0),qn(this,a[4]),this.l=en(a[5]||"",!0),Ho(this,a[6]||"",!0),this.m=en(a[7]||"")):(this.h=!1,this.i=new rn(null,this.h))}ee.prototype.toString=function(){var i=[],a=this.j;a&&i.push(nn(a,Jo,!0),":");var c=this.g;return(c||a=="file")&&(i.push("//"),(a=this.o)&&i.push(nn(a,Jo,!0),"@"),i.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.s,c!=null&&i.push(":",String(c))),(c=this.l)&&(this.g&&c.charAt(0)!="/"&&i.push("/"),i.push(nn(c,c.charAt(0)=="/"?Lc:Oc,!0))),(c=this.i.toString())&&i.push("?",c),(c=this.m)&&i.push("#",nn(c,Bc)),i.join("")};function kt(i){return new ee(i)}function Ln(i,a,c){i.j=c?en(a,!0):a,i.j&&(i.j=i.j.replace(/:$/,""))}function qn(i,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);i.s=a}else i.s=null}function Ho(i,a,c){a instanceof rn?(i.i=a,Uc(i.i,i.h)):(c||(a=nn(a,qc)),i.i=new rn(a,i.h))}function J(i,a,c){i.i.set(a,c)}function Bn(i){return J(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function en(i,a){return i?a?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function nn(i,a,c){return typeof i=="string"?(i=encodeURI(i).replace(a,Mc),c&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Mc(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Jo=/[#\/\?@]/g,Oc=/[#\?:]/g,Lc=/[#\?]/g,qc=/[#\?@]/g,Bc=/#/g;function rn(i,a){this.h=this.g=null,this.i=i||null,this.j=!!a}function $t(i){i.g||(i.g=new Map,i.h=0,i.i&&Fc(i.i,function(a,c){i.add(decodeURIComponent(a.replace(/\+/g," ")),c)}))}n=rn.prototype,n.add=function(i,a){$t(this),this.i=null,i=ge(this,i);var c=this.g.get(i);return c||this.g.set(i,c=[]),c.push(a),this.h+=1,this};function Xo(i,a){$t(i),a=ge(i,a),i.g.has(a)&&(i.i=null,i.h-=i.g.get(a).length,i.g.delete(a))}function Yo(i,a){return $t(i),a=ge(i,a),i.g.has(a)}n.forEach=function(i,a){$t(this),this.g.forEach(function(c,h){c.forEach(function(I){i.call(a,I,h,this)},this)},this)},n.na=function(){$t(this);let i=Array.from(this.g.values()),a=Array.from(this.g.keys()),c=[];for(let h=0;h<a.length;h++){let I=i[h];for(let A=0;A<I.length;A++)c.push(a[h])}return c},n.V=function(i){$t(this);let a=[];if(typeof i=="string")Yo(this,i)&&(a=a.concat(this.g.get(ge(this,i))));else{i=Array.from(this.g.values());for(let c=0;c<i.length;c++)a=a.concat(i[c])}return a},n.set=function(i,a){return $t(this),this.i=null,i=ge(this,i),Yo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[a]),this.h+=1,this},n.get=function(i,a){return i?(i=this.V(i),0<i.length?String(i[0]):a):a};function Zo(i,a,c){Xo(i,a),0<c.length&&(i.i=null,i.g.set(ge(i,a),F(c)),i.h+=c.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],a=Array.from(this.g.keys());for(var c=0;c<a.length;c++){var h=a[c];let A=encodeURIComponent(String(h)),V=this.V(h);for(h=0;h<V.length;h++){var I=A;V[h]!==""&&(I+="="+encodeURIComponent(String(V[h]))),i.push(I)}}return this.i=i.join("&")};function ge(i,a){return a=String(a),i.j&&(a=a.toLowerCase()),a}function Uc(i,a){a&&!i.j&&($t(i),i.i=null,i.g.forEach(function(c,h){var I=h.toLowerCase();h!=I&&(Xo(this,h),Zo(this,I,c))},i)),i.j=a}function Gc(i,a){let c=new Ze;if(l.Image){let h=new Image;h.onload=P(Qt,c,"TestLoadImage: loaded",!0,a,h),h.onerror=P(Qt,c,"TestLoadImage: error",!1,a,h),h.onabort=P(Qt,c,"TestLoadImage: abort",!1,a,h),h.ontimeout=P(Qt,c,"TestLoadImage: timeout",!1,a,h),l.setTimeout(function(){h.ontimeout&&h.ontimeout()},1e4),h.src=i}else a(!1)}function zc(i,a){let c=new Ze,h=new AbortController,I=setTimeout(()=>{h.abort(),Qt(c,"TestPingServer: timeout",!1,a)},1e4);fetch(i,{signal:h.signal}).then(A=>{clearTimeout(I),A.ok?Qt(c,"TestPingServer: ok",!0,a):Qt(c,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(I),Qt(c,"TestPingServer: error",!1,a)})}function Qt(i,a,c,h,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),h(c)}catch{}}function jc(){this.g=new Rc}function Kc(i,a,c){let h=c||"";try{Qo(i,function(I,A){let V=I;f(I)&&(V=Zr(I)),a.push(h+A+"="+encodeURIComponent(V))})}catch(I){throw a.push(h+"type="+encodeURIComponent("_badmap")),I}}function sn(i){this.l=i.Ub||null,this.j=i.eb||!1}N(sn,ti),sn.prototype.g=function(){return new Un(this.l,this.j)},sn.prototype.i=function(i){return function(){return i}}({});function Un(i,a){lt.call(this),this.D=i,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(Un,lt),n=Un.prototype,n.open=function(i,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=a,this.readyState=1,an(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let a={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(a.body=i),(this.D||l).fetch(new Request(this.A,a)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,on(this)),this.readyState=0},n.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,an(this)),this.g&&(this.readyState=3,an(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ta(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function ta(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}n.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var a=i.value?i.value:new Uint8Array(0);(a=this.v.decode(a,{stream:!i.done}))&&(this.response=this.responseText+=a)}i.done?on(this):an(this),this.readyState==3&&ta(this)}},n.Ra=function(i){this.g&&(this.response=this.responseText=i,on(this))},n.Qa=function(i){this.g&&(this.response=i,on(this))},n.ga=function(){this.g&&on(this)};function on(i){i.readyState=4,i.l=null,i.j=null,i.v=null,an(i)}n.setRequestHeader=function(i,a){this.u.append(i,a)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],a=this.h.entries();for(var c=a.next();!c.done;)c=c.value,i.push(c[0]+": "+c[1]),c=a.next();return i.join(`\r
`)};function an(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Un.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ea(i){let a="";return H(i,function(c,h){a+=h,a+=":",a+=c,a+=`\r
`}),a}function li(i,a,c){t:{for(h in c){var h=!1;break t}h=!0}h||(c=ea(c),typeof i=="string"?c!=null&&encodeURIComponent(String(c)):J(i,a,c))}function Z(i){lt.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(Z,lt);var $c=/^https?$/i,Qc=["POST","PUT"];n=Z.prototype,n.Ha=function(i){this.J=i},n.ea=function(i,a,c,h){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);a=a?a.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ri.g(),this.v=this.o?xo(this.o):xo(ri),this.g.onreadystatechange=S(this.Ea,this);try{this.B=!0,this.g.open(a,String(i),!0),this.B=!1}catch(A){na(this,A);return}if(i=c||"",c=new Map(this.headers),h)if(Object.getPrototypeOf(h)===Object.prototype)for(var I in h)c.set(I,h[I]);else if(typeof h.keys=="function"&&typeof h.get=="function")for(let A of h.keys())c.set(A,h.get(A));else throw Error("Unknown input type for opt_headers: "+String(h));h=Array.from(c.keys()).find(A=>A.toLowerCase()=="content-type"),I=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Qc,a,void 0))||h||I||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[A,V]of c)this.g.setRequestHeader(A,V);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{sa(this),this.u=!0,this.g.send(i),this.u=!1}catch(A){na(this,A)}};function na(i,a){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=a,i.m=5,ra(i),Gn(i)}function ra(i){i.A||(i.A=!0,gt(i,"complete"),gt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,gt(this,"complete"),gt(this,"abort"),Gn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gn(this,!0)),Z.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ia(this):this.bb())},n.bb=function(){ia(this)};function ia(i){if(i.h&&typeof u<"u"&&(!i.v[1]||Ft(i)!=4||i.Z()!=2)){if(i.u&&Ft(i)==4)Ro(i.Ea,0,i);else if(gt(i,"readystatechange"),Ft(i)==4){i.h=!1;try{let V=i.Z();t:switch(V){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var c;if(!(c=a)){var h;if(h=V===0){var I=String(i.D).match(Wo)[1]||null;!I&&l.self&&l.self.location&&(I=l.self.location.protocol.slice(0,-1)),h=!$c.test(I?I.toLowerCase():"")}c=h}if(c)gt(i,"complete"),gt(i,"success");else{i.m=6;try{var A=2<Ft(i)?i.g.statusText:""}catch{A=""}i.l=A+" ["+i.Z()+"]",ra(i)}}finally{Gn(i)}}}}function Gn(i,a){if(i.g){sa(i);let c=i.g,h=i.v[0]?()=>{}:null;i.g=null,i.v=null,a||gt(i,"ready");try{c.onreadystatechange=h}catch{}}}function sa(i){i.I&&(l.clearTimeout(i.I),i.I=null)}n.isActive=function(){return!!this.g};function Ft(i){return i.g?i.g.readyState:0}n.Z=function(){try{return 2<Ft(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(i){if(this.g){var a=this.g.responseText;return i&&a.indexOf(i)==0&&(a=a.substring(i.length)),Sc(a)}};function oa(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Wc(i){let a={};i=(i.g&&2<=Ft(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let h=0;h<i.length;h++){if(j(i[h]))continue;var c=w(i[h]);let I=c[0];if(c=c[1],typeof c!="string")continue;c=c.trim();let A=a[I]||[];a[I]=A,A.push(c)}v(a,function(h){return h.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function un(i,a,c){return c&&c.internalChannelParams&&c.internalChannelParams[i]||a}function aa(i){this.Aa=0,this.i=[],this.j=new Ze,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=un("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=un("baseRetryDelayMs",5e3,i),this.cb=un("retryDelaySeedMs",1e4,i),this.Wa=un("forwardChannelMaxRetries",2,i),this.wa=un("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new Go(i&&i.concurrentRequestLimit),this.Da=new jc,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=aa.prototype,n.la=8,n.G=1,n.connect=function(i,a,c,h){pt(0),this.W=i,this.H=a||{},c&&h!==void 0&&(this.H.OSID=c,this.H.OAID=h),this.F=this.X,this.I=pa(this,null,this.W),jn(this)};function hi(i){if(ua(i),i.G==3){var a=i.U++,c=kt(i.I);if(J(c,"SID",i.K),J(c,"RID",a),J(c,"TYPE","terminate"),cn(i,c),a=new Kt(i,i.j,a),a.L=2,a.v=Bn(kt(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(a.v.toString(),"")}catch{}!c&&l.Image&&(new Image().src=a.v,c=!0),c||(a.g=_a(a.j,null),a.g.ea(a.v)),a.F=Date.now(),On(a)}ga(i)}function zn(i){i.g&&(fi(i),i.g.cancel(),i.g=null)}function ua(i){zn(i),i.u&&(l.clearTimeout(i.u),i.u=null),Kn(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function jn(i){if(!zo(i.h)&&!i.s){i.s=!0;var a=i.Ga;Ke||vo(),$e||(Ke(),$e=!0),jr.add(a,i),i.B=0}}function Hc(i,a){return jo(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=a.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=Ye(S(i.Ga,i,a),ma(i,i.B)),i.B++,!0)}n.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;let I=new Kt(this,this.j,i),A=this.o;if(this.S&&(A?(A=m(A),y(A,this.S)):A=this.S),this.m!==null||this.O||(I.H=A,A=null),this.P)t:{for(var a=0,c=0;c<this.i.length;c++){e:{var h=this.i[c];if("__data__"in h.map&&(h=h.map.__data__,typeof h=="string")){h=h.length;break e}h=void 0}if(h===void 0)break;if(a+=h,4096<a){a=c;break t}if(a===4096||c===this.i.length-1){a=c+1;break t}}a=1e3}else a=1e3;a=la(this,I,a),c=kt(this.I),J(c,"RID",i),J(c,"CVER",22),this.D&&J(c,"X-HTTP-Session-Id",this.D),cn(this,c),A&&(this.O?a="headers="+encodeURIComponent(String(ea(A)))+"&"+a:this.m&&li(c,this.m,A)),ci(this.h,I),this.Ua&&J(c,"TYPE","init"),this.P?(J(c,"$req",a),J(c,"SID","null"),I.T=!0,si(I,c,null)):si(I,c,a),this.G=2}}else this.G==3&&(i?ca(this,i):this.i.length==0||zo(this.h)||ca(this))};function ca(i,a){var c;a?c=a.l:c=i.U++;let h=kt(i.I);J(h,"SID",i.K),J(h,"RID",c),J(h,"AID",i.T),cn(i,h),i.m&&i.o&&li(h,i.m,i.o),c=new Kt(i,i.j,c,i.B+1),i.m===null&&(c.H=i.o),a&&(i.i=a.D.concat(i.i)),a=la(i,c,1e3),c.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),ci(i.h,c),si(c,h,a)}function cn(i,a){i.H&&H(i.H,function(c,h){J(a,h,c)}),i.l&&Qo({},function(c,h){J(a,h,c)})}function la(i,a,c){c=Math.min(i.i.length,c);var h=i.l?S(i.l.Na,i.l,i):null;t:{var I=i.i;let A=-1;for(;;){let V=["count="+c];A==-1?0<c?(A=I[0].g,V.push("ofs="+A)):A=0:V.push("ofs="+A);let W=!0;for(let at=0;at<c;at++){let K=I[at].g,ht=I[at].map;if(K-=A,0>K)A=Math.max(0,I[at].g-100),W=!1;else try{Kc(ht,V,"req"+K+"_")}catch{h&&h(ht)}}if(W){h=V.join("&");break t}}}return i=i.i.splice(0,c),a.D=i,h}function ha(i){if(!i.g&&!i.u){i.Y=1;var a=i.Fa;Ke||vo(),$e||(Ke(),$e=!0),jr.add(a,i),i.v=0}}function di(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=Ye(S(i.Fa,i),ma(i,i.v)),i.v++,!0)}n.Fa=function(){if(this.u=null,da(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=Ye(S(this.ab,this),i)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,pt(10),zn(this),da(this))};function fi(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function da(i){i.g=new Kt(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var a=kt(i.qa);J(a,"RID","rpc"),J(a,"SID",i.K),J(a,"AID",i.T),J(a,"CI",i.F?"0":"1"),!i.F&&i.ja&&J(a,"TO",i.ja),J(a,"TYPE","xmlhttp"),cn(i,a),i.m&&i.o&&li(a,i.m,i.o),i.L&&(i.g.I=i.L);var c=i.g;i=i.ia,c.L=1,c.v=Bn(kt(a)),c.m=null,c.P=!0,qo(c,i)}n.Za=function(){this.C!=null&&(this.C=null,zn(this),di(this),pt(19))};function Kn(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function fa(i,a){var c=null;if(i.g==a){Kn(i),fi(i),i.g=null;var h=2}else if(ui(i.h,a))c=a.D,Ko(i.h,a),h=1;else return;if(i.G!=0){if(a.o)if(h==1){c=a.m?a.m.length:0,a=Date.now()-a.F;var I=i.B;h=kn(),gt(h,new Fo(h,c)),jn(i)}else ha(i);else if(I=a.s,I==3||I==0&&0<a.X||!(h==1&&Hc(i,a)||h==2&&di(i)))switch(c&&0<c.length&&(a=i.h,a.i=a.i.concat(c)),I){case 1:ne(i,5);break;case 4:ne(i,10);break;case 3:ne(i,6);break;default:ne(i,2)}}}function ma(i,a){let c=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(c*=2),c*a}function ne(i,a){if(i.j.info("Error code "+a),a==2){var c=S(i.fb,i),h=i.Xa;let I=!h;h=new ee(h||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Ln(h,"https"),Bn(h),I?Gc(h.toString(),c):zc(h.toString(),c)}else pt(2);i.G=0,i.l&&i.l.sa(a),ga(i),ua(i)}n.fb=function(i){i?(this.j.info("Successfully pinged google.com"),pt(2)):(this.j.info("Failed to ping google.com"),pt(1))};function ga(i){if(i.G=0,i.ka=[],i.l){let a=$o(i.h);(a.length!=0||i.i.length!=0)&&(x(i.ka,a),x(i.ka,i.i),i.h.i.length=0,F(i.i),i.i.length=0),i.l.ra()}}function pa(i,a,c){var h=c instanceof ee?kt(c):new ee(c);if(h.g!="")a&&(h.g=a+"."+h.g),qn(h,h.s);else{var I=l.location;h=I.protocol,a=a?a+"."+I.hostname:I.hostname,I=+I.port;var A=new ee(null);h&&Ln(A,h),a&&(A.g=a),I&&qn(A,I),c&&(A.l=c),h=A}return c=i.D,a=i.ya,c&&a&&J(h,c,a),J(h,"VER",i.la),cn(i,h),h}function _a(i,a,c){if(a&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return a=i.Ca&&!i.pa?new Z(new sn({eb:c})):new Z(i.pa),a.Ha(i.J),a}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ya(){}n=ya.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $n(){}$n.prototype.g=function(i,a){return new _t(i,a)};function _t(i,a){lt.call(this),this.g=new aa(a),this.l=i,this.h=a&&a.messageUrlParams||null,i=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(i?i["X-WebChannel-Content-Type"]=a.messageContentType:i={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.va&&(i?i["X-WebChannel-Client-Profile"]=a.va:i={"X-WebChannel-Client-Profile":a.va}),this.g.S=i,(i=a&&a.Sb)&&!j(i)&&(this.g.m=i),this.v=a&&a.supportsCrossDomainXhr||!1,this.u=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!j(a)&&(this.g.D=a,i=this.h,i!==null&&a in i&&(i=this.h,a in i&&delete i[a])),this.j=new pe(this)}N(_t,lt),_t.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_t.prototype.close=function(){hi(this.g)},_t.prototype.o=function(i){var a=this.g;if(typeof i=="string"){var c={};c.__data__=i,i=c}else this.u&&(c={},c.__data__=Zr(i),i=c);a.i.push(new Dc(a.Ya++,i)),a.G==3&&jn(a)},_t.prototype.N=function(){this.g.l=null,delete this.j,hi(this.g),delete this.g,_t.aa.N.call(this)};function wa(i){ei.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var a=i.__sm__;if(a){t:{for(let c in a){i=c;break t}i=void 0}(this.i=i)&&(i=this.i,a=a!==null&&i in a?a[i]:void 0),this.data=a}else this.data=i}N(wa,ei);function va(){ni.call(this),this.status=1}N(va,ni);function pe(i){this.g=i}N(pe,ya),pe.prototype.ua=function(){gt(this.g,"a")},pe.prototype.ta=function(i){gt(this.g,new wa(i))},pe.prototype.sa=function(i){gt(this.g,new va)},pe.prototype.ra=function(){gt(this.g,"b")},$n.prototype.createWebChannel=$n.prototype.g,_t.prototype.send=_t.prototype.o,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,Ii=Ot.createWebChannelTransport=function(){return new $n},vi=Ot.getStatEventTarget=function(){return kn()},wi=Ot.Event=Zt,Hn=Ot.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fn.NO_ERROR=0,Fn.TIMEOUT=8,Fn.HTTP_ERROR=6,ln=Ot.ErrorCode=Fn,Mo.COMPLETE="complete",yi=Ot.EventType=Mo,Co.EventType=Je,Je.OPEN="a",Je.CLOSE="b",Je.ERROR="c",Je.MESSAGE="d",lt.prototype.listen=lt.prototype.K,we=Ot.WebChannel=Co,Jc=Ot.FetchXmlHttpFactory=sn,Z.prototype.listenOnce=Z.prototype.L,Z.prototype.getLastError=Z.prototype.Ka,Z.prototype.getLastErrorCode=Z.prototype.Ba,Z.prototype.getStatus=Z.prototype.Z,Z.prototype.getResponseJson=Z.prototype.Oa,Z.prototype.getResponseText=Z.prototype.oa,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Ha,_i=Ot.XhrIo=Z}).apply(typeof Wn<"u"?Wn:typeof self<"u"?self:typeof window<"u"?window:{});var ka="@firebase/firestore";var st=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};st.UNAUTHENTICATED=new st(null),st.GOOGLE_CREDENTIALS=new st("google-credentials-uid"),st.FIRST_PARTY=new st("first-party-uid"),st.MOCK_USER=new st("mock-user");var Be="11.2.0";var oe=new ba("@firebase/firestore");function ve(){return oe.logLevel}function D(n,...t){if(oe.logLevel<=Rt.DEBUG){let e=t.map(ro);oe.debug(`Firestore (${Be}): ${n}`,...e)}}function Lt(n,...t){if(oe.logLevel<=Rt.ERROR){let e=t.map(ro);oe.error(`Firestore (${Be}): ${n}`,...e)}}function be(n,...t){if(oe.logLevel<=Rt.WARN){let e=t.map(ro);oe.warn(`Firestore (${Be}): ${n}`,...e)}}function ro(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function O(n="Unexpected state"){let t=`FIRESTORE (${Be}) INTERNAL ASSERTION FAILED: `+n;throw Lt(t),new Error(t)}function Q(n,t){n||O()}function L(n,t){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends Sa{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Tt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var nr=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Ri=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(st.UNAUTHENTICATED))}shutdown(){}},bi=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Pi=class{constructor(t){this.t=t,this.currentUser=st.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Q(this.o===void 0);let r=this.i,s=d=>this.i!==r?(r=this.i,e(d)):Promise.resolve(),o=new Tt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Tt,t.enqueueRetryable(()=>s(this.currentUser))};let u=()=>{let d=o;t.enqueueRetryable(()=>C(this,null,function*(){yield d.promise,yield s(this.currentUser)}))},l=d=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(d=>l(d)),setTimeout(()=>{if(!this.auth){let d=this.t.getImmediate({optional:!0});d?l(d):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Tt)}},0),u()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string"),new nr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return Q(t===null||typeof t=="string"),new st(t)}},Vi=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=st.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},xi=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new Vi(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(st.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ci=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Di=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){Q(this.o===void 0);let r=o=>{o.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let u=o.token!==this.R;return this.R=o.token,D("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let s=o=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?s(o):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(Q(typeof e.token=="string"),this.R=e.token,new Ci(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Xc(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var rr=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let s=Xc(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%t.length))}return r}};function U(n,t){return n<t?-1:n>t?1:0}function Pe(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var ut=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new k(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new k(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new k(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new k(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?U(this.nanoseconds,t.nanoseconds):U(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var q=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new ut(0,0))}static max(){return new n(new ut(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ir=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&O(),r===void 0?r=t.length-e:r>t.length-e&&O(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=n.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return Math.sign(t.length-e.length)}static compareSegments(t,e){let r=n.isNumericId(t),s=n.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(t).compare(n.extractNumericId(e)):t<e?-1:t>e?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Mt.fromString(t.substring(4,t.length-2))}},tt=class n extends ir{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new k(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},Yc=/^[_a-zA-Z][_a-zA-Z0-9]*$/,yt=class n extends ir{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return Yc.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",s=0,o=()=>{if(r.length===0)throw new k(R.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},u=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new k(R.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let d=t[s+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new k(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=d,s+=2}else l==="`"?(u=!u,s++):l!=="."||u?(r+=l,s++):(o(),s++)}if(o(),u)throw new k(R.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var M=class n{constructor(t){this.path=t}static fromPath(t){return new n(tt.fromString(t))}static fromName(t){return new n(tt.fromString(t).popFirst(5))}static empty(){return new n(tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&tt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return tt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new tt(t.slice()))}};var Ni=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};Ni.UNKNOWN_ID=-1;function Zc(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=q.fromTimestamp(r===1e9?new ut(e+1,0):new ut(e,r));return new ae(s,M.empty(),t)}function tl(n){return new ae(n.readTime,n.key,-1)}var ae=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(q.min(),M.empty(),-1)}static max(){return new n(q.max(),M.empty(),-1)}};function el(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:U(n.largestBatchId,t.largestBatchId))}var nl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ki=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ue(n){return C(this,null,function*(){if(n.code!==R.FAILED_PRECONDITION||n.message!==nl)throw n;D("LocalStore","Unexpectedly lost primary lease")})}var b=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&O(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,o=0,u=!1;t.forEach(l=>{++s,l.next(()=>{++o,u&&o===s&&e()},d=>r(d))}),u=!0,o===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let o=t.length,u=new Array(o),l=0;for(let d=0;d<o;d++){let f=d;e(t[f]).next(_=>{u[f]=_,++l,l===o&&r(u)},_=>s(_))}})}static doWhile(t,e){return new n((r,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}};function rl(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Ge(n){return n.name==="IndexedDbTransactionError"}var io=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ie(s),this.se=s=>r.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return n.oe=-1,n})();function Fr(n){return n==null}function pn(n){return n===0&&1/n==-1/0}function il(n){return typeof n=="number"&&Number.isInteger(n)&&!pn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function sl(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Fa(t)),t=ol(n.get(e),t);return Fa(t)}function ol(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let o=n.charAt(s);switch(o){case"\0":e+="";break;case"":e+="";break;default:e+=o}}return e}function Fa(n){return n+""}var al=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],dd=[...al,"documentOverlays"],ul=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],cl=ul,ll=[...cl,"indexConfiguration","indexState","indexEntries"];var fd=[...ll,"globals"];function Ma(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function de(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function du(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var et=class n{constructor(t,e){this.comparator=t,this.root=e||Pt.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Pt.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Pt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ae(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ae(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ae(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ae(this.root,t,this.comparator,!0)}},Ae=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Pt=class n{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new n(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw O();let t=this.left.check();if(t!==this.right.check())throw O();return t+(this.isRed()?0:1)}};Pt.EMPTY=null,Pt.RED=!0,Pt.BLACK=!1;Pt.EMPTY=new class{constructor(){this.size=0}get key(){throw O()}get value(){throw O()}get color(){throw O()}get left(){throw O()}get right(){throw O()}copy(t,e,r,s,o){return this}insert(t,e,r){return new Pt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ot=class n{constructor(t){this.comparator=t,this.data=new et(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new sr(this.data.getIterator())}getIteratorFrom(t){return new sr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},sr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var bt=class n{constructor(t){this.fields=t,t.sort(yt.comparator)}static empty(){return new n([])}unionWith(t){let e=new ot(yt.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Pe(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var or=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var mt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new or("Invalid base64 string: "+o):o}}(t);return new n(e)}static fromUint8Array(t){let e=function(s){let o="";for(let u=0;u<s.length;++u)o+=String.fromCharCode(s[u]);return o}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return U(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};mt.EMPTY_BYTE_STRING=new mt("");var hl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qt(n){if(Q(!!n),typeof n=="string"){let t=0,e=hl.exec(n);if(Q(!!e),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:X(n.seconds),nanos:X(n.nanos)}}function X(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Bt(n){return typeof n=="string"?mt.fromBase64String(n):mt.fromUint8Array(n)}function so(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Mr(n){let t=n.mapValue.fields.__previous_value__;return so(t)?Mr(t):t}function _n(n){let t=qt(n.mapValue.fields.__local_write_time__.timestampValue);return new ut(t.seconds,t.nanos)}var Fi=class{constructor(t,e,r,s,o,u,l,d,f){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=f}},ar=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Jn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Jt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?so(n)?4:mu(n)?9007199254740991:fu(n)?10:11:O()}function Ct(n,t){if(n===t)return!0;let e=Jt(n);if(e!==Jt(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return _n(n).isEqual(_n(t));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let u=qt(s.timestampValue),l=qt(o.timestampValue);return u.seconds===l.seconds&&u.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,o){return Bt(s.bytesValue).isEqual(Bt(o.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,o){return X(s.geoPointValue.latitude)===X(o.geoPointValue.latitude)&&X(s.geoPointValue.longitude)===X(o.geoPointValue.longitude)}(n,t);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return X(s.integerValue)===X(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let u=X(s.doubleValue),l=X(o.doubleValue);return u===l?pn(u)===pn(l):isNaN(u)&&isNaN(l)}return!1}(n,t);case 9:return Pe(n.arrayValue.values||[],t.arrayValue.values||[],Ct);case 10:case 11:return function(s,o){let u=s.mapValue.fields||{},l=o.mapValue.fields||{};if(Ma(u)!==Ma(l))return!1;for(let d in u)if(u.hasOwnProperty(d)&&(l[d]===void 0||!Ct(u[d],l[d])))return!1;return!0}(n,t);default:return O()}}function yn(n,t){return(n.values||[]).find(e=>Ct(e,t))!==void 0}function Ve(n,t){if(n===t)return 0;let e=Jt(n),r=Jt(t);if(e!==r)return U(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return U(n.booleanValue,t.booleanValue);case 2:return function(o,u){let l=X(o.integerValue||o.doubleValue),d=X(u.integerValue||u.doubleValue);return l<d?-1:l>d?1:l===d?0:isNaN(l)?isNaN(d)?0:-1:1}(n,t);case 3:return Oa(n.timestampValue,t.timestampValue);case 4:return Oa(_n(n),_n(t));case 5:return U(n.stringValue,t.stringValue);case 6:return function(o,u){let l=Bt(o),d=Bt(u);return l.compareTo(d)}(n.bytesValue,t.bytesValue);case 7:return function(o,u){let l=o.split("/"),d=u.split("/");for(let f=0;f<l.length&&f<d.length;f++){let _=U(l[f],d[f]);if(_!==0)return _}return U(l.length,d.length)}(n.referenceValue,t.referenceValue);case 8:return function(o,u){let l=U(X(o.latitude),X(u.latitude));return l!==0?l:U(X(o.longitude),X(u.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return La(n.arrayValue,t.arrayValue);case 10:return function(o,u){var l,d,f,_;let E=o.fields||{},S=u.fields||{},P=(l=E.value)===null||l===void 0?void 0:l.arrayValue,N=(d=S.value)===null||d===void 0?void 0:d.arrayValue,F=U(((f=P?.values)===null||f===void 0?void 0:f.length)||0,((_=N?.values)===null||_===void 0?void 0:_.length)||0);return F!==0?F:La(P,N)}(n.mapValue,t.mapValue);case 11:return function(o,u){if(o===Jn.mapValue&&u===Jn.mapValue)return 0;if(o===Jn.mapValue)return 1;if(u===Jn.mapValue)return-1;let l=o.fields||{},d=Object.keys(l),f=u.fields||{},_=Object.keys(f);d.sort(),_.sort();for(let E=0;E<d.length&&E<_.length;++E){let S=U(d[E],_[E]);if(S!==0)return S;let P=Ve(l[d[E]],f[_[E]]);if(P!==0)return P}return U(d.length,_.length)}(n.mapValue,t.mapValue);default:throw O()}}function Oa(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return U(n,t);let e=qt(n),r=qt(t),s=U(e.seconds,r.seconds);return s!==0?s:U(e.nanos,r.nanos)}function La(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let o=Ve(e[s],r[s]);if(o)return o}return U(e.length,r.length)}function xe(n){return Mi(n)}function Mi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=qt(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Bt(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return M.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(let o of e.values||[])s?s=!1:r+=",",r+=Mi(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let u of r)o?o=!1:s+=",",s+=`${u}:${Mi(e.fields[u])}`;return s+"}"}(n.mapValue):O()}function Zn(n){switch(Jt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Mr(n);return t?16+Zn(t):16;case 5:return 2*n.stringValue.length;case 6:return Bt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+Zn(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return de(r.fields,(o,u)=>{s+=o.length+Zn(u)}),s}(n.mapValue);default:throw O()}}function Oi(n){return!!n&&"integerValue"in n}function oo(n){return!!n&&"arrayValue"in n}function qa(n){return!!n&&"nullValue"in n}function Ba(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tr(n){return!!n&&"mapValue"in n}function fu(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function dn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return de(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=dn(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=dn(n.arrayValue.values[e]);return t}return Object.assign({},n)}function mu(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var At=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!tr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=dn(e)}setAll(t){let e=yt.emptyPath(),r={},s=[];t.forEach((u,l)=>{if(!e.isImmediateParentOf(l)){let d=this.getFieldsMap(e);this.applyChanges(d,r,s),r={},s=[],e=l.popLast()}u?r[l.lastSegment()]=dn(u):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){let e=this.field(t.popLast());tr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ct(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];tr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){de(e,(s,o)=>t[s]=o);for(let s of r)delete t[s]}clone(){return new n(dn(this.value))}};function gu(n){let t=[];return de(n.fields,(e,r)=>{let s=new yt([e]);if(tr(r)){let o=gu(r.mapValue).fields;if(o.length===0)t.push(s);else for(let u of o)t.push(s.child(u))}else t.push(s)}),new bt(t)}var St=class n{constructor(t,e,r,s,o,u,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=u,this.documentState=l}static newInvalidDocument(t){return new n(t,0,q.min(),q.min(),q.min(),At.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,q.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,q.min(),q.min(),At.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,q.min(),q.min(),At.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=At.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=At.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ce=class{constructor(t,e){this.position=t,this.inclusive=e}};function Ua(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let o=t[s],u=n.position[s];if(o.field.isKeyField()?r=M.comparator(M.fromName(u.referenceValue),e.key):r=Ve(u,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ga(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ct(n.position[e],t.position[e]))return!1;return!0}var De=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function dl(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var ur=class{},it=class n extends ur{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new qi(t,e,r):e==="array-contains"?new Gi(t,r):e==="in"?new zi(t,r):e==="not-in"?new ji(t,r):e==="array-contains-any"?new Ki(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Bi(t,r):new Ui(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Ve(e,this.value)):e!==null&&Jt(this.value)===Jt(e)&&this.matchesComparison(Ve(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return O()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Dt=class n extends ur{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new n(t,e)}matches(t){return pu(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function pu(n){return n.op==="and"}function _u(n){return fl(n)&&pu(n)}function fl(n){for(let t of n.filters)if(t instanceof Dt)return!1;return!0}function Li(n){if(n instanceof it)return n.field.canonicalString()+n.op.toString()+xe(n.value);if(_u(n))return n.filters.map(t=>Li(t)).join(",");{let t=n.filters.map(e=>Li(e)).join(",");return`${n.op}(${t})`}}function yu(n,t){return n instanceof it?function(r,s){return s instanceof it&&r.op===s.op&&r.field.isEqual(s.field)&&Ct(r.value,s.value)}(n,t):n instanceof Dt?function(r,s){return s instanceof Dt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,u,l)=>o&&yu(u,s.filters[l]),!0):!1}(n,t):void O()}function wu(n){return n instanceof it?function(e){return`${e.field.canonicalString()} ${e.op} ${xe(e.value)}`}(n):n instanceof Dt?function(e){return e.op.toString()+" {"+e.getFilters().map(wu).join(" ,")+"}"}(n):"Filter"}var qi=class extends it{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},Bi=class extends it{constructor(t,e){super(t,"in",e),this.keys=vu("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ui=class extends it{constructor(t,e){super(t,"not-in",e),this.keys=vu("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function vu(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>M.fromName(r.referenceValue))}var Gi=class extends it{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return oo(e)&&yn(e.arrayValue,this.value)}},zi=class extends it{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&yn(this.value.arrayValue,e)}},ji=class extends it{constructor(t,e){super(t,"not-in",e)}matches(t){if(yn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!yn(this.value.arrayValue,e)}},Ki=class extends it{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!oo(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>yn(this.value.arrayValue,r))}};var $i=class{constructor(t,e=null,r=[],s=[],o=null,u=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=u,this.endAt=l,this.ue=null}};function za(n,t=null,e=[],r=[],s=null,o=null,u=null){return new $i(n,t,e,r,s,o,u)}function ao(n){let t=L(n);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>Li(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),Fr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>xe(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>xe(r)).join(",")),t.ue=e}return t.ue}function uo(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!dl(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!yu(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Ga(n.startAt,t.startAt)&&Ga(n.endAt,t.endAt)}function Qi(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Ne=class{constructor(t,e=null,r=[],s=[],o=null,u="F",l=null,d=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=u,this.startAt=l,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function ml(n,t,e,r,s,o,u,l){return new Ne(n,t,e,r,s,o,u,l)}function co(n){return new Ne(n)}function ja(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function gl(n){return n.collectionGroup!==null}function fn(n){let t=L(n);if(t.ce===null){t.ce=[];let e=new Set;for(let o of t.explicitOrderBy)t.ce.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(u){let l=new ot(yt.comparator);return u.filters.forEach(d=>{d.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.ce.push(new De(o,r))}),e.has(yt.keyField().canonicalString())||t.ce.push(new De(yt.keyField(),r))}return t.ce}function Vt(n){let t=L(n);return t.le||(t.le=pl(t,fn(n))),t.le}function pl(n,t){if(n.limitType==="F")return za(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new De(s.field,o)});let e=n.endAt?new Ce(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ce(n.startAt.position,n.startAt.inclusive):null;return za(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Wi(n,t,e){return new Ne(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Or(n,t){return uo(Vt(n),Vt(t))&&n.limitType===t.limitType}function Iu(n){return`${ao(Vt(n))}|lt:${n.limitType}`}function Ie(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>wu(s)).join(", ")}]`),Fr(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(u){return`${u.field.canonicalString()} (${u.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>xe(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>xe(s)).join(",")),`Target(${r})`}(Vt(n))}; limitType=${n.limitType})`}function Lr(n,t){return t.isFoundDocument()&&function(r,s){let o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,t)&&function(r,s){for(let o of fn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,t)&&function(r,s){for(let o of r.filters)if(!o.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(u,l,d){let f=Ua(u,l,d);return u.inclusive?f<=0:f<0}(r.startAt,fn(r),s)||r.endAt&&!function(u,l,d){let f=Ua(u,l,d);return u.inclusive?f>=0:f>0}(r.endAt,fn(r),s))}(n,t)}function _l(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Tu(n){return(t,e)=>{let r=!1;for(let s of fn(n)){let o=yl(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function yl(n,t,e){let r=n.field.isKeyField()?M.comparator(t.key,e.key):function(o,u,l){let d=u.data.field(o),f=l.data.field(o);return d!==null&&f!==null?Ve(d,f):O()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return O()}}var Ut=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){de(this.inner,(e,r)=>{for(let[s,o]of r)t(s,o)})}isEmpty(){return du(this.inner)}size(){return this.innerSize}};var wl=new et(M.comparator);function Gt(){return wl}var Eu=new et(M.comparator);function hn(...n){let t=Eu;for(let e of n)t=t.insert(e.key,e);return t}function Au(n){let t=Eu;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function re(){return mn()}function Su(){return mn()}function mn(){return new Ut(n=>n.toString(),(n,t)=>n.isEqual(t))}var vl=new et(M.comparator),Il=new ot(M.comparator);function B(...n){let t=Il;for(let e of n)t=t.add(e);return t}var Tl=new ot(U);function El(){return Tl}function lo(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pn(t)?"-0":t}}function Ru(n){return{integerValue:""+n}}function Al(n,t){return il(t)?Ru(t):lo(n,t)}var ke=class{constructor(){this._=void 0}};function Sl(n,t,e){return n instanceof Fe?function(s,o){let u={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&so(o)&&(o=Mr(o)),o&&(u.fields.__previous_value__=o),{mapValue:u}}(e,t):n instanceof ue?Pu(n,t):n instanceof ce?Vu(n,t):function(s,o){let u=bu(s,o),l=Ka(u)+Ka(s.Pe);return Oi(u)&&Oi(s.Pe)?Ru(l):lo(s.serializer,l)}(n,t)}function Rl(n,t,e){return n instanceof ue?Pu(n,t):n instanceof ce?Vu(n,t):e}function bu(n,t){return n instanceof Me?function(r){return Oi(r)||function(o){return!!o&&"doubleValue"in o}(r)}(t)?t:{integerValue:0}:null}var Fe=class extends ke{},ue=class extends ke{constructor(t){super(),this.elements=t}};function Pu(n,t){let e=xu(t);for(let r of n.elements)e.some(s=>Ct(s,r))||e.push(r);return{arrayValue:{values:e}}}var ce=class extends ke{constructor(t){super(),this.elements=t}};function Vu(n,t){let e=xu(t);for(let r of n.elements)e=e.filter(s=>!Ct(s,r));return{arrayValue:{values:e}}}var Me=class extends ke{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Ka(n){return X(n.integerValue||n.doubleValue)}function xu(n){return oo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function bl(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof ue&&s instanceof ue||r instanceof ce&&s instanceof ce?Pe(r.elements,s.elements,Ct):r instanceof Me&&s instanceof Me?Ct(r.Pe,s.Pe):r instanceof Fe&&s instanceof Fe}(n.transform,t.transform)}var Hi=class{constructor(t,e){this.version=t,this.transformResults=e}},se=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function er(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Oe=class{};function Cu(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new cr(n.key,se.none()):new le(n.key,n.data,se.none());{let e=n.data,r=At.empty(),s=new ot(yt.comparator);for(let o of t.fields)if(!s.has(o)){let u=e.field(o);u===null&&o.length>1&&(o=o.popLast(),u=e.field(o)),u===null?r.delete(o):r.set(o,u),s=s.add(o)}return new zt(n.key,r,new bt(s.toArray()),se.none())}}function Pl(n,t,e){n instanceof le?function(s,o,u){let l=s.value.clone(),d=Qa(s.fieldTransforms,o,u.transformResults);l.setAll(d),o.convertToFoundDocument(u.version,l).setHasCommittedMutations()}(n,t,e):n instanceof zt?function(s,o,u){if(!er(s.precondition,o))return void o.convertToUnknownDocument(u.version);let l=Qa(s.fieldTransforms,o,u.transformResults),d=o.data;d.setAll(Du(s)),d.setAll(l),o.convertToFoundDocument(u.version,d).setHasCommittedMutations()}(n,t,e):function(s,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()}(0,t,e)}function gn(n,t,e,r){return n instanceof le?function(o,u,l,d){if(!er(o.precondition,u))return l;let f=o.value.clone(),_=Wa(o.fieldTransforms,d,u);return f.setAll(_),u.convertToFoundDocument(u.version,f).setHasLocalMutations(),null}(n,t,e,r):n instanceof zt?function(o,u,l,d){if(!er(o.precondition,u))return l;let f=Wa(o.fieldTransforms,d,u),_=u.data;return _.setAll(Du(o)),_.setAll(f),u.convertToFoundDocument(u.version,_).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(E=>E.field))}(n,t,e,r):function(o,u,l){return er(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):l}(n,t,e)}function Vl(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),o=bu(r.transform,s||null);o!=null&&(e===null&&(e=At.empty()),e.set(r.field,o))}return e||null}function $a(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Pe(r,s,(o,u)=>bl(o,u))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var le=class extends Oe{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},zt=class extends Oe{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Du(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Qa(n,t,e){let r=new Map;Q(n.length===e.length);for(let s=0;s<e.length;s++){let o=n[s],u=o.transform,l=t.data.field(o.field);r.set(o.field,Rl(u,l,e[s]))}return r}function Wa(n,t,e){let r=new Map;for(let s of n){let o=s.transform,u=e.data.field(s.field);r.set(s.field,Sl(o,u,t))}return r}var cr=class extends Oe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ji=class extends Oe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Xi=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&Pl(o,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=gn(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=gn(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=Su();return this.mutations.forEach(s=>{let o=t.get(s.key),u=o.overlayedDocument,l=this.applyToLocalView(u,o.mutatedFields);l=e.has(s.key)?null:l;let d=Cu(u,l);d!==null&&r.set(s.key,d),u.isValidDocument()||u.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),B())}isEqual(t){return this.batchId===t.batchId&&Pe(this.mutations,t.mutations,(e,r)=>$a(e,r))&&Pe(this.baseMutations,t.baseMutations,(e,r)=>$a(e,r))}},Yi=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){Q(t.mutations.length===r.length);let s=function(){return vl}(),o=t.mutations;for(let u=0;u<o.length;u++)s=s.insert(o[u].key,r[u].version);return new n(t,e,r,s)}};var Zi=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ts=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var nt,G;function xl(n){switch(n){default:return O();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function Nu(n){if(n===void 0)return Lt("GRPC error has no .code"),R.UNKNOWN;switch(n){case nt.OK:return R.OK;case nt.CANCELLED:return R.CANCELLED;case nt.UNKNOWN:return R.UNKNOWN;case nt.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case nt.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case nt.INTERNAL:return R.INTERNAL;case nt.UNAVAILABLE:return R.UNAVAILABLE;case nt.UNAUTHENTICATED:return R.UNAUTHENTICATED;case nt.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case nt.NOT_FOUND:return R.NOT_FOUND;case nt.ALREADY_EXISTS:return R.ALREADY_EXISTS;case nt.PERMISSION_DENIED:return R.PERMISSION_DENIED;case nt.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case nt.ABORTED:return R.ABORTED;case nt.OUT_OF_RANGE:return R.OUT_OF_RANGE;case nt.UNIMPLEMENTED:return R.UNIMPLEMENTED;case nt.DATA_LOSS:return R.DATA_LOSS;default:return O()}}(G=nt||(nt={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";var Ha=null;function Cl(){return new TextEncoder}var Dl=new Mt([4294967295,4294967295],0);function Ja(n){let t=Cl().encode(n),e=new pi;return e.update(t),new Uint8Array(e.digest())}function Xa(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new Mt([e,r],0),new Mt([s,o],0)]}var es=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new ie(`Invalid padding: ${e}`);if(r<0)throw new ie(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new ie(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new ie(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ie=Mt.fromNumber(this.Te)}de(t,e,r){let s=t.add(e.multiply(Mt.fromNumber(r)));return s.compare(Dl)===1&&(s=new Mt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ie).toNumber()}Ee(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=Ja(t),[r,s]=Xa(e);for(let o=0;o<this.hashCount;o++){let u=this.de(r,s,o);if(!this.Ee(u))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),u=new n(o,s,e);return r.forEach(l=>u.insert(l)),u}insert(t){if(this.Te===0)return;let e=Ja(t),[r,s]=Xa(e);for(let o=0;o<this.hashCount;o++){let u=this.de(r,s,o);this.Ae(u)}}Ae(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},ie=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var lr=class n{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,wn.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(q.min(),s,new et(U),Gt(),B())}},wn=class n{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,B(),B(),B())}};var Se=class{constructor(t,e,r,s){this.Re=t,this.removedTargetIds=e,this.key=r,this.Ve=s}},hr=class{constructor(t,e){this.targetId=t,this.me=e}},dr=class{constructor(t,e,r=mt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},fr=class{constructor(){this.fe=0,this.ge=Ya(),this.pe=mt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=B(),e=B(),r=B();return this.ge.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:O()}}),new wn(this.pe,this.ye,t,e,r)}Ce(){this.we=!1,this.ge=Ya()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,Q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},ns=class{constructor(t){this.Be=t,this.Le=new Map,this.ke=Gt(),this.qe=Xn(),this.Qe=Xn(),this.Ke=new et(U)}$e(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.Ue(e,t.Ve):this.We(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.We(e,t.key,t.Ve)}Ge(t){this.forEachTarget(t,e=>{let r=this.ze(e);switch(t.state){case 0:this.je(e)&&r.De(t.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(t.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(e);break;case 3:this.je(e)&&(r.Ne(),r.De(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),r.De(t.resumeToken));break;default:O()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Le.forEach((r,s)=>{this.je(s)&&e(s)})}Je(t){let e=t.targetId,r=t.me.count,s=this.Ye(e);if(s){let o=s.target;if(Qi(o))if(r===0){let u=new M(o.path);this.We(e,u,St.newNoDocument(u,q.min()))}else Q(r===1);else{let u=this.Ze(e);if(u!==r){let l=this.Xe(t),d=l?this.et(l,t,u):1;if(d!==0){this.He(e);let f=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,f)}Ha?.tt(function(_,E,S,P,N){var F,x,z,j,$,Y;let vt={localCacheCount:_,existenceFilterCount:E.count,databaseId:S.database,projectId:S.projectId},H=E.unchangedNames;return H&&(vt.bloomFilter={applied:N===0,hashCount:(F=H?.hashCount)!==null&&F!==void 0?F:0,bitmapLength:(j=(z=(x=H?.bits)===null||x===void 0?void 0:x.bitmap)===null||z===void 0?void 0:z.length)!==null&&j!==void 0?j:0,padding:(Y=($=H?.bits)===null||$===void 0?void 0:$.padding)!==null&&Y!==void 0?Y:0,mightContain:v=>{var m;return(m=P?.mightContain(v))!==null&&m!==void 0&&m}}),vt}(u,t.me,this.Be.nt(),l,d))}}}}Xe(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e,u,l;try{u=Bt(r).toUint8Array()}catch(d){if(d instanceof or)return be("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{l=new es(u,s,o)}catch(d){return be(d instanceof ie?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return l.Te===0?null:l}et(t,e,r){return e.me.count===r-this.rt(t,e.targetId)?0:2}rt(t,e){let r=this.Be.getRemoteKeysForTarget(e),s=0;return r.forEach(o=>{let u=this.Be.nt(),l=`projects/${u.projectId}/databases/${u.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.We(e,o,null),s++)}),s}it(t){let e=new Map;this.Le.forEach((o,u)=>{let l=this.Ye(u);if(l){if(o.current&&Qi(l.target)){let d=new M(l.target.path);this.st(d).has(u)||this.ot(u,d)||this.We(u,d,St.newNoDocument(d,t))}o.be&&(e.set(u,o.ve()),o.Ce())}});let r=B();this.Qe.forEach((o,u)=>{let l=!0;u.forEachWhile(d=>{let f=this.Ye(d);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.ke.forEach((o,u)=>u.setReadTime(t));let s=new lr(t,e,this.Ke,this.ke,r);return this.ke=Gt(),this.qe=Xn(),this.Qe=Xn(),this.Ke=new et(U),s}Ue(t,e){if(!this.je(t))return;let r=this.ot(t,e.key)?2:0;this.ze(t).Fe(e.key,r),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t)),this.Qe=this.Qe.insert(e.key,this._t(e.key).add(t))}We(t,e,r){if(!this.je(t))return;let s=this.ze(t);this.ot(t,e)?s.Fe(e,1):s.Me(e),this.Qe=this.Qe.insert(e,this._t(e).delete(t)),this.Qe=this.Qe.insert(e,this._t(e).add(t)),r&&(this.ke=this.ke.insert(e,r))}removeTarget(t){this.Le.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.ze(t).xe()}ze(t){let e=this.Le.get(t);return e||(e=new fr,this.Le.set(t,e)),e}_t(t){let e=this.Qe.get(t);return e||(e=new ot(U),this.Qe=this.Qe.insert(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new ot(U),this.qe=this.qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.Le.get(t);return e&&e.Se?null:this.Be.ut(t)}He(t){this.Le.set(t,new fr),this.Be.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}ot(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}};function Xn(){return new et(M.comparator)}function Ya(){return new et(M.comparator)}var Nl={asc:"ASCENDING",desc:"DESCENDING"},kl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Fl={and:"AND",or:"OR"},rs=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function is(n,t){return n.useProto3Json||Fr(t)?t:{value:t}}function mr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ku(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Ml(n,t){return mr(n,t.toTimestamp())}function xt(n){return Q(!!n),q.fromTimestamp(function(e){let r=qt(e);return new ut(r.seconds,r.nanos)}(n))}function ho(n,t){return ss(n,t).canonicalString()}function ss(n,t){let e=function(s){return new tt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function Fu(n){let t=tt.fromString(n);return Q(Bu(t)),t}function os(n,t){return ho(n.databaseId,t.path)}function Ti(n,t){let e=Fu(t);if(e.get(1)!==n.databaseId.projectId)throw new k(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new k(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(Ou(e))}function Mu(n,t){return ho(n.databaseId,t)}function Ol(n){let t=Fu(n);return t.length===4?tt.emptyPath():Ou(t)}function as(n){return new tt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ou(n){return Q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Za(n,t,e){return{name:os(n,t),fields:e.value.mapValue.fields}}function Ll(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:O()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=function(f,_){return f.useProto3Json?(Q(_===void 0||typeof _=="string"),mt.fromBase64String(_||"")):(Q(_===void 0||_ instanceof Buffer||_ instanceof Uint8Array),mt.fromUint8Array(_||new Uint8Array))}(n,t.targetChange.resumeToken),u=t.targetChange.cause,l=u&&function(f){let _=f.code===void 0?R.UNKNOWN:Nu(f.code);return new k(_,f.message||"")}(u);e=new dr(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=Ti(n,r.document.name),o=xt(r.document.updateTime),u=r.document.createTime?xt(r.document.createTime):q.min(),l=new At({mapValue:{fields:r.document.fields}}),d=St.newFoundDocument(s,o,u,l),f=r.targetIds||[],_=r.removedTargetIds||[];e=new Se(f,_,d.key,d)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=Ti(n,r.document),o=r.readTime?xt(r.readTime):q.min(),u=St.newNoDocument(s,o),l=r.removedTargetIds||[];e=new Se([],l,u.key,u)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=Ti(n,r.document),o=r.removedTargetIds||[];e=new Se([],o,s,null)}else{if(!("filter"in t))return O();{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:o}=r,u=new ts(s,o),l=r.targetId;e=new hr(l,u)}}return e}function ql(n,t){let e;if(t instanceof le)e={update:Za(n,t.key,t.value)};else if(t instanceof cr)e={delete:os(n,t.key)};else if(t instanceof zt)e={update:Za(n,t.key,t.data),updateMask:Wl(t.fieldMask)};else{if(!(t instanceof Ji))return O();e={verify:os(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(o,u){let l=u.transform;if(l instanceof Fe)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ue)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ce)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Me)return{fieldPath:u.field.canonicalString(),increment:l.Pe};throw O()}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Ml(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:O()}(n,t.precondition)),e}function Bl(n,t){return n&&n.length>0?(Q(t!==void 0),n.map(e=>function(s,o){let u=s.updateTime?xt(s.updateTime):xt(o);return u.isEqual(q.min())&&(u=xt(o)),new Hi(u,s.transformResults||[])}(e,t))):[]}function Ul(n,t){return{documents:[Mu(n,t.path)]}}function Gl(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Mu(n,s);let o=function(f){if(f.length!==0)return qu(Dt.create(f,"and"))}(t.filters);o&&(e.structuredQuery.where=o);let u=function(f){if(f.length!==0)return f.map(_=>function(S){return{field:Te(S.field),direction:Kl(S.dir)}}(_))}(t.orderBy);u&&(e.structuredQuery.orderBy=u);let l=is(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(t.endAt)),{ct:e,parent:s}}function zl(n){let t=Ol(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){Q(r===1);let _=e.from[0];_.allDescendants?s=_.collectionId:t=t.child(_.collectionId)}let o=[];e.where&&(o=function(E){let S=Lu(E);return S instanceof Dt&&_u(S)?S.getFilters():[S]}(e.where));let u=[];e.orderBy&&(u=function(E){return E.map(S=>function(N){return new De(Ee(N.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(S))}(e.orderBy));let l=null;e.limit&&(l=function(E){let S;return S=typeof E=="object"?E.value:E,Fr(S)?null:S}(e.limit));let d=null;e.startAt&&(d=function(E){let S=!!E.before,P=E.values||[];return new Ce(P,S)}(e.startAt));let f=null;return e.endAt&&(f=function(E){let S=!E.before,P=E.values||[];return new Ce(P,S)}(e.endAt)),ml(t,s,u,o,l,"F",d,f)}function jl(n,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Lu(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Ee(e.unaryFilter.field);return it.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Ee(e.unaryFilter.field);return it.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Ee(e.unaryFilter.field);return it.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let u=Ee(e.unaryFilter.field);return it.create(u,"!=",{nullValue:"NULL_VALUE"});default:return O()}}(n):n.fieldFilter!==void 0?function(e){return it.create(Ee(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return O()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Dt.create(e.compositeFilter.filters.map(r=>Lu(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return O()}}(e.compositeFilter.op))}(n):O()}function Kl(n){return Nl[n]}function $l(n){return kl[n]}function Ql(n){return Fl[n]}function Te(n){return{fieldPath:n.canonicalString()}}function Ee(n){return yt.fromServerFormat(n.fieldPath)}function qu(n){return n instanceof it?function(e){if(e.op==="=="){if(Ba(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NAN"}};if(qa(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ba(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NOT_NAN"}};if(qa(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Te(e.field),op:$l(e.op),value:e.value}}}(n):n instanceof Dt?function(e){let r=e.getFilters().map(s=>qu(s));return r.length===1?r[0]:{compositeFilter:{op:Ql(e.op),filters:r}}}(n):O()}function Wl(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Bu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var vn=class n{constructor(t,e,r,s,o=q.min(),u=q.min(),l=mt.EMPTY_BYTE_STRING,d=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var us=class{constructor(t){this.ht=t}};function Hl(n){let t=zl({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Wi(t,t.limit,"L"):t}var gr=class{constructor(){}dt(t,e){this.Et(t,e),e.At()}Et(t,e){if("nullValue"in t)this.Rt(e,5);else if("booleanValue"in t)this.Rt(e,10),e.Vt(t.booleanValue?1:0);else if("integerValue"in t)this.Rt(e,15),e.Vt(X(t.integerValue));else if("doubleValue"in t){let r=X(t.doubleValue);isNaN(r)?this.Rt(e,13):(this.Rt(e,15),pn(r)?e.Vt(0):e.Vt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Rt(e,20),typeof r=="string"&&(r=qt(r)),e.ft(`${r.seconds||""}`),e.Vt(r.nanos||0)}else if("stringValue"in t)this.gt(t.stringValue,e),this.yt(e);else if("bytesValue"in t)this.Rt(e,30),e.wt(Bt(t.bytesValue)),this.yt(e);else if("referenceValue"in t)this.St(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Rt(e,45),e.Vt(r.latitude||0),e.Vt(r.longitude||0)}else"mapValue"in t?mu(t)?this.Rt(e,Number.MAX_SAFE_INTEGER):fu(t)?this.bt(t.mapValue,e):(this.Dt(t.mapValue,e),this.yt(e)):"arrayValue"in t?(this.vt(t.arrayValue,e),this.yt(e)):O()}gt(t,e){this.Rt(e,25),this.Ct(t,e)}Ct(t,e){e.ft(t)}Dt(t,e){let r=t.fields||{};this.Rt(e,55);for(let s of Object.keys(r))this.gt(s,e),this.Et(r[s],e)}bt(t,e){var r,s;let o=t.fields||{};this.Rt(e,53);let u="value",l=((s=(r=o[u].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.Rt(e,15),e.Vt(X(l)),this.gt(u,e),this.Et(o[u],e)}vt(t,e){let r=t.values||[];this.Rt(e,50);for(let s of r)this.Et(s,e)}St(t,e){this.Rt(e,37),M.fromName(t).path.forEach(r=>{this.Rt(e,60),this.Ct(r,e)})}Rt(t,e){t.Vt(e)}yt(t){t.Vt(2)}};gr.Ft=new gr;var cs=class{constructor(){this.ln=new ls}addToCollectionParentIndex(t,e){return this.ln.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.ln.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(ae.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(ae.min())}updateCollectionGroup(t,e,r){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},ls=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new ot(tt.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new ot(tt.comparator)).toArray()}};var gd=new Uint8Array(0);var tu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},It=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};It.DEFAULT_COLLECTION_PERCENTILE=10,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,It.DEFAULT=new It(41943040,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),It.DISABLED=new It(-1,0,0);var In=class n{constructor(t){this.kn=t}next(){return this.kn+=2,this.kn}static qn(){return new n(0)}static Qn(){return new n(-1)}};function eu([n,t],[e,r]){let s=U(n,e);return s===0?U(t,r):s}var hs=class{constructor(t){this.Gn=t,this.buffer=new ot(eu),this.zn=0}jn(){return++this.zn}Hn(t){let e=[t,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();eu(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},ds=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(t){D("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>C(this,null,function*(){this.Jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ge(e)?D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Ue(e)}yield this.Yn(3e5)}))}},fs=class{constructor(t,e){this.Zn=t,this.params=e}calculateTargetCount(t,e){return this.Zn.Xn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return b.resolve(io.oe);let r=new hs(e);return this.Zn.forEachTarget(t,s=>r.Hn(s.sequenceNumber)).next(()=>this.Zn.er(t,s=>r.Hn(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.Zn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.Zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(tu)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tu):this.tr(t,e))}getCacheSize(t){return this.Zn.getCacheSize(t)}tr(t,e){let r,s,o,u,l,d,f,_=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(E=>(E>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,u=Date.now(),this.nthSequenceNumber(t,s))).next(E=>(r=E,l=Date.now(),this.removeTargets(t,r,e))).next(E=>(o=E,d=Date.now(),this.removeOrphanedDocuments(t,r))).next(E=>(f=Date.now(),ve()<=Rt.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-_}ms
	Determined least recently used ${s} in `+(l-u)+`ms
	Removed ${o} targets in `+(d-l)+`ms
	Removed ${E} documents in `+(f-d)+`ms
Total Duration: ${f-_}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E})))}};function Jl(n,t){return new fs(n,t)}var ms=class{constructor(){this.changes=new Ut(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,St.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?b.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var gs=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var ps=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&gn(r.mutation,s,bt.empty(),ut.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,B()).next(()=>r))}getLocalViewOfDocuments(t,e,r=B()){let s=re();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let u=hn();return o.forEach((l,d)=>{u=u.insert(l,d.overlayedDocument)}),u}))}getOverlayedDocuments(t,e){let r=re();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,B()))}populateOverlays(t,e,r){let s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((u,l)=>{e.set(u,l)})})}computeViews(t,e,r,s){let o=Gt(),u=mn(),l=function(){return mn()}();return e.forEach((d,f)=>{let _=r.get(f.key);s.has(f.key)&&(_===void 0||_.mutation instanceof zt)?o=o.insert(f.key,f):_!==void 0?(u.set(f.key,_.mutation.getFieldMask()),gn(_.mutation,f,_.mutation.getFieldMask(),ut.now())):u.set(f.key,bt.empty())}),this.recalculateAndSaveOverlays(t,o).next(d=>(d.forEach((f,_)=>u.set(f,_)),e.forEach((f,_)=>{var E;return l.set(f,new gs(_,(E=u.get(f))!==null&&E!==void 0?E:null))}),l))}recalculateAndSaveOverlays(t,e){let r=mn(),s=new et((u,l)=>u-l),o=B();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(u=>{for(let l of u)l.keys().forEach(d=>{let f=e.get(d);if(f===null)return;let _=r.get(d)||bt.empty();_=l.applyToLocalView(f,_),r.set(d,_);let E=(s.get(l.batchId)||B()).add(d);s=s.insert(l.batchId,E)})}).next(()=>{let u=[],l=s.getReverseIterator();for(;l.hasNext();){let d=l.getNext(),f=d.key,_=d.value,E=Su();_.forEach(S=>{if(!o.has(S)){let P=Cu(e.get(S),r.get(S));P!==null&&E.set(S,P),o=o.add(S)}}),u.push(this.documentOverlayCache.saveOverlays(t,f,E))}return b.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(u){return M.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):gl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{let u=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):b.resolve(re()),l=-1,d=o;return u.next(f=>b.forEach(f,(_,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(_)?b.resolve():this.remoteDocumentCache.getEntry(t,_).next(S=>{d=d.insert(_,S)}))).next(()=>this.populateOverlays(t,f,o)).next(()=>this.computeViews(t,d,f,B())).next(_=>({batchId:l,changes:Au(_)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(r=>{let s=hn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let o=e.collectionGroup,u=hn();return this.indexManager.getCollectionParents(t,o).next(l=>b.forEach(l,d=>{let f=function(E,S){return new Ne(S,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)}(e,d.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,r,s).next(_=>{_.forEach((E,S)=>{u=u.insert(E,S)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(u=>{o.forEach((d,f)=>{let _=f.getKey();u.get(_)===null&&(u=u.insert(_,St.newInvalidDocument(_)))});let l=hn();return u.forEach((d,f)=>{let _=o.get(d);_!==void 0&&gn(_.mutation,f,bt.empty(),ut.now()),Lr(e,f)&&(l=l.insert(d,f))}),l})}};var _s=class{constructor(t){this.serializer=t,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(t,e){return b.resolve(this.Tr.get(e))}saveBundleMetadata(t,e){return this.Tr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:xt(s.createTime)}}(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.Ir.get(e))}saveNamedQuery(t,e){return this.Ir.set(e.name,function(s){return{name:s.name,query:Hl(s.bundledQuery),readTime:xt(s.readTime)}}(e)),b.resolve()}};var ys=class{constructor(){this.overlays=new et(M.comparator),this.dr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let r=re();return b.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.Tt(t,e,o)}),b.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.dr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.dr.delete(r)),b.resolve()}getOverlaysForCollection(t,e,r){let s=re(),o=e.length+1,u=new M(e.child("")),l=this.overlays.getIteratorFrom(u);for(;l.hasNext();){let d=l.getNext().value,f=d.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&d.largestBatchId>r&&s.set(d.getKey(),d)}return b.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new et((f,_)=>f-_),u=this.overlays.getIterator();for(;u.hasNext();){let f=u.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>r){let _=o.get(f.largestBatchId);_===null&&(_=re(),o=o.insert(f.largestBatchId,_)),_.set(f.getKey(),f)}}let l=re(),d=o.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,_)=>l.set(f,_)),!(l.size()>=s)););return b.resolve(l)}Tt(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let u=this.dr.get(s.largestBatchId).delete(r.key);this.dr.set(s.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new Zi(e,r));let o=this.dr.get(e);o===void 0&&(o=B(),this.dr.set(e,o)),this.dr.set(e,o.add(r.key))}};var ws=class{constructor(){this.sessionToken=mt.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}};var Tn=class{constructor(){this.Er=new ot(rt.Ar),this.Rr=new ot(rt.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(t,e){let r=new rt(t,e);this.Er=this.Er.add(r),this.Rr=this.Rr.add(r)}mr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.gr(new rt(t,e))}pr(t,e){t.forEach(r=>this.removeReference(r,e))}yr(t){let e=new M(new tt([])),r=new rt(e,t),s=new rt(e,t+1),o=[];return this.Rr.forEachInRange([r,s],u=>{this.gr(u),o.push(u.key)}),o}wr(){this.Er.forEach(t=>this.gr(t))}gr(t){this.Er=this.Er.delete(t),this.Rr=this.Rr.delete(t)}Sr(t){let e=new M(new tt([])),r=new rt(e,t),s=new rt(e,t+1),o=B();return this.Rr.forEachInRange([r,s],u=>{o=o.add(u.key)}),o}containsKey(t){let e=new rt(t,0),r=this.Er.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},rt=class{constructor(t,e){this.key=t,this.br=e}static Ar(t,e){return M.comparator(t.key,e.key)||U(t.br,e.br)}static Vr(t,e){return U(t.br,e.br)||M.comparator(t.key,e.key)}};var vs=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Dr=1,this.vr=new ot(rt.Ar)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let o=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let u=new Xi(o,e,r,s);this.mutationQueue.push(u);for(let l of s)this.vr=this.vr.add(new rt(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return b.resolve(u)}lookupMutationBatch(t,e){return b.resolve(this.Cr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.Fr(r),o=s<0?0:s;return b.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new rt(e,0),s=new rt(e,Number.POSITIVE_INFINITY),o=[];return this.vr.forEachInRange([r,s],u=>{let l=this.Cr(u.br);o.push(l)}),b.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new ot(U);return e.forEach(s=>{let o=new rt(s,0),u=new rt(s,Number.POSITIVE_INFINITY);this.vr.forEachInRange([o,u],l=>{r=r.add(l.br)})}),b.resolve(this.Mr(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,o=r;M.isDocumentKey(o)||(o=o.child(""));let u=new rt(new M(o),0),l=new ot(U);return this.vr.forEachWhile(d=>{let f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(d.br)),!0)},u),b.resolve(this.Mr(l))}Mr(t){let e=[];return t.forEach(r=>{let s=this.Cr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){Q(this.Or(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.vr;return b.forEach(e.mutations,s=>{let o=new rt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.vr=r})}Bn(t){}containsKey(t,e){let r=new rt(e,0),s=this.vr.firstAfterOrEqual(r);return b.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}Or(t,e){return this.Fr(t)}Fr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Cr(t){let e=this.Fr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Is=class{constructor(t){this.Nr=t,this.docs=function(){return new et(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),o=s?s.size:0,u=this.Nr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return b.resolve(r?r.document.mutableCopy():St.newInvalidDocument(e))}getEntries(t,e){let r=Gt();return e.forEach(s=>{let o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():St.newInvalidDocument(s))}),b.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Gt(),u=e.path,l=new M(u.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){let{key:f,value:{document:_}}=d.getNext();if(!u.isPrefixOf(f.path))break;f.path.length>u.length+1||el(tl(_),r)<=0||(s.has(_.key)||Lr(e,_))&&(o=o.insert(_.key,_.mutableCopy()))}return b.resolve(o)}getAllFromCollectionGroup(t,e,r,s){O()}Br(t,e){return b.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Ts(this)}getSize(t){return b.resolve(this.size)}},Ts=class extends ms{constructor(t){super(),this.hr=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.hr.addEntry(t,s)):this.hr.removeEntry(r)}),b.waitFor(e)}getFromCache(t,e){return this.hr.getEntry(t,e)}getAllFromCache(t,e){return this.hr.getEntries(t,e)}};var Es=class{constructor(t){this.persistence=t,this.Lr=new Ut(e=>ao(e),uo),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.kr=0,this.qr=new Tn,this.targetCount=0,this.Qr=In.qn()}forEachTarget(t,e){return this.Lr.forEach((r,s)=>e(s)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.kr)}allocateTargetId(t){return this.highestTargetId=this.Qr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.kr&&(this.kr=e),b.resolve()}Un(t){this.Lr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Qr=new In(e),this.highestTargetId=e),t.sequenceNumber>this.kr&&(this.kr=t.sequenceNumber)}addTargetData(t,e){return this.Un(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.Un(e),b.resolve()}removeTargetData(t,e){return this.Lr.delete(e.target),this.qr.yr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,r){let s=0,o=[];return this.Lr.forEach((u,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.Lr.delete(u),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),b.waitFor(o).next(()=>s)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let r=this.Lr.get(e)||null;return b.resolve(r)}addMatchingKeys(t,e,r){return this.qr.mr(e,r),b.resolve()}removeMatchingKeys(t,e,r){this.qr.pr(e,r);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(u=>{o.push(s.markPotentiallyOrphaned(t,u))}),b.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.qr.yr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let r=this.qr.Sr(e);return b.resolve(r)}containsKey(t,e){return b.resolve(this.qr.containsKey(e))}};var pr=class{constructor(t,e){this.Kr={},this.overlays={},this.$r=new io(0),this.Ur=!1,this.Ur=!0,this.Wr=new ws,this.referenceDelegate=t(this),this.Gr=new Es(this),this.indexManager=new cs,this.remoteDocumentCache=function(s){return new Is(s)}(r=>this.referenceDelegate.zr(r)),this.serializer=new us(e),this.jr=new _s(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new ys,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Kr[t.toKey()];return r||(r=new vs(e,this.referenceDelegate),this.Kr[t.toKey()]=r),r}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(t,e,r){D("MemoryPersistence","Starting transaction:",t);let s=new As(this.$r.next());return this.referenceDelegate.Hr(),r(s).next(o=>this.referenceDelegate.Jr(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Yr(t,e){return b.or(Object.values(this.Kr).map(r=>()=>r.containsKey(t,e)))}},As=class extends ki{constructor(t){super(),this.currentSequenceNumber=t}},Ss=class n{constructor(t){this.persistence=t,this.Zr=new Tn,this.Xr=null}static ei(t){return new n(t)}get ti(){if(this.Xr)return this.Xr;throw O()}addReference(t,e,r){return this.Zr.addReference(r,e),this.ti.delete(r.toString()),b.resolve()}removeReference(t,e,r){return this.Zr.removeReference(r,e),this.ti.add(r.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.ti.add(e.toString()),b.resolve()}removeTarget(t,e){this.Zr.yr(e.targetId).forEach(s=>this.ti.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.ti.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Hr(){this.Xr=new Set}Jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.ti,r=>{let s=M.fromPath(r);return this.ni(t,s).next(o=>{o||e.removeEntry(s,q.min())})}).next(()=>(this.Xr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ni(t,e).next(r=>{r?this.ti.delete(e.toString()):this.ti.add(e.toString())})}zr(t){return 0}ni(t,e){return b.or([()=>b.resolve(this.Zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Yr(t,e)])}},_r=class n{constructor(t,e){this.persistence=t,this.ri=new Ut(r=>sl(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Jl(this,e)}static ei(t,e){return new n(t,e)}Hr(){}Jr(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Xn(t){let e=this.nr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}nr(t){let e=0;return this.er(t,r=>{e++}).next(()=>e)}er(t,e){return b.forEach(this.ri,(r,s)=>this.ir(t,r,s).next(o=>o?b.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.Br(t,u=>this.ir(t,u,e).next(l=>{l||(r++,o.removeEntry(u,q.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.ri.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.ri.set(r,t.currentSequenceNumber),b.resolve()}removeReference(t,e,r){return this.ri.set(r,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.ri.set(e,t.currentSequenceNumber),b.resolve()}zr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Zn(t.data.value)),e}ir(t,e,r){return b.or([()=>this.persistence.Yr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.ri.get(e);return b.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Rs=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Wi=r,this.Gi=s}static zi(t,e){let r=B(),s=B();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new n(t,e.fromCache,r,s)}};var bs=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Ps=class{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return Aa()?8:rl(Ea())>0?6:4}()}initialize(t,e){this.Zi=t,this.indexManager=e,this.ji=!0}getDocumentsMatchingQuery(t,e,r,s){let o={result:null};return this.Xi(t,e).next(u=>{o.result=u}).next(()=>{if(!o.result)return this.es(t,e,s,r).next(u=>{o.result=u})}).next(()=>{if(o.result)return;let u=new bs;return this.ts(t,e,u).next(l=>{if(o.result=l,this.Hi)return this.ns(t,e,u,l.size)})}).next(()=>o.result)}ns(t,e,r,s){return r.documentReadCount<this.Ji?(ve()<=Rt.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Ie(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),b.resolve()):(ve()<=Rt.DEBUG&&D("QueryEngine","Query:",Ie(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Yi*s?(ve()<=Rt.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Ie(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Vt(e))):b.resolve())}Xi(t,e){if(ja(e))return b.resolve(null);let r=Vt(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Wi(e,null,"F"),r=Vt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let u=B(...o);return this.Zi.getDocuments(t,u).next(l=>this.indexManager.getMinOffset(t,r).next(d=>{let f=this.rs(e,l);return this.ss(e,f,u,d.readTime)?this.Xi(t,Wi(e,null,"F")):this.os(t,f,e,d)}))})))}es(t,e,r,s){return ja(e)||s.isEqual(q.min())?b.resolve(null):this.Zi.getDocuments(t,r).next(o=>{let u=this.rs(e,o);return this.ss(e,u,r,s)?b.resolve(null):(ve()<=Rt.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ie(e)),this.os(t,u,e,Zc(s,-1)).next(l=>l))})}rs(t,e){let r=new ot(Tu(t));return e.forEach((s,o)=>{Lr(t,o)&&(r=r.add(o))}),r}ss(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ts(t,e,r){return ve()<=Rt.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Ie(e)),this.Zi.getDocumentsMatchingQuery(t,e,ae.min(),r)}os(t,e,r,s){return this.Zi.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(u=>{o=o.insert(u.key,u)}),o))}};var Vs=class{constructor(t,e,r,s){this.persistence=t,this._s=e,this.serializer=s,this.us=new et(U),this.cs=new Ut(o=>ao(o),uo),this.ls=new Map,this.hs=t.getRemoteDocumentCache(),this.Gr=t.getTargetCache(),this.jr=t.getBundleCache(),this.Ps(r)}Ps(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ps(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.us))}};function Xl(n,t,e,r){return new Vs(n,t,e,r)}function Uu(n,t){return C(this,null,function*(){let e=L(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.Ps(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let u=[],l=[],d=B();for(let f of s){u.push(f.batchId);for(let _ of f.mutations)d=d.add(_.key)}for(let f of o){l.push(f.batchId);for(let _ of f.mutations)d=d.add(_.key)}return e.localDocuments.getDocuments(r,d).next(f=>({Ts:f,removedBatchIds:u,addedBatchIds:l}))})})})}function Yl(n,t){let e=L(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),o=e.hs.newChangeBuffer({trackRemovals:!0});return function(l,d,f,_){let E=f.batch,S=E.keys(),P=b.resolve();return S.forEach(N=>{P=P.next(()=>_.getEntry(d,N)).next(F=>{let x=f.docVersions.get(N);Q(x!==null),F.version.compareTo(x)<0&&(E.applyToRemoteDocument(F,f),F.isValidDocument()&&(F.setReadTime(f.commitVersion),_.addEntry(F)))})}),P.next(()=>l.mutationQueue.removeMutationBatch(d,E))}(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let d=B();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(d=d.add(l.batch.mutations[f].key));return d}(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function Gu(n){let t=L(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Gr.getLastRemoteSnapshotVersion(e))}function Zl(n,t){let e=L(n),r=t.snapshotVersion,s=e.us;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let u=e.hs.newChangeBuffer({trackRemovals:!0});s=e.us;let l=[];t.targetChanges.forEach((_,E)=>{let S=s.get(E);if(!S)return;l.push(e.Gr.removeMatchingKeys(o,_.removedDocuments,E).next(()=>e.Gr.addMatchingKeys(o,_.addedDocuments,E)));let P=S.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(E)!==null?P=P.withResumeToken(mt.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):_.resumeToken.approximateByteSize()>0&&(P=P.withResumeToken(_.resumeToken,r)),s=s.insert(E,P),function(F,x,z){return F.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=3e8?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(S,P,_)&&l.push(e.Gr.updateTargetData(o,P))});let d=Gt(),f=B();if(t.documentUpdates.forEach(_=>{t.resolvedLimboDocuments.has(_)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,_))}),l.push(th(o,u,t.documentUpdates).next(_=>{d=_.Is,f=_.ds})),!r.isEqual(q.min())){let _=e.Gr.getLastRemoteSnapshotVersion(o).next(E=>e.Gr.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(_)}return b.waitFor(l).next(()=>u.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,d,f)).next(()=>d)}).then(o=>(e.us=s,o))}function th(n,t,e){let r=B(),s=B();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let u=Gt();return e.forEach((l,d)=>{let f=o.get(l);d.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),d.isNoDocument()&&d.version.isEqual(q.min())?(t.removeEntry(l,d.readTime),u=u.insert(l,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||d.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(d),u=u.insert(l,d)):D("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",d.version)}),{Is:u,ds:s}})}function eh(n,t){let e=L(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function nh(n,t){let e=L(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.Gr.getTargetData(r,t).next(o=>o?(s=o,b.resolve(s)):e.Gr.allocateTargetId(r).next(u=>(s=new vn(t,u,"TargetPurposeListen",r.currentSequenceNumber),e.Gr.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.us.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.us=e.us.insert(r.targetId,r),e.cs.set(t,r.targetId)),r})}function xs(n,t,e){return C(this,null,function*(){let r=L(n),s=r.us.get(t),o=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",o,u=>r.persistence.referenceDelegate.removeTarget(u,s)))}catch(u){if(!Ge(u))throw u;D("LocalStore",`Failed to update sequence numbers for target ${t}: ${u}`)}r.us=r.us.remove(t),r.cs.delete(s.target)})}function nu(n,t,e){let r=L(n),s=q.min(),o=B();return r.persistence.runTransaction("Execute query","readwrite",u=>function(d,f,_){let E=L(d),S=E.cs.get(_);return S!==void 0?b.resolve(E.us.get(S)):E.Gr.getTargetData(f,_)}(r,u,Vt(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(u,l.targetId).next(d=>{o=d})}).next(()=>r._s.getDocumentsMatchingQuery(u,t,e?s:q.min(),e?o:B())).next(l=>(rh(r,_l(t),l),{documents:l,Es:o})))}function rh(n,t,e){let r=n.ls.get(t)||q.min();e.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.ls.set(t,r)}var yr=class{constructor(){this.activeTargetIds=El()}ps(t){this.activeTargetIds=this.activeTargetIds.add(t)}ys(t){this.activeTargetIds=this.activeTargetIds.delete(t)}gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Cs=class{constructor(){this._o=new yr,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this._o.ps(t),this.ao[t]||"not-current"}updateQueryState(t,e,r){this.ao[t]=e}removeLocalQueryTarget(t){this._o.ys(t)}isLocalQueryTarget(t){return this._o.activeTargetIds.has(t)}clearQueryState(t){delete this.ao[t]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(t){return this._o.activeTargetIds.has(t)}start(){return this._o=new yr,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Ds=class{uo(t){}shutdown(){}};var wr=class{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(t){this.To.push(t)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.To)t(0)}Po(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.To)t(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Yn=null;function Ei(){return Yn===null?Yn=function(){return 268435456+Math.round(2147483648*Math.random())}():Yn++,"0x"+Yn.toString(16)}var ih={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Ns=class{constructor(t){this.Eo=t.Eo,this.Ao=t.Ao}Ro(t){this.Vo=t}mo(t){this.fo=t}po(t){this.yo=t}onMessage(t){this.wo=t}close(){this.Ao()}send(t){this.Eo(t)}So(){this.Vo()}bo(){this.fo()}Do(t){this.yo(t)}vo(t){this.wo(t)}};var ft="WebChannelConnection",ks=class extends class{get Co(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Fo=r+"://"+e.host,this.Mo=`projects/${s}/databases/${o}`,this.xo=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${o}`}Oo(e,r,s,o,u){let l=Ei(),d=this.No(e,r.toUriEncodedString());D("RestConnection",`Sending RPC '${e}' ${l}:`,d,s);let f={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(f,o,u),this.Lo(e,d,f,s).then(_=>(D("RestConnection",`Received RPC '${e}' ${l}: `,_),_),_=>{throw be("RestConnection",`RPC '${e}' ${l} failed with error: `,_,"url: ",d,"request:",s),_})}ko(e,r,s,o,u,l){return this.Oo(e,r,s,o,u)}Bo(e,r,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Be}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((o,u)=>e[u]=o),s&&s.headers.forEach((o,u)=>e[u]=o)}No(e,r){let s=ih[e];return`${this.Fo}/v1/${r}:${s}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Lo(t,e,r,s){let o=Ei();return new Promise((u,l)=>{let d=new _i;d.setWithCredentials(!0),d.listenOnce(yi.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case ln.NO_ERROR:let _=d.getResponseJson();D(ft,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(_)),u(_);break;case ln.TIMEOUT:D(ft,`RPC '${t}' ${o} timed out`),l(new k(R.DEADLINE_EXCEEDED,"Request time out"));break;case ln.HTTP_ERROR:let E=d.getStatus();if(D(ft,`RPC '${t}' ${o} failed with status:`,E,"response text:",d.getResponseText()),E>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);let P=S?.error;if(P&&P.status&&P.message){let N=function(x){let z=x.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(z)>=0?z:R.UNKNOWN}(P.status);l(new k(N,P.message))}else l(new k(R.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new k(R.UNAVAILABLE,"Connection failed."));break;default:O()}}finally{D(ft,`RPC '${t}' ${o} completed.`)}});let f=JSON.stringify(s);D(ft,`RPC '${t}' ${o} sending request:`,s),d.send(e,"POST",f,r,15)})}qo(t,e,r){let s=Ei(),o=[this.Fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],u=Ii(),l=vi(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(d.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Bo(d.initMessageHeaders,e,r),d.encodeInitMessageHeaders=!0;let _=o.join("");D(ft,`Creating RPC '${t}' stream ${s}: ${_}`,d);let E=u.createWebChannel(_,d),S=!1,P=!1,N=new Ns({Eo:x=>{P?D(ft,`Not sending because RPC '${t}' stream ${s} is closed:`,x):(S||(D(ft,`Opening RPC '${t}' stream ${s} transport.`),E.open(),S=!0),D(ft,`RPC '${t}' stream ${s} sending:`,x),E.send(x))},Ao:()=>E.close()}),F=(x,z,j)=>{x.listen(z,$=>{try{j($)}catch(Y){setTimeout(()=>{throw Y},0)}})};return F(E,we.EventType.OPEN,()=>{P||(D(ft,`RPC '${t}' stream ${s} transport opened.`),N.So())}),F(E,we.EventType.CLOSE,()=>{P||(P=!0,D(ft,`RPC '${t}' stream ${s} transport closed`),N.Do())}),F(E,we.EventType.ERROR,x=>{P||(P=!0,be(ft,`RPC '${t}' stream ${s} transport errored:`,x),N.Do(new k(R.UNAVAILABLE,"The operation could not be completed")))}),F(E,we.EventType.MESSAGE,x=>{var z;if(!P){let j=x.data[0];Q(!!j);let $=j,Y=$?.error||((z=$[0])===null||z===void 0?void 0:z.error);if(Y){D(ft,`RPC '${t}' stream ${s} received error:`,Y);let vt=Y.status,H=function(p){let y=nt[p];if(y!==void 0)return Nu(y)}(vt),v=Y.message;H===void 0&&(H=R.INTERNAL,v="Unknown error status: "+vt+" with message "+Y.message),P=!0,N.Do(new k(H,v)),E.close()}else D(ft,`RPC '${t}' stream ${s} received:`,j),N.vo(j)}}),F(l,wi.STAT_EVENT,x=>{x.stat===Hn.PROXY?D(ft,`RPC '${t}' stream ${s} detected buffering proxy`):x.stat===Hn.NOPROXY&&D(ft,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{N.bo()},0),N}};function Ai(){return typeof document<"u"?document:null}function qr(n){return new rs(n,!0)}var vr=class{constructor(t,e,r=1e3,s=1.5,o=6e4){this.li=t,this.timerId=e,this.Qo=r,this.Ko=s,this.$o=o,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(t){this.cancel();let e=Math.floor(this.Uo+this.Ho()),r=Math.max(0,Date.now()-this.Go),s=Math.max(0,e-r);s>0&&D("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Uo} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,s,()=>(this.Go=Date.now(),t())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}};var Ir=class{constructor(t,e,r,s,o,u,l,d){this.li=t,this.Yo=r,this.Zo=s,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new vr(t,e)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}stop(){return C(this,null,function*(){this.i_()&&(yield this.close(0))})}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(t){this.l_(),this.stream.send(t)}u_(){return C(this,null,function*(){if(this.s_())return this.close(0)})}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(t,e){return C(this,null,function*(){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,t!==4?this.r_.reset():e&&e.code===R.RESOURCE_EXHAUSTED?(Lt(e.toString()),Lt("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):e&&e.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.po(e)})}P_(){}auth(){this.state=1;let t=this.T_(this.Xo),e=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Xo===e&&this.I_(r,s)},r=>{t(()=>{let s=new k(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.d_(s)})})}I_(t,e){let r=this.T_(this.Xo);this.stream=this.E_(t,e),this.stream.Ro(()=>{r(()=>this.listener.Ro())}),this.stream.mo(()=>{r(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(s=>{r(()=>this.d_(s))}),this.stream.onMessage(s=>{r(()=>++this.n_==1?this.A_(s):this.onNext(s))})}o_(){this.state=5,this.r_.jo(()=>C(this,null,function*(){this.state=0,this.start()}))}d_(t){return D("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}T_(t){return e=>{this.li.enqueueAndForget(()=>this.Xo===t?e():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Fs=class extends Ir{constructor(t,e,r,s,o,u){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,u),this.serializer=o}E_(t,e){return this.connection.qo("Listen",t,e)}A_(t){return this.onNext(t)}onNext(t){this.r_.reset();let e=Ll(this.serializer,t),r=function(o){if(!("targetChange"in o))return q.min();let u=o.targetChange;return u.targetIds&&u.targetIds.length?q.min():u.readTime?xt(u.readTime):q.min()}(t);return this.listener.R_(e,r)}V_(t){let e={};e.database=as(this.serializer),e.addTarget=function(o,u){let l,d=u.target;if(l=Qi(d)?{documents:Ul(o,d)}:{query:Gl(o,d).ct},l.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){l.resumeToken=ku(o,u.resumeToken);let f=is(o,u.expectedCount);f!==null&&(l.expectedCount=f)}else if(u.snapshotVersion.compareTo(q.min())>0){l.readTime=mr(o,u.snapshotVersion.toTimestamp());let f=is(o,u.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,t);let r=jl(this.serializer,t);r&&(e.labels=r),this.c_(e)}m_(t){let e={};e.database=as(this.serializer),e.removeTarget=t,this.c_(e)}},Ms=class extends Ir{constructor(t,e,r,s,o,u){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,u),this.serializer=o}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(t,e){return this.connection.qo("Write",t,e)}A_(t){return Q(!!t.streamToken),this.lastStreamToken=t.streamToken,Q(!t.writeResults||t.writeResults.length===0),this.listener.p_()}onNext(t){Q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.r_.reset();let e=Bl(t.writeResults,t.commitTime),r=xt(t.commitTime);return this.listener.y_(r,e)}w_(){let t={};t.database=as(this.serializer),this.c_(t)}g_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>ql(this.serializer,r))};this.c_(e)}};var Os=class extends class{}{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.S_=!1}b_(){if(this.S_)throw new k(R.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(t,e,r,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Oo(t,ss(e,r),s,o,u)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(R.UNKNOWN,o.toString())})}ko(t,e,r,s,o){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,l])=>this.connection.ko(t,ss(e,r),s,u,l,o)).catch(u=>{throw u.name==="FirebaseError"?(u.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new k(R.UNKNOWN,u.toString())})}terminate(){this.S_=!0,this.connection.terminate()}},Ls=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(t){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.M_("Offline")))}set(t){this.N_(),this.D_=0,t==="Online"&&(this.C_=!1),this.M_(t)}M_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}x_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(Lt(e),this.C_=!1):D("OnlineStateTracker",e)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}};var qs=class{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=o,this.Q_.uo(u=>{r.enqueueAndForget(()=>C(this,null,function*(){fe(this)&&(D("RemoteStore","Restarting streams for network reachability change."),yield function(d){return C(this,null,function*(){let f=L(d);f.k_.add(4),yield Vn(f),f.K_.set("Unknown"),f.k_.delete(4),yield Br(f)})}(this))}))}),this.K_=new Ls(r,s)}};function Br(n){return C(this,null,function*(){if(fe(n))for(let t of n.q_)yield t(!0)})}function Vn(n){return C(this,null,function*(){for(let t of n.q_)yield t(!1)})}function zu(n,t){let e=L(n);e.L_.has(t.targetId)||(e.L_.set(t.targetId,t),po(e)?go(e):ze(e).s_()&&mo(e,t))}function fo(n,t){let e=L(n),r=ze(e);e.L_.delete(t),r.s_()&&ju(e,t),e.L_.size===0&&(r.s_()?r.a_():fe(e)&&e.K_.set("Unknown"))}function mo(n,t){if(n.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(q.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}ze(n).V_(t)}function ju(n,t){n.U_.xe(t),ze(n).m_(t)}function go(n){n.U_=new ns({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>n.L_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),ze(n).start(),n.K_.F_()}function po(n){return fe(n)&&!ze(n).i_()&&n.L_.size>0}function fe(n){return L(n).k_.size===0}function Ku(n){n.U_=void 0}function sh(n){return C(this,null,function*(){n.K_.set("Online")})}function oh(n){return C(this,null,function*(){n.L_.forEach((t,e)=>{mo(n,t)})})}function ah(n,t){return C(this,null,function*(){Ku(n),po(n)?(n.K_.O_(t),go(n)):n.K_.set("Unknown")})}function uh(n,t,e){return C(this,null,function*(){if(n.K_.set("Online"),t instanceof dr&&t.state===2&&t.cause)try{yield function(s,o){return C(this,null,function*(){let u=o.cause;for(let l of o.targetIds)s.L_.has(l)&&(yield s.remoteSyncer.rejectListen(l,u),s.L_.delete(l),s.U_.removeTarget(l))})}(n,t)}catch(r){D("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Tr(n,r)}else if(t instanceof Se?n.U_.$e(t):t instanceof hr?n.U_.Je(t):n.U_.Ge(t),!e.isEqual(q.min()))try{let r=yield Gu(n.localStore);e.compareTo(r)>=0&&(yield function(o,u){let l=o.U_.it(u);return l.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){let _=o.L_.get(f);_&&o.L_.set(f,_.withResumeToken(d.resumeToken,u))}}),l.targetMismatches.forEach((d,f)=>{let _=o.L_.get(d);if(!_)return;o.L_.set(d,_.withResumeToken(mt.EMPTY_BYTE_STRING,_.snapshotVersion)),ju(o,d);let E=new vn(_.target,d,f,_.sequenceNumber);mo(o,E)}),o.remoteSyncer.applyRemoteEvent(l)}(n,e))}catch(r){D("RemoteStore","Failed to raise snapshot:",r),yield Tr(n,r)}})}function Tr(n,t,e){return C(this,null,function*(){if(!Ge(t))throw t;n.k_.add(1),yield Vn(n),n.K_.set("Offline"),e||(e=()=>Gu(n.localStore)),n.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){D("RemoteStore","Retrying IndexedDB access"),yield e(),n.k_.delete(1),yield Br(n)}))})}function $u(n,t){return t().catch(e=>Tr(n,e,t))}function Ur(n){return C(this,null,function*(){let t=L(n),e=Xt(t),r=t.B_.length>0?t.B_[t.B_.length-1].batchId:-1;for(;ch(t);)try{let s=yield eh(t.localStore,r);if(s===null){t.B_.length===0&&e.a_();break}r=s.batchId,lh(t,s)}catch(s){yield Tr(t,s)}Qu(t)&&Wu(t)})}function ch(n){return fe(n)&&n.B_.length<10}function lh(n,t){n.B_.push(t);let e=Xt(n);e.s_()&&e.f_&&e.g_(t.mutations)}function Qu(n){return fe(n)&&!Xt(n).i_()&&n.B_.length>0}function Wu(n){Xt(n).start()}function hh(n){return C(this,null,function*(){Xt(n).w_()})}function dh(n){return C(this,null,function*(){let t=Xt(n);for(let e of n.B_)t.g_(e.mutations)})}function fh(n,t,e){return C(this,null,function*(){let r=n.B_.shift(),s=Yi.from(r,t,e);yield $u(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield Ur(n)})}function mh(n,t){return C(this,null,function*(){t&&Xt(n).f_&&(yield function(r,s){return C(this,null,function*(){if(function(u){return xl(u)&&u!==R.ABORTED}(s.code)){let o=r.B_.shift();Xt(r).__(),yield $u(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Ur(r)}})}(n,t)),Qu(n)&&Wu(n)})}function ru(n,t){return C(this,null,function*(){let e=L(n);e.asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials");let r=fe(e);e.k_.add(3),yield Vn(e),r&&e.K_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.k_.delete(3),yield Br(e)})}function gh(n,t){return C(this,null,function*(){let e=L(n);t?(e.k_.delete(2),yield Br(e)):t||(e.k_.add(2),yield Vn(e),e.K_.set("Unknown"))})}function ze(n){return n.W_||(n.W_=function(e,r,s){let o=L(e);return o.b_(),new Fs(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Ro:sh.bind(null,n),mo:oh.bind(null,n),po:ah.bind(null,n),R_:uh.bind(null,n)}),n.q_.push(t=>C(this,null,function*(){t?(n.W_.__(),po(n)?go(n):n.K_.set("Unknown")):(yield n.W_.stop(),Ku(n))}))),n.W_}function Xt(n){return n.G_||(n.G_=function(e,r,s){let o=L(e);return o.b_(),new Ms(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Ro:()=>Promise.resolve(),mo:hh.bind(null,n),po:mh.bind(null,n),p_:dh.bind(null,n),y_:fh.bind(null,n)}),n.q_.push(t=>C(this,null,function*(){t?(n.G_.__(),yield Ur(n)):(yield n.G_.stop(),n.B_.length>0&&(D("RemoteStore",`Stopping write stream with ${n.B_.length} pending writes`),n.B_=[]))}))),n.G_}var Bs=class n{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Tt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){let u=Date.now()+r,l=new n(t,e,u,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(R.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Gr(n,t){if(Lt("AsyncQueue",`${t}: ${n}`),Ge(n))return new k(R.UNAVAILABLE,`${t}: ${n}`);throw n}var Er=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=hn(),this.sortedSet=new et(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Ar=class{constructor(){this.z_=new et(M.comparator)}track(t){let e=t.doc.key,r=this.z_.get(e);r?t.type!==0&&r.type===3?this.z_=this.z_.insert(e,t):t.type===3&&r.type!==1?this.z_=this.z_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.z_=this.z_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.z_=this.z_.remove(e):t.type===1&&r.type===2?this.z_=this.z_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):O():this.z_=this.z_.insert(e,t)}j_(){let t=[];return this.z_.inorderTraversal((e,r)=>{t.push(r)}),t}},Le=class n{constructor(t,e,r,s,o,u,l,d,f){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(t,e,r,s,o){let u=[];return e.forEach(l=>{u.push({type:0,doc:l})}),new n(t,e,Er.emptySet(e),u,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Or(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var Us=class{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(t=>t.Z_())}},Gs=class{constructor(){this.queries=iu(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(e,r){let s=L(e),o=s.queries;s.queries=iu(),o.forEach((u,l)=>{for(let d of l.J_)d.onError(r)})})(this,new k(R.ABORTED,"Firestore shutting down"))}};function iu(){return new Ut(n=>Iu(n),Or)}function Hu(n,t){return C(this,null,function*(){let e=L(n),r=3,s=t.query,o=e.queries.get(s);o?!o.Y_()&&t.Z_()&&(r=2):(o=new Us,r=t.Z_()?0:1);try{switch(r){case 0:o.H_=yield e.onListen(s,!0);break;case 1:o.H_=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(u){let l=Gr(u,`Initialization of query '${Ie(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.J_.push(t),t.ea(e.onlineState),o.H_&&t.ta(o.H_)&&_o(e)})}function Ju(n,t){return C(this,null,function*(){let e=L(n),r=t.query,s=3,o=e.queries.get(r);if(o){let u=o.J_.indexOf(t);u>=0&&(o.J_.splice(u,1),o.J_.length===0?s=t.Z_()?0:1:!o.Y_()&&t.Z_()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function ph(n,t){let e=L(n),r=!1;for(let s of t){let o=s.query,u=e.queries.get(o);if(u){for(let l of u.J_)l.ta(s)&&(r=!0);u.H_=s}}r&&_o(e)}function _h(n,t,e){let r=L(n),s=r.queries.get(t);if(s)for(let o of s.J_)o.onError(e);r.queries.delete(t)}function _o(n){n.X_.forEach(t=>{t.next()})}var zs,su;(su=zs||(zs={})).na="default",su.Cache="cache";var Sr=class{constructor(t,e,r){this.query=t,this.ra=e,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=r||{}}ta(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new Le(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ia?this.oa(t)&&(this.ra.next(t),e=!0):this._a(t,this.onlineState)&&(this.aa(t),e=!0),this.sa=t,e}onError(t){this.ra.error(t)}ea(t){this.onlineState=t;let e=!1;return this.sa&&!this.ia&&this._a(this.sa,t)&&(this.aa(this.sa),e=!0),e}_a(t,e){if(!t.fromCache||!this.Z_())return!0;let r=e!=="Offline";return(!this.options.ua||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}oa(t){if(t.docChanges.length>0)return!0;let e=this.sa&&this.sa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}aa(t){t=Le.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ia=!0,this.ra.next(t)}Z_(){return this.options.source!==zs.Cache}};var Rr=class{constructor(t){this.key=t}},br=class{constructor(t){this.key=t}},js=class{constructor(t,e){this.query=t,this.Ea=e,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=B(),this.mutatedKeys=B(),this.Va=Tu(t),this.ma=new Er(this.Va)}get fa(){return this.Ea}ga(t,e){let r=e?e.pa:new Ar,s=e?e.ma:this.ma,o=e?e.mutatedKeys:this.mutatedKeys,u=s,l=!1,d=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((_,E)=>{let S=s.get(_),P=Lr(this.query,E)?E:null,N=!!S&&this.mutatedKeys.has(S.key),F=!!P&&(P.hasLocalMutations||this.mutatedKeys.has(P.key)&&P.hasCommittedMutations),x=!1;S&&P?S.data.isEqual(P.data)?N!==F&&(r.track({type:3,doc:P}),x=!0):this.ya(S,P)||(r.track({type:2,doc:P}),x=!0,(d&&this.Va(P,d)>0||f&&this.Va(P,f)<0)&&(l=!0)):!S&&P?(r.track({type:0,doc:P}),x=!0):S&&!P&&(r.track({type:1,doc:S}),x=!0,(d||f)&&(l=!0)),x&&(P?(u=u.add(P),o=F?o.add(_):o.delete(_)):(u=u.delete(_),o=o.delete(_)))}),this.query.limit!==null)for(;u.size>this.query.limit;){let _=this.query.limitType==="F"?u.last():u.first();u=u.delete(_.key),o=o.delete(_.key),r.track({type:1,doc:_})}return{ma:u,pa:r,ss:l,mutatedKeys:o}}ya(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let o=this.ma;this.ma=t.ma,this.mutatedKeys=t.mutatedKeys;let u=t.pa.j_();u.sort((_,E)=>function(P,N){let F=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O()}};return F(P)-F(N)}(_.type,E.type)||this.Va(_.doc,E.doc)),this.wa(r),s=s!=null&&s;let l=e&&!s?this.Sa():[],d=this.Ra.size===0&&this.current&&!s?1:0,f=d!==this.Aa;return this.Aa=d,u.length!==0||f?{snapshot:new Le(this.query,t.ma,o,u,t.mutatedKeys,d===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),ba:l}:{ba:l}}ea(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new Ar,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(t){return!this.Ea.has(t)&&!!this.ma.has(t)&&!this.ma.get(t).hasLocalMutations}wa(t){t&&(t.addedDocuments.forEach(e=>this.Ea=this.Ea.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ea=this.Ea.delete(e)),this.current=t.current)}Sa(){if(!this.current)return[];let t=this.Ra;this.Ra=B(),this.ma.forEach(r=>{this.Da(r.key)&&(this.Ra=this.Ra.add(r.key))});let e=[];return t.forEach(r=>{this.Ra.has(r)||e.push(new br(r))}),this.Ra.forEach(r=>{t.has(r)||e.push(new Rr(r))}),e}va(t){this.Ea=t.Es,this.Ra=B();let e=this.ga(t.documents);return this.applyChanges(e,!0)}Ca(){return Le.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}},Ks=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},$s=class{constructor(t){this.key=t,this.Fa=!1}},Qs=class{constructor(t,e,r,s,o,u){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.Ma={},this.xa=new Ut(l=>Iu(l),Or),this.Oa=new Map,this.Na=new Set,this.Ba=new et(M.comparator),this.La=new Map,this.ka=new Tn,this.qa={},this.Qa=new Map,this.Ka=In.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}};function yh(n,t,e=!0){return C(this,null,function*(){let r=nc(n),s,o=r.xa.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.Ca()):s=yield Xu(r,t,e,!0),s})}function wh(n,t){return C(this,null,function*(){let e=nc(n);yield Xu(e,t,!0,!1)})}function Xu(n,t,e,r){return C(this,null,function*(){let s=yield nh(n.localStore,Vt(t)),o=s.targetId,u=n.sharedClientState.addLocalQueryTarget(o,e),l;return r&&(l=yield vh(n,t,o,u==="current",s.resumeToken)),n.isPrimaryClient&&e&&zu(n.remoteStore,s),l})}function vh(n,t,e,r,s){return C(this,null,function*(){n.Ua=(E,S,P)=>function(F,x,z,j){return C(this,null,function*(){let $=x.view.ga(z);$.ss&&($=yield nu(F.localStore,x.query,!1).then(({documents:v})=>x.view.ga(v,$)));let Y=j&&j.targetChanges.get(x.targetId),vt=j&&j.targetMismatches.get(x.targetId)!=null,H=x.view.applyChanges($,F.isPrimaryClient,Y,vt);return au(F,x.targetId,H.ba),H.snapshot})}(n,E,S,P);let o=yield nu(n.localStore,t,!0),u=new js(t,o.Es),l=u.ga(o.documents),d=wn.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),f=u.applyChanges(l,n.isPrimaryClient,d);au(n,e,f.ba);let _=new Ks(t,e,u);return n.xa.set(t,_),n.Oa.has(e)?n.Oa.get(e).push(t):n.Oa.set(e,[t]),f.snapshot})}function Ih(n,t,e){return C(this,null,function*(){let r=L(n),s=r.xa.get(t),o=r.Oa.get(s.targetId);if(o.length>1)return r.Oa.set(s.targetId,o.filter(u=>!Or(u,t))),void r.xa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||(yield xs(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&fo(r.remoteStore,s.targetId),Ws(r,s.targetId)}).catch(Ue))):(Ws(r,s.targetId),yield xs(r.localStore,s.targetId,!0))})}function Th(n,t){return C(this,null,function*(){let e=L(n),r=e.xa.get(t),s=e.Oa.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),fo(e.remoteStore,r.targetId))})}function Eh(n,t,e){return C(this,null,function*(){let r=xh(n);try{let s=yield function(u,l){let d=L(u),f=ut.now(),_=l.reduce((P,N)=>P.add(N.key),B()),E,S;return d.persistence.runTransaction("Locally write mutations","readwrite",P=>{let N=Gt(),F=B();return d.hs.getEntries(P,_).next(x=>{N=x,N.forEach((z,j)=>{j.isValidDocument()||(F=F.add(z))})}).next(()=>d.localDocuments.getOverlayedDocuments(P,N)).next(x=>{E=x;let z=[];for(let j of l){let $=Vl(j,E.get(j.key).overlayedDocument);$!=null&&z.push(new zt(j.key,$,gu($.value.mapValue),se.exists(!0)))}return d.mutationQueue.addMutationBatch(P,f,z,l)}).next(x=>{S=x;let z=x.applyToLocalDocumentSet(E,F);return d.documentOverlayCache.saveOverlays(P,x.batchId,z)})}).then(()=>({batchId:S.batchId,changes:Au(E)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(u,l,d){let f=u.qa[u.currentUser.toKey()];f||(f=new et(U)),f=f.insert(l,d),u.qa[u.currentUser.toKey()]=f}(r,s.batchId,e),yield xn(r,s.changes),yield Ur(r.remoteStore)}catch(s){let o=Gr(s,"Failed to persist write");e.reject(o)}})}function Yu(n,t){return C(this,null,function*(){let e=L(n);try{let r=yield Zl(e.localStore,t);t.targetChanges.forEach((s,o)=>{let u=e.La.get(o);u&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?u.Fa=!0:s.modifiedDocuments.size>0?Q(u.Fa):s.removedDocuments.size>0&&(Q(u.Fa),u.Fa=!1))}),yield xn(e,r,t)}catch(r){yield Ue(r)}})}function ou(n,t,e){let r=L(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.xa.forEach((o,u)=>{let l=u.view.ea(t);l.snapshot&&s.push(l.snapshot)}),function(u,l){let d=L(u);d.onlineState=l;let f=!1;d.queries.forEach((_,E)=>{for(let S of E.J_)S.ea(l)&&(f=!0)}),f&&_o(d)}(r.eventManager,t),s.length&&r.Ma.R_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Ah(n,t,e){return C(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.La.get(t),o=s&&s.key;if(o){let u=new et(M.comparator);u=u.insert(o,St.newNoDocument(o,q.min()));let l=B().add(o),d=new lr(q.min(),new Map,new et(U),u,l);yield Yu(r,d),r.Ba=r.Ba.remove(o),r.La.delete(t),yo(r)}else yield xs(r.localStore,t,!1).then(()=>Ws(r,t,e)).catch(Ue)})}function Sh(n,t){return C(this,null,function*(){let e=L(n),r=t.batch.batchId;try{let s=yield Yl(e.localStore,t);tc(e,r,null),Zu(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield xn(e,s)}catch(s){yield Ue(s)}})}function Rh(n,t,e){return C(this,null,function*(){let r=L(n);try{let s=yield function(u,l){let d=L(u);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let _;return d.mutationQueue.lookupMutationBatch(f,l).next(E=>(Q(E!==null),_=E.keys(),d.mutationQueue.removeMutationBatch(f,E))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,_,l)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,_)).next(()=>d.localDocuments.getDocuments(f,_))})}(r.localStore,t);tc(r,t,e),Zu(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield xn(r,s)}catch(s){yield Ue(s)}})}function Zu(n,t){(n.Qa.get(t)||[]).forEach(e=>{e.resolve()}),n.Qa.delete(t)}function tc(n,t,e){let r=L(n),s=r.qa[r.currentUser.toKey()];if(s){let o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.qa[r.currentUser.toKey()]=s}}function Ws(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Oa.get(t))n.xa.delete(r),e&&n.Ma.Wa(r,e);n.Oa.delete(t),n.isPrimaryClient&&n.ka.yr(t).forEach(r=>{n.ka.containsKey(r)||ec(n,r)})}function ec(n,t){n.Na.delete(t.path.canonicalString());let e=n.Ba.get(t);e!==null&&(fo(n.remoteStore,e),n.Ba=n.Ba.remove(t),n.La.delete(e),yo(n))}function au(n,t,e){for(let r of e)r instanceof Rr?(n.ka.addReference(r.key,t),bh(n,r)):r instanceof br?(D("SyncEngine","Document no longer in limbo: "+r.key),n.ka.removeReference(r.key,t),n.ka.containsKey(r.key)||ec(n,r.key)):O()}function bh(n,t){let e=t.key,r=e.path.canonicalString();n.Ba.get(e)||n.Na.has(r)||(D("SyncEngine","New document in limbo: "+e),n.Na.add(r),yo(n))}function yo(n){for(;n.Na.size>0&&n.Ba.size<n.maxConcurrentLimboResolutions;){let t=n.Na.values().next().value;n.Na.delete(t);let e=new M(tt.fromString(t)),r=n.Ka.next();n.La.set(r,new $s(e)),n.Ba=n.Ba.insert(e,r),zu(n.remoteStore,new vn(Vt(co(e.path)),r,"TargetPurposeLimboResolution",io.oe))}}function xn(n,t,e){return C(this,null,function*(){let r=L(n),s=[],o=[],u=[];r.xa.isEmpty()||(r.xa.forEach((l,d)=>{u.push(r.Ua(d,t,e).then(f=>{var _;if((f||e)&&r.isPrimaryClient){let E=f?!f.fromCache:(_=e?.targetChanges.get(d.targetId))===null||_===void 0?void 0:_.current;r.sharedClientState.updateQueryState(d.targetId,E?"current":"not-current")}if(f){s.push(f);let E=Rs.zi(d.targetId,f);o.push(E)}}))}),yield Promise.all(u),r.Ma.R_(s),yield function(d,f){return C(this,null,function*(){let _=L(d);try{yield _.persistence.runTransaction("notifyLocalViewChanges","readwrite",E=>b.forEach(f,S=>b.forEach(S.Wi,P=>_.persistence.referenceDelegate.addReference(E,S.targetId,P)).next(()=>b.forEach(S.Gi,P=>_.persistence.referenceDelegate.removeReference(E,S.targetId,P)))))}catch(E){if(!Ge(E))throw E;D("LocalStore","Failed to update sequence numbers: "+E)}for(let E of f){let S=E.targetId;if(!E.fromCache){let P=_.us.get(S),N=P.snapshotVersion,F=P.withLastLimboFreeSnapshotVersion(N);_.us=_.us.insert(S,F)}}})}(r.localStore,o))})}function Ph(n,t){return C(this,null,function*(){let e=L(n);if(!e.currentUser.isEqual(t)){D("SyncEngine","User change. New user:",t.toKey());let r=yield Uu(e.localStore,t);e.currentUser=t,function(o,u){o.Qa.forEach(l=>{l.forEach(d=>{d.reject(new k(R.CANCELLED,u))})}),o.Qa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield xn(e,r.Ts)}})}function Vh(n,t){let e=L(n),r=e.La.get(t);if(r&&r.Fa)return B().add(r.key);{let s=B(),o=e.Oa.get(t);if(!o)return s;for(let u of o){let l=e.xa.get(u);s=s.unionWith(l.view.fa)}return s}}function nc(n){let t=L(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Yu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Vh.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ah.bind(null,t),t.Ma.R_=ph.bind(null,t.eventManager),t.Ma.Wa=_h.bind(null,t.eventManager),t}function xh(n){let t=L(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Sh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Rh.bind(null,t),t}var rc=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){this.serializer=qr(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),yield this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)})}Ja(e,r){return null}Ya(e,r){return null}Ha(e){return Xl(this.persistence,new Ps,e.initialUser,this.serializer)}ja(e){return new pr(Ss.ei,this.serializer)}za(e){return new Cs}terminate(){return C(this,null,function*(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Hs=class extends rc{constructor(t){super(),this.cacheSizeBytes=t}Ja(t,e){Q(this.persistence.referenceDelegate instanceof _r);let r=this.persistence.referenceDelegate.garbageCollector;return new ds(r,t.asyncQueue,e)}ja(t){let e=this.cacheSizeBytes!==void 0?It.withCacheSize(this.cacheSizeBytes):It.DEFAULT;return new pr(r=>_r.ei(r,e),this.serializer)}};var Ch=(()=>{class n{initialize(e,r){return C(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>ou(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ph.bind(null,this.syncEngine),yield gh(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Gs}()}createDatastore(e){let r=qr(e.databaseInfo.databaseId),s=function(u){return new ks(u)}(e.databaseInfo);return function(u,l,d,f){return new Os(u,l,d,f)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,o,u,l,d){return new qs(s,o,u,l,d)}(this.localStore,this.datastore,e.asyncQueue,r=>ou(this.syncEngine,r,0),function(){return wr.p()?new wr:new Ds}())}createSyncEngine(e,r){return function(o,u,l,d,f,_,E){let S=new Qs(o,u,l,d,f,_);return E&&(S.$a=!0),S}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return C(this,null,function*(){var e,r;yield function(o){return C(this,null,function*(){let u=L(o);D("RemoteStore","RemoteStore shutting down."),u.k_.add(5),yield Vn(u),u.Q_.shutdown(),u.K_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var Pr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Xa(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Xa(this.observer.error,t):Lt("Uncaught Error in snapshot listener:",t.toString()))}eu(){this.muted=!0}Xa(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Js=class{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=st.UNAUTHENTICATED,this.clientId=rr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,u=>C(this,null,function*(){D("FirestoreClient","Received user=",u.uid),yield this.authCredentialListener(u),this.user=u})),this.appCheckCredentials.start(r,u=>(D("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Tt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Gr(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Si(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(s=>C(this,null,function*(){r.isEqual(s)||(yield Uu(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function uu(n,t){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield ic(n);D("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>ru(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>ru(t.remoteStore,s)),n._onlineComponents=t})}function ic(n){return C(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Si(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===R.FAILED_PRECONDITION||s.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;be("Error using user provided cache. Falling back to memory cache: "+e),yield Si(n,new rc)}}else D("FirestoreClient","Using default OfflineComponentProvider"),yield Si(n,new Hs(void 0));return n._offlineComponents})}function sc(n){return C(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(D("FirestoreClient","Using user provided OnlineComponentProvider"),yield uu(n,n._uninitializedComponentsProvider._online)):(D("FirestoreClient","Using default OnlineComponentProvider"),yield uu(n,new Ch))),n._onlineComponents})}function Dh(n){return ic(n).then(t=>t.localStore)}function Nh(n){return sc(n).then(t=>t.syncEngine)}function oc(n){return C(this,null,function*(){let t=yield sc(n),e=t.eventManager;return e.onListen=yh.bind(null,t.syncEngine),e.onUnlisten=Ih.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=wh.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Th.bind(null,t.syncEngine),e})}function kh(n,t){let e=new Tt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(s,o,u){return C(this,null,function*(){try{let l=yield function(f,_){let E=L(f);return E.persistence.runTransaction("read document","readonly",S=>E.localDocuments.getDocument(S,_))}(s,o);l.isFoundDocument()?u.resolve(l):l.isNoDocument()?u.resolve(null):u.reject(new k(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){let d=Gr(l,`Failed to get document '${o} from cache`);u.reject(d)}})}(yield Dh(n),t,e)})),e.promise}function Fh(n,t,e={}){let r=new Tt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(o,u,l,d,f){let _=new Pr({next:S=>{_.eu(),u.enqueueAndForget(()=>Ju(o,E));let P=S.docs.has(l);!P&&S.fromCache?f.reject(new k(R.UNAVAILABLE,"Failed to get document because the client is offline.")):P&&S.fromCache&&d&&d.source==="server"?f.reject(new k(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(S)},error:S=>f.reject(S)}),E=new Sr(co(l.path),_,{includeMetadataChanges:!0,ua:!0});return Hu(o,E)}(yield oc(n),n.asyncQueue,t,e,r)})),r.promise}function Mh(n,t,e={}){let r=new Tt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(o,u,l,d,f){let _=new Pr({next:S=>{_.eu(),u.enqueueAndForget(()=>Ju(o,E)),S.fromCache&&d.source==="server"?f.reject(new k(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(S)},error:S=>f.reject(S)}),E=new Sr(l,_,{includeMetadataChanges:!0,ua:!0});return Hu(o,E)}(yield oc(n),n.asyncQueue,t,e,r)})),r.promise}function ac(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var cu=new Map;function uc(n,t,e){if(!e)throw new k(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Oh(n,t,e,r){if(t===!0&&r===!0)throw new k(R.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function lu(n){if(!M.isDocumentKey(n))throw new k(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function hu(n){if(M.isDocumentKey(n))throw new k(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function wo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":O()}function Yt(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new k(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=wo(n);throw new k(R.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}var Vr=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new k(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new k(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Oh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ac((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},qe=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vr({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new k(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vr(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ri;switch(r.type){case"firstParty":return new xi(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=cu.get(e);r&&(D("ComponentProvider","Removing Datastore"),cu.delete(e),r.terminate())}(this),Promise.resolve()}};function Lh(n,t,e,r={}){var s;let o=(n=Yt(n,qe))._getSettings(),u=`${t}:${e}`;if(o.host!=="firestore.googleapis.com"&&o.host!==u&&be("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},o),{host:u,ssl:!1})),r.mockUserToken){let l,d;if(typeof r.mockUserToken=="string")l=r.mockUserToken,d=st.MOCK_USER;else{l=Ta(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);let f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new k(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new st(f)}n._authCredentials=new bi(new nr(l,d))}}var xr=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},wt=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ht(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},Ht=class n extends xr{constructor(t,e,r){super(t,e,co(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new wt(this.firestore,null,new M(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function yd(n,t,...e){if(n=ye(n),uc("collection","path",t),n instanceof qe){let r=tt.fromString(t,...e);return hu(r),new Ht(n,null,r)}{if(!(n instanceof wt||n instanceof Ht))throw new k(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(tt.fromString(t,...e));return hu(r),new Ht(n.firestore,null,r)}}function qh(n,t,...e){if(n=ye(n),arguments.length===1&&(t=rr.newId()),uc("doc","path",t),n instanceof qe){let r=tt.fromString(t,...e);return lu(r),new wt(n,null,new M(r))}{if(!(n instanceof wt||n instanceof Ht))throw new k(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(tt.fromString(t,...e));return lu(r),new wt(n.firestore,n instanceof Ht?n.converter:null,new M(r))}}var Cr=class{constructor(t=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new vr(this,"async_queue_retry"),this.fu=()=>{let r=Ai();r&&D("AsyncQueue","Visibility state changed to "+r.visibilityState),this.r_.Jo()},this.gu=t;let e=Ai();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.yu(t)}enterRestrictedMode(t){if(!this.du){this.du=!0,this.Vu=t||!1;let e=Ai();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.fu)}}enqueue(t){if(this.pu(),this.du)return new Promise(()=>{});let e=new Tt;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Iu.push(t),this.wu()))}wu(){return C(this,null,function*(){if(this.Iu.length!==0){try{yield this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(t){if(!Ge(t))throw t;D("AsyncQueue","Operation failed with retryable error: "+t)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}})}yu(t){let e=this.gu.then(()=>(this.Ru=!0,t().catch(r=>{this.Au=r,this.Ru=!1;let s=function(u){let l=u.message||"";return u.stack&&(l=u.stack.includes(u.message)?u.stack:u.message+`
`+u.stack),l}(r);throw Lt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.Ru=!1,r))));return this.gu=e,e}enqueueAfterDelay(t,e,r){this.pu(),this.mu.indexOf(t)>-1&&(e=0);let s=Bs.createAndSchedule(this,t,e,r,o=>this.Su(o));return this.Eu.push(s),s}pu(){this.Au&&O()}verifyOperationInProgress(){}bu(){return C(this,null,function*(){let t;do t=this.gu,yield t;while(t!==this.gu)})}Du(t){for(let e of this.Eu)if(e.timerId===t)return!0;return!1}vu(t){return this.bu().then(()=>{this.Eu.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.Eu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.bu()})}Cu(t){this.mu.push(t)}Su(t){let e=this.Eu.indexOf(t);this.Eu.splice(e,1)}};var he=class extends qe{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Cr,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Cr(t),this._firestoreClient=void 0,yield t}})}};function wd(n,t){let e=typeof n=="object"?n:Ca(),r=typeof n=="string"?n:t||"(default)",s=Va(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let o=Ia("firestore");o&&Lh(s,...o)}return s}function zr(n){if(n._terminated)throw new k(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Bh(n),n._firestoreClient}function Bh(n){var t,e,r;let s=n._freezeSettings(),o=function(l,d,f,_){return new Fi(l,d,f,_.host,_.ssl,_.experimentalForceLongPolling,_.experimentalAutoDetectLongPolling,ac(_.experimentalLongPollingOptions),_.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new Js(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(l){let d=l?._online.build();return{_offline:l?._offline.build(d),_online:d}}(n._componentsProvider))}var En=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(mt.fromBase64String(t))}catch(e){throw new k(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(mt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var An=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new k(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Dr=class{constructor(t){this._methodName=t}};var Sn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new k(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new k(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return U(this._lat,t._lat)||U(this._long,t._long)}};var Rn=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,t._values)}};var Uh=/^__.*__$/,Xs=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new zt(t,this.data,this.fieldMask,e,this.fieldTransforms):new le(t,this.data,e,this.fieldTransforms)}};function cc(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O()}}var Ys=class n{constructor(t,e,r,s,o,u){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Fu(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.xu({path:r,Nu:!1});return s.Bu(t),s}Lu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.xu({path:r,Nu:!1});return s.Fu(),s}ku(t){return this.xu({path:void 0,Nu:!0})}qu(t){return Nr(t,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Fu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Bu(this.path.get(t))}Bu(t){if(t.length===0)throw this.qu("Document fields must not be empty");if(cc(this.Mu)&&Uh.test(t))throw this.qu('Document fields cannot begin and end with "__"')}},Zs=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||qr(t)}$u(t,e,r,s=!1){return new Ys({Mu:t,methodName:e,Ku:r,path:yt.emptyPath(),Nu:!1,Qu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Gh(n){let t=n._freezeSettings(),e=qr(n._databaseId);return new Zs(n._databaseId,!!t.ignoreUndefinedProperties,e)}function zh(n,t,e,r,s,o={}){let u=n.$u(o.merge||o.mergeFields?2:0,t,e,s);fc("Data must be an object, but it was:",u,r);let l=hc(r,u),d,f;if(o.merge)d=new bt(u.fieldMask),f=u.fieldTransforms;else if(o.mergeFields){let _=[];for(let E of o.mergeFields){let S=jh(t,E,e);if(!u.contains(S))throw new k(R.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);$h(_,S)||_.push(S)}d=new bt(_),f=u.fieldTransforms.filter(E=>d.covers(E.field))}else d=null,f=u.fieldTransforms;return new Xs(new At(l),d,f)}function lc(n,t){if(dc(n=ye(n)))return fc("Unsupported field value:",t,n),hc(n,t);if(n instanceof Dr)return function(r,s){if(!cc(s.Mu))throw s.qu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.qu(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Nu&&t.Mu!==4)throw t.qu("Nested arrays are not supported");return function(r,s){let o=[],u=0;for(let l of r){let d=lc(l,s.ku(u));d==null&&(d={nullValue:"NULL_VALUE"}),o.push(d),u++}return{arrayValue:{values:o}}}(n,t)}return function(r,s){if((r=ye(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Al(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=ut.fromDate(r);return{timestampValue:mr(s.serializer,o)}}if(r instanceof ut){let o=new ut(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:mr(s.serializer,o)}}if(r instanceof Sn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof En)return{bytesValue:ku(s.serializer,r._byteString)};if(r instanceof wt){let o=s.databaseId,u=r.firestore._databaseId;if(!u.isEqual(o))throw s.qu(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:ho(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Rn)return function(u,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:u.toArray().map(d=>{if(typeof d!="number")throw l.qu("VectorValues must only contain numeric values.");return lo(l.serializer,d)})}}}}}}(r,s);throw s.qu(`Unsupported field value: ${wo(r)}`)}(n,t)}function hc(n,t){let e={};return du(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):de(n,(r,s)=>{let o=lc(s,t.Ou(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function dc(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ut||n instanceof Sn||n instanceof En||n instanceof wt||n instanceof Dr||n instanceof Rn)}function fc(n,t,e){if(!dc(e)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(e)){let r=wo(e);throw r==="an object"?t.qu(n+" a custom object"):t.qu(n+" "+r)}}function jh(n,t,e){if((t=ye(t))instanceof An)return t._internalPath;if(typeof t=="string")return mc(n,t);throw Nr("Field path arguments must be of type string or ",n,!1,void 0,e)}var Kh=new RegExp("[~\\*/\\[\\]]");function mc(n,t,e){if(t.search(Kh)>=0)throw Nr(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new An(...t.split("."))._internalPath}catch{throw Nr(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Nr(n,t,e,r,s){let o=r&&!r.isEmpty(),u=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(o||u)&&(d+=" (found",o&&(d+=` in field ${r}`),u&&(d+=` in document ${s}`),d+=")"),new k(R.INVALID_ARGUMENT,l+n+d)}function $h(n,t){return n.some(e=>e.isEqual(t))}var kr=class{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new wt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new to(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(gc("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},to=class extends kr{data(){return super.data()}};function gc(n,t){return typeof t=="string"?mc(n,t):t instanceof An?t._internalPath:t._delegate._internalPath}function Qh(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var eo=class{convertValue(t,e="none"){switch(Jt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return X(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Bt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw O()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return de(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){var e,r,s;let o=(s=(r=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(u=>X(u.doubleValue));return new Rn(o)}convertGeoPoint(t){return new Sn(X(t.latitude),X(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Mr(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(_n(t));default:return null}}convertTimestamp(t){let e=qt(t);return new ut(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=tt.fromString(t);Q(Bu(r));let s=new ar(r.get(1),r.get(3)),o=new M(r.popFirst(5));return s.isEqual(e)||Lt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function Wh(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var Wt=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},bn=class extends kr{constructor(t,e,r,s,o,u){super(t,e,r,s,u),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Re(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(gc("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},Re=class extends bn{data(t={}){return super.data(t)}},no=class{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Wt(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Re(this._firestore,this._userDataWriter,r.key,r,new Wt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new k(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let u=0;return s._snapshot.docChanges.map(l=>{let d=new Re(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Wt(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:d,oldIndex:-1,newIndex:u++}})}{let u=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let d=new Re(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Wt(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),f=-1,_=-1;return l.type!==0&&(f=u.indexOf(l.doc.key),u=u.delete(l.doc.key)),l.type!==1&&(u=u.add(l.doc),_=u.indexOf(l.doc.key)),{type:Hh(l.type),doc:d,oldIndex:f,newIndex:_}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Hh(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O()}}function vd(n){n=Yt(n,wt);let t=Yt(n.firestore,he);return Fh(zr(t),n._key).then(e=>Xh(t,n,e))}var Pn=class extends eo{constructor(t){super(),this.firestore=t}convertBytes(t){return new En(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new wt(this.firestore,null,e)}};function Id(n){n=Yt(n,wt);let t=Yt(n.firestore,he),e=zr(t),r=new Pn(t);return kh(e,n._key).then(s=>new bn(t,r,n._key,s,new Wt(s!==null&&s.hasLocalMutations,!0),n.converter))}function Td(n){n=Yt(n,xr);let t=Yt(n.firestore,he),e=zr(t),r=new Pn(t);return Qh(n._query),Mh(e,n._query).then(s=>new no(t,r,n,s))}function Ed(n,t){let e=Yt(n.firestore,he),r=qh(n),s=Wh(n.converter,t);return Jh(e,[zh(Gh(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,se.exists(!1))]).then(()=>r)}function Jh(n,t){return function(r,s){let o=new Tt;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return Eh(yield Nh(r),s,o)})),o.promise}(zr(n),t)}function Xh(n,t,e){let r=e.docs.get(t._key),s=new Pn(n);return new bn(n,s,t._key,r,new Wt(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(s){Be=s})(xa),Pa(new Ra("firestore",(r,{instanceIdentifier:s,options:o})=>{let u=r.getProvider("app").getImmediate(),l=new he(new Pi(r.getProvider("auth-internal")),new Di(r.getProvider("app-check-internal")),function(f,_){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new k(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ar(f.options.projectId,_)}(u,s),u);return o=Object.assign({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),gi(ka,"4.7.6",t),gi(ka,"4.7.6","esm2017")})();export{ut as a,yd as b,qh as c,wd as d,vd as e,Id as f,Td as g,Ed as h};
