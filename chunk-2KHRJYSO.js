import{L as Ru}from"./chunk-KT4MGJLT.js";import{a as bu,b as Su,d as D}from"./chunk-ECBXVGWK.js";var Du=function(n){let t=[],e=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?t[e++]=i:i<2048?(t[e++]=i>>6|192,t[e++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=i>>18|240,t[e++]=i>>12&63|128,t[e++]=i>>6&63|128,t[e++]=i&63|128):(t[e++]=i>>12|224,t[e++]=i>>6&63|128,t[e++]=i&63|128)}return t},Dh=function(n){let t=[],e=0,r=0;for(;e<n.length;){let i=n[e++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[e++];t[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[e++],a=n[e++],l=n[e++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[e++],a=n[e++];t[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return t.join("")},Cu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,l=a?n[i+1]:0,h=i+2<n.length,f=h?n[i+2]:0,m=o>>2,I=(o&3)<<4|l>>4,A=(l&15)<<2|f>>6,R=f&63;h||(R=64,a||(A=64)),r.push(e[m],e[I],e[A],e[R])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Du(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Dh(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=e[n.charAt(i++)],l=i<n.length?e[n.charAt(i)]:0;++i;let f=i<n.length?e[n.charAt(i)]:64;++i;let I=i<n.length?e[n.charAt(i)]:64;if(++i,o==null||l==null||f==null||I==null)throw new Ki;let A=o<<2|l>>4;if(r.push(A),f!==64){let R=l<<4&240|f>>2;if(r.push(R),I!==64){let V=f<<6&192|I;r.push(V)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Ki=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Ch=function(n){let t=Du(n);return Cu.encodeByteArray(t,!0)},An=function(n){return Ch(n).replace(/\./g,"")},xh=function(n){try{return Cu.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Vh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Nh=()=>Vh().__FIREBASE_DEFAULTS__,kh=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Oh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&xh(n[1]);return t&&JSON.parse(t)},fr=()=>{try{return Nh()||kh()||Oh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Mh=n=>{var t,e;return(e=(t=fr())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},xu=n=>{let t=Mh(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},Wi=()=>{var n;return(n=fr())===null||n===void 0?void 0:n.config},$m=n=>{var t;return(t=fr())===null||t===void 0?void 0:t[`_${n}`]};var dr=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}};function Vu(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},r=t||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[An(JSON.stringify(e)),An(JSON.stringify(a)),""].join(".")}function mr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Km(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(mr())}function Fh(){var n;let t=(n=fr())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Qm(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Wm(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Hm(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Jm(){let n=mr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Nu(){return!Fh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Hi(){try{return typeof indexedDB=="object"}catch{return!1}}function ku(){return new Promise((n,t)=>{try{let e=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var o;t(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(e){t(e)}})}var Lh="FirebaseError",Ut=class n extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Lh,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bn.prototype.create)}},bn=class{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){let r=e[0]||{},i=`${this.service}/${t}`,o=this.errors[t],a=o?Bh(o,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Ut(i,l,r)}};function Bh(n,t){return n.replace(Uh,(e,r)=>{let i=t[r];return i!=null?String(i):`<${r}?>`})}var Uh=/\{\$([^}]+)}/g;function Xm(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function Pe(n,t){if(n===t)return!0;let e=Object.keys(n),r=Object.keys(t);for(let i of e){if(!r.includes(i))return!1;let o=n[i],a=t[i];if(Pu(o)&&Pu(a)){if(!Pe(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!e.includes(i))return!1;return!0}function Pu(n){return n!==null&&typeof n=="object"}function Ym(n){let t=[];for(let[e,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Zm(n){let t={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,o]=r.split("=");t[decodeURIComponent(i)]=decodeURIComponent(o)}}),t}function tp(n){let t=n.indexOf("?");if(!t)return"";let e=n.indexOf("#",t);return n.substring(t,e>0?e:void 0)}function ep(n,t){let e=new Qi(n,t);return e.subscribe.bind(e)}var Qi=class{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let i;if(t===void 0&&e===void 0&&r===void 0)throw new Error("Missing Observer.");qh(t,["next","error","complete"])?i=t:i={next:t,error:e,complete:r},i.next===void 0&&(i.next=$i),i.error===void 0&&(i.error=$i),i.complete===void 0&&(i.complete=$i);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function qh(n,t){if(typeof n!="object"||n===null)return!1;for(let e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function $i(){}var np=4*60*60*1e3;function Dt(n){return n&&n._delegate?n._delegate:n}var qt=class{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var pe="[DEFAULT]";var Ji=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let r=new dr;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:e});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let r=this.normalizeInstanceIdentifier(t?.identifier),i=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(jh(t))try{this.getOrInitializeService({instanceIdentifier:pe})}catch{}for(let[e,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(e);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(t=pe){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return D(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=pe){return this.instances.has(t)}getOptions(t=pe){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:e});for(let[o,a]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(i)}return i}onInit(t,e){var r;let i=this.normalizeInstanceIdentifier(e),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(t),this.onInitCallbacks.set(i,o);let a=this.instances.get(i);return a&&t(a,i),()=>{o.delete(t)}}invokeOnInitCallbacks(t,e){let r=this.onInitCallbacks.get(e);if(r)for(let i of r)try{i(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:zh(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=pe){return this.component?this.component.multipleInstances?t:pe:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function zh(n){return n===pe?void 0:n}function jh(n){return n.instantiationMode==="EAGER"}var pr=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new Ji(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var Gh=[],z=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(z||{}),$h={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},Kh=z.INFO,Qh={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},Wh=(n,t,...e)=>{if(t<n.logLevel)return;let r=new Date().toISOString(),i=Qh[t];if(i)console[i](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},De=class{constructor(t){this.name=t,this._logLevel=Kh,this._logHandler=Wh,this._userLogHandler=null,Gh.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in z))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?$h[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...t),this._logHandler(this,z.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...t),this._logHandler(this,z.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,z.INFO,...t),this._logHandler(this,z.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,z.WARN,...t),this._logHandler(this,z.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...t),this._logHandler(this,z.ERROR,...t)}};var Hh=(n,t)=>t.some(e=>n instanceof e),Ou,Mu;function Jh(){return Ou||(Ou=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xh(){return Mu||(Mu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Fu=new WeakMap,Yi=new WeakMap,Lu=new WeakMap,Xi=new WeakMap,ts=new WeakMap;function Yh(n){let t=new Promise((e,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(Ct(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Fu.set(e,n)}).catch(()=>{}),ts.set(t,n),t}function Zh(n){if(Yi.has(n))return;let t=new Promise((e,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Yi.set(n,t)}var Zi={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Yi.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Lu.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ct(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Bu(n){Zi=n(Zi)}function td(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let r=n.call(gr(this),t,...e);return Lu.set(r,t.sort?t.sort():[t]),Ct(r)}:Xh().includes(n)?function(...t){return n.apply(gr(this),t),Ct(Fu.get(this))}:function(...t){return Ct(n.apply(gr(this),t))}}function ed(n){return typeof n=="function"?td(n):(n instanceof IDBTransaction&&Zh(n),Hh(n,Jh())?new Proxy(n,Zi):n)}function Ct(n){if(n instanceof IDBRequest)return Yh(n);if(Xi.has(n))return Xi.get(n);let t=ed(n);return t!==n&&(Xi.set(n,t),ts.set(t,n)),t}var gr=n=>ts.get(n);function qu(n,t,{blocked:e,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,t),l=Ct(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Ct(a.result),h.oldVersion,h.newVersion,Ct(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}var nd=["get","getKey","getAll","getAllKeys","count"],rd=["put","add","delete","clear"],es=new Map;function Uu(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(es.get(t))return es.get(t);let e=t.replace(/FromIndex$/,""),r=t!==e,i=rd.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(i||nd.includes(e)))return;let o=function(a,...l){return D(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),f=h.store;return r&&(f=f.index(l.shift())),(yield Promise.all([f[e](...l),i&&h.done]))[0]})};return es.set(t,o),o}Bu(n=>Su(bu({},n),{get:(t,e,r)=>Uu(t,e)||n.get(t,e,r),has:(t,e)=>!!Uu(t,e)||n.has(t,e)}));var rs=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(id(e)){let r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}};function id(n){let t=n.getComponent();return t?.type==="VERSION"}var is="@firebase/app",zu="0.10.18";var zt=new De("@firebase/app"),sd="@firebase/app-compat",od="@firebase/analytics-compat",ad="@firebase/analytics",ud="@firebase/app-check-compat",cd="@firebase/app-check",ld="@firebase/auth",hd="@firebase/auth-compat",dd="@firebase/database",fd="@firebase/data-connect",md="@firebase/database-compat",pd="@firebase/functions",gd="@firebase/functions-compat",_d="@firebase/installations",yd="@firebase/installations-compat",wd="@firebase/messaging",vd="@firebase/messaging-compat",Ed="@firebase/performance",Id="@firebase/performance-compat",Td="@firebase/remote-config",Ad="@firebase/remote-config-compat",bd="@firebase/storage",Sd="@firebase/storage-compat",Rd="@firebase/firestore",Pd="@firebase/vertexai",Dd="@firebase/firestore-compat",Cd="firebase",xd="11.2.0";var ss="[DEFAULT]",Vd={[is]:"fire-core",[sd]:"fire-core-compat",[ad]:"fire-analytics",[od]:"fire-analytics-compat",[cd]:"fire-app-check",[ud]:"fire-app-check-compat",[ld]:"fire-auth",[hd]:"fire-auth-compat",[dd]:"fire-rtdb",[fd]:"fire-data-connect",[md]:"fire-rtdb-compat",[pd]:"fire-fn",[gd]:"fire-fn-compat",[_d]:"fire-iid",[yd]:"fire-iid-compat",[wd]:"fire-fcm",[vd]:"fire-fcm-compat",[Ed]:"fire-perf",[Id]:"fire-perf-compat",[Td]:"fire-rc",[Ad]:"fire-rc-compat",[bd]:"fire-gcs",[Sd]:"fire-gcs-compat",[Rd]:"fire-fst",[Dd]:"fire-fst-compat",[Pd]:"fire-vertex","fire-js":"fire-js",[Cd]:"fire-js-all"};var _r=new Map,Nd=new Map,os=new Map;function ju(n,t){try{n.container.addComponent(t)}catch(e){zt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function Sn(n){let t=n.name;if(os.has(t))return zt.debug(`There were multiple attempts to register component ${t}.`),!1;os.set(t,n);for(let e of _r.values())ju(e,n);for(let e of Nd.values())ju(e,n);return!0}function Qu(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Ep(n){return n.settings!==void 0}var kd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},te=new bn("app","Firebase",kd);var as=class{constructor(t,e,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new qt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw te.create("app-deleted",{appName:this._name})}};var Wu=xd;function ls(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let r=Object.assign({name:ss,automaticDataCollectionEnabled:!1},t),i=r.name;if(typeof i!="string"||!i)throw te.create("bad-app-name",{appName:String(i)});if(e||(e=Wi()),!e)throw te.create("no-options");let o=_r.get(i);if(o){if(Pe(e,o.options)&&Pe(r,o.config))return o;throw te.create("duplicate-app",{appName:i})}let a=new pr(i);for(let h of os.values())a.addComponent(h);let l=new as(e,r,a);return _r.set(i,l),l}function Hu(n=ss){let t=_r.get(n);if(!t&&n===ss&&Wi())return ls();if(!t)throw te.create("no-app",{appName:n});return t}function ee(n,t,e){var r;let i=(r=Vd[n])!==null&&r!==void 0?r:n;e&&(i+=`-${e}`);let o=i.match(/\s|\//),a=t.match(/\s|\//);if(o||a){let l=[`Unable to register library "${i}" with version "${t}":`];o&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&l.push("and"),a&&l.push(`version name "${t}" contains illegal characters (whitespace or "/")`),zt.warn(l.join(" "));return}Sn(new qt(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}var Od="firebase-heartbeat-database",Md=1,Rn="firebase-heartbeat-store",ns=null;function Ju(){return ns||(ns=qu(Od,Md,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Rn)}catch(e){console.warn(e)}}}}).catch(n=>{throw te.create("idb-open",{originalErrorMessage:n.message})})),ns}function Fd(n){return D(this,null,function*(){try{let e=(yield Ju()).transaction(Rn),r=yield e.objectStore(Rn).get(Xu(n));return yield e.done,r}catch(t){if(t instanceof Ut)zt.warn(t.message);else{let e=te.create("idb-get",{originalErrorMessage:t?.message});zt.warn(e.message)}}})}function Gu(n,t){return D(this,null,function*(){try{let r=(yield Ju()).transaction(Rn,"readwrite");yield r.objectStore(Rn).put(t,Xu(n)),yield r.done}catch(e){if(e instanceof Ut)zt.warn(e.message);else{let r=te.create("idb-set",{originalErrorMessage:e?.message});zt.warn(r.message)}}})}function Xu(n){return`${n.name}!${n.options.appId}`}var Ld=1024,Bd=30*24*60*60*1e3,us=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new cs(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return D(this,null,function*(){var t,e;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=$u();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{let l=new Date(a.date).valueOf();return Date.now()-l<=Bd}),this._storage.overwrite(this._heartbeatsCache))}catch(r){zt.warn(r)}})}getHeartbeatsHeader(){return D(this,null,function*(){var t;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=$u(),{heartbeatsToSend:r,unsentEntries:i}=Ud(this._heartbeatsCache.heartbeats),o=An(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(e){return zt.warn(e),""}})}};function $u(){return new Date().toISOString().substring(0,10)}function Ud(n,t=Ld){let e=[],r=n.slice();for(let i of n){let o=e.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Ku(e)>t){o.dates.pop();break}}else if(e.push({agent:i.agent,dates:[i.date]}),Ku(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}var cs=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return D(this,null,function*(){return Hi()?ku().then(()=>!0).catch(()=>!1):!1})}read(){return D(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Fd(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return D(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Gu(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return D(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Gu(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return})}};function Ku(n){return An(JSON.stringify({version:2,heartbeats:n})).length}function qd(n){Sn(new qt("platform-logger",t=>new rs(t),"PRIVATE")),Sn(new qt("heartbeat",t=>new us(t),"PRIVATE")),ee(is,zu,n),ee(is,zu,"esm2017"),ee("fire-js","")}qd("");var Yu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zu={};var jt,hs;(function(){var n;function t(v,p){function _(){}_.prototype=p.prototype,v.D=p.prototype,v.prototype=new _,v.prototype.constructor=v,v.C=function(y,w,T){for(var g=Array(arguments.length-2),Ft=2;Ft<arguments.length;Ft++)g[Ft-2]=arguments[Ft];return p.prototype[w].apply(y,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,_){_||(_=0);var y=Array(16);if(typeof p=="string")for(var w=0;16>w;++w)y[w]=p.charCodeAt(_++)|p.charCodeAt(_++)<<8|p.charCodeAt(_++)<<16|p.charCodeAt(_++)<<24;else for(w=0;16>w;++w)y[w]=p[_++]|p[_++]<<8|p[_++]<<16|p[_++]<<24;p=v.g[0],_=v.g[1],w=v.g[2];var T=v.g[3],g=p+(T^_&(w^T))+y[0]+3614090360&4294967295;p=_+(g<<7&4294967295|g>>>25),g=T+(w^p&(_^w))+y[1]+3905402710&4294967295,T=p+(g<<12&4294967295|g>>>20),g=w+(_^T&(p^_))+y[2]+606105819&4294967295,w=T+(g<<17&4294967295|g>>>15),g=_+(p^w&(T^p))+y[3]+3250441966&4294967295,_=w+(g<<22&4294967295|g>>>10),g=p+(T^_&(w^T))+y[4]+4118548399&4294967295,p=_+(g<<7&4294967295|g>>>25),g=T+(w^p&(_^w))+y[5]+1200080426&4294967295,T=p+(g<<12&4294967295|g>>>20),g=w+(_^T&(p^_))+y[6]+2821735955&4294967295,w=T+(g<<17&4294967295|g>>>15),g=_+(p^w&(T^p))+y[7]+4249261313&4294967295,_=w+(g<<22&4294967295|g>>>10),g=p+(T^_&(w^T))+y[8]+1770035416&4294967295,p=_+(g<<7&4294967295|g>>>25),g=T+(w^p&(_^w))+y[9]+2336552879&4294967295,T=p+(g<<12&4294967295|g>>>20),g=w+(_^T&(p^_))+y[10]+4294925233&4294967295,w=T+(g<<17&4294967295|g>>>15),g=_+(p^w&(T^p))+y[11]+2304563134&4294967295,_=w+(g<<22&4294967295|g>>>10),g=p+(T^_&(w^T))+y[12]+1804603682&4294967295,p=_+(g<<7&4294967295|g>>>25),g=T+(w^p&(_^w))+y[13]+4254626195&4294967295,T=p+(g<<12&4294967295|g>>>20),g=w+(_^T&(p^_))+y[14]+2792965006&4294967295,w=T+(g<<17&4294967295|g>>>15),g=_+(p^w&(T^p))+y[15]+1236535329&4294967295,_=w+(g<<22&4294967295|g>>>10),g=p+(w^T&(_^w))+y[1]+4129170786&4294967295,p=_+(g<<5&4294967295|g>>>27),g=T+(_^w&(p^_))+y[6]+3225465664&4294967295,T=p+(g<<9&4294967295|g>>>23),g=w+(p^_&(T^p))+y[11]+643717713&4294967295,w=T+(g<<14&4294967295|g>>>18),g=_+(T^p&(w^T))+y[0]+3921069994&4294967295,_=w+(g<<20&4294967295|g>>>12),g=p+(w^T&(_^w))+y[5]+3593408605&4294967295,p=_+(g<<5&4294967295|g>>>27),g=T+(_^w&(p^_))+y[10]+38016083&4294967295,T=p+(g<<9&4294967295|g>>>23),g=w+(p^_&(T^p))+y[15]+3634488961&4294967295,w=T+(g<<14&4294967295|g>>>18),g=_+(T^p&(w^T))+y[4]+3889429448&4294967295,_=w+(g<<20&4294967295|g>>>12),g=p+(w^T&(_^w))+y[9]+568446438&4294967295,p=_+(g<<5&4294967295|g>>>27),g=T+(_^w&(p^_))+y[14]+3275163606&4294967295,T=p+(g<<9&4294967295|g>>>23),g=w+(p^_&(T^p))+y[3]+4107603335&4294967295,w=T+(g<<14&4294967295|g>>>18),g=_+(T^p&(w^T))+y[8]+1163531501&4294967295,_=w+(g<<20&4294967295|g>>>12),g=p+(w^T&(_^w))+y[13]+2850285829&4294967295,p=_+(g<<5&4294967295|g>>>27),g=T+(_^w&(p^_))+y[2]+4243563512&4294967295,T=p+(g<<9&4294967295|g>>>23),g=w+(p^_&(T^p))+y[7]+1735328473&4294967295,w=T+(g<<14&4294967295|g>>>18),g=_+(T^p&(w^T))+y[12]+2368359562&4294967295,_=w+(g<<20&4294967295|g>>>12),g=p+(_^w^T)+y[5]+4294588738&4294967295,p=_+(g<<4&4294967295|g>>>28),g=T+(p^_^w)+y[8]+2272392833&4294967295,T=p+(g<<11&4294967295|g>>>21),g=w+(T^p^_)+y[11]+1839030562&4294967295,w=T+(g<<16&4294967295|g>>>16),g=_+(w^T^p)+y[14]+4259657740&4294967295,_=w+(g<<23&4294967295|g>>>9),g=p+(_^w^T)+y[1]+2763975236&4294967295,p=_+(g<<4&4294967295|g>>>28),g=T+(p^_^w)+y[4]+1272893353&4294967295,T=p+(g<<11&4294967295|g>>>21),g=w+(T^p^_)+y[7]+4139469664&4294967295,w=T+(g<<16&4294967295|g>>>16),g=_+(w^T^p)+y[10]+3200236656&4294967295,_=w+(g<<23&4294967295|g>>>9),g=p+(_^w^T)+y[13]+681279174&4294967295,p=_+(g<<4&4294967295|g>>>28),g=T+(p^_^w)+y[0]+3936430074&4294967295,T=p+(g<<11&4294967295|g>>>21),g=w+(T^p^_)+y[3]+3572445317&4294967295,w=T+(g<<16&4294967295|g>>>16),g=_+(w^T^p)+y[6]+76029189&4294967295,_=w+(g<<23&4294967295|g>>>9),g=p+(_^w^T)+y[9]+3654602809&4294967295,p=_+(g<<4&4294967295|g>>>28),g=T+(p^_^w)+y[12]+3873151461&4294967295,T=p+(g<<11&4294967295|g>>>21),g=w+(T^p^_)+y[15]+530742520&4294967295,w=T+(g<<16&4294967295|g>>>16),g=_+(w^T^p)+y[2]+3299628645&4294967295,_=w+(g<<23&4294967295|g>>>9),g=p+(w^(_|~T))+y[0]+4096336452&4294967295,p=_+(g<<6&4294967295|g>>>26),g=T+(_^(p|~w))+y[7]+1126891415&4294967295,T=p+(g<<10&4294967295|g>>>22),g=w+(p^(T|~_))+y[14]+2878612391&4294967295,w=T+(g<<15&4294967295|g>>>17),g=_+(T^(w|~p))+y[5]+4237533241&4294967295,_=w+(g<<21&4294967295|g>>>11),g=p+(w^(_|~T))+y[12]+1700485571&4294967295,p=_+(g<<6&4294967295|g>>>26),g=T+(_^(p|~w))+y[3]+2399980690&4294967295,T=p+(g<<10&4294967295|g>>>22),g=w+(p^(T|~_))+y[10]+4293915773&4294967295,w=T+(g<<15&4294967295|g>>>17),g=_+(T^(w|~p))+y[1]+2240044497&4294967295,_=w+(g<<21&4294967295|g>>>11),g=p+(w^(_|~T))+y[8]+1873313359&4294967295,p=_+(g<<6&4294967295|g>>>26),g=T+(_^(p|~w))+y[15]+4264355552&4294967295,T=p+(g<<10&4294967295|g>>>22),g=w+(p^(T|~_))+y[6]+2734768916&4294967295,w=T+(g<<15&4294967295|g>>>17),g=_+(T^(w|~p))+y[13]+1309151649&4294967295,_=w+(g<<21&4294967295|g>>>11),g=p+(w^(_|~T))+y[4]+4149444226&4294967295,p=_+(g<<6&4294967295|g>>>26),g=T+(_^(p|~w))+y[11]+3174756917&4294967295,T=p+(g<<10&4294967295|g>>>22),g=w+(p^(T|~_))+y[2]+718787259&4294967295,w=T+(g<<15&4294967295|g>>>17),g=_+(T^(w|~p))+y[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(w+(g<<21&4294967295|g>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+T&4294967295}r.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var _=p-this.blockSize,y=this.B,w=this.h,T=0;T<p;){if(w==0)for(;T<=_;)i(this,v,T),T+=this.blockSize;if(typeof v=="string"){for(;T<p;)if(y[w++]=v.charCodeAt(T++),w==this.blockSize){i(this,y),w=0;break}}else for(;T<p;)if(y[w++]=v[T++],w==this.blockSize){i(this,y),w=0;break}}this.h=w,this.o+=p},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var _=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=_&255,_/=256;for(this.u(v),v=Array(16),p=_=0;4>p;++p)for(var y=0;32>y;y+=8)v[_++]=this.g[p]>>>y&255;return v};function o(v,p){var _=l;return Object.prototype.hasOwnProperty.call(_,v)?_[v]:_[v]=p(v)}function a(v,p){this.h=p;for(var _=[],y=!0,w=v.length-1;0<=w;w--){var T=v[w]|0;y&&T==p||(_[w]=T,y=!1)}this.g=_}var l={};function h(v){return-128<=v&&128>v?o(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return I;if(0>v)return x(f(-v));for(var p=[],_=1,y=0;v>=_;y++)p[y]=v/_|0,_*=4294967296;return new a(p,0)}function m(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return x(m(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=f(Math.pow(p,8)),y=I,w=0;w<v.length;w+=8){var T=Math.min(8,v.length-w),g=parseInt(v.substring(w,w+T),p);8>T?(T=f(Math.pow(p,T)),y=y.j(T).add(f(g))):(y=y.j(_),y=y.add(f(g)))}return y}var I=h(0),A=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(O(this))return-x(this).m();for(var v=0,p=1,_=0;_<this.g.length;_++){var y=this.i(_);v+=(0<=y?y:4294967296+y)*p,p*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(V(this))return"0";if(O(this))return"-"+x(this).toString(v);for(var p=f(Math.pow(v,6)),_=this,y="";;){var w=tt(_,p).g;_=G(_,w.j(p));var T=((0<_.g.length?_.g[0]:_.h)>>>0).toString(v);if(_=w,V(_))return T+y;for(;6>T.length;)T="0"+T;y=T+y}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function V(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function O(v){return v.h==-1}n.l=function(v){return v=G(this,v),O(v)?-1:V(v)?0:1};function x(v){for(var p=v.g.length,_=[],y=0;y<p;y++)_[y]=~v.g[y];return new a(_,~v.h).add(A)}n.abs=function(){return O(this)?x(this):this},n.add=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0,w=0;w<=p;w++){var T=y+(this.i(w)&65535)+(v.i(w)&65535),g=(T>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);y=g>>>16,T&=65535,g&=65535,_[w]=g<<16|T}return new a(_,_[_.length-1]&-2147483648?-1:0)};function G(v,p){return v.add(x(p))}n.j=function(v){if(V(this)||V(v))return I;if(O(this))return O(v)?x(this).j(x(v)):x(x(this).j(v));if(O(v))return x(this.j(x(v)));if(0>this.l(R)&&0>v.l(R))return f(this.m()*v.m());for(var p=this.g.length+v.g.length,_=[],y=0;y<2*p;y++)_[y]=0;for(y=0;y<this.g.length;y++)for(var w=0;w<v.g.length;w++){var T=this.i(y)>>>16,g=this.i(y)&65535,Ft=v.i(w)>>>16,sn=v.i(w)&65535;_[2*y+2*w]+=g*sn,$(_,2*y+2*w),_[2*y+2*w+1]+=T*sn,$(_,2*y+2*w+1),_[2*y+2*w+1]+=g*Ft,$(_,2*y+2*w+1),_[2*y+2*w+2]+=T*Ft,$(_,2*y+2*w+2)}for(y=0;y<p;y++)_[y]=_[2*y+1]<<16|_[2*y];for(y=p;y<2*p;y++)_[y]=0;return new a(_,0)};function $(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function Q(v,p){this.g=v,this.h=p}function tt(v,p){if(V(p))throw Error("division by zero");if(V(v))return new Q(I,I);if(O(v))return p=tt(x(v),p),new Q(x(p.g),x(p.h));if(O(p))return p=tt(v,x(p)),new Q(x(p.g),p.h);if(30<v.g.length){if(O(v)||O(p))throw Error("slowDivide_ only works with positive integers.");for(var _=A,y=p;0>=y.l(v);)_=It(_),y=It(y);var w=J(_,1),T=J(y,1);for(y=J(y,2),_=J(_,2);!V(y);){var g=T.add(y);0>=g.l(v)&&(w=w.add(_),T=g),y=J(y,1),_=J(_,1)}return p=G(v,w.j(p)),new Q(w,p)}for(w=I;0<=v.l(p);){for(_=Math.max(1,Math.floor(v.m()/p.m())),y=Math.ceil(Math.log(_)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),T=f(_),g=T.j(p);O(g)||0<g.l(v);)_-=y,T=f(_),g=T.j(p);V(T)&&(T=A),w=w.add(T),v=G(v,g)}return new Q(w,v)}n.A=function(v){return tt(this,v).h},n.and=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)&v.i(y);return new a(_,this.h&v.h)},n.or=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)|v.i(y);return new a(_,this.h|v.h)},n.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)^v.i(y);return new a(_,this.h^v.h)};function It(v){for(var p=v.g.length+1,_=[],y=0;y<p;y++)_[y]=v.i(y)<<1|v.i(y-1)>>>31;return new a(_,v.h)}function J(v,p){var _=p>>5;p%=32;for(var y=v.g.length-_,w=[],T=0;T<y;T++)w[T]=0<p?v.i(T+_)>>>p|v.i(T+_+1)<<32-p:v.i(T+_);return new a(w,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,hs=Zu.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,jt=Zu.Integer=a}).apply(typeof Yu<"u"?Yu:typeof self<"u"?self:typeof window<"u"?window:{});var yr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gt={};var ds,zd,Ce,fs,Pn,wr,ms,ps,gs;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,u,c){return s==Array.prototype||s==Object.prototype||(s[u]=c.value),s};function e(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof yr=="object"&&yr];for(var u=0;u<s.length;++u){var c=s[u];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}var r=e(this);function i(s,u){if(u)t:{var c=r;s=s.split(".");for(var d=0;d<s.length-1;d++){var E=s[d];if(!(E in c))break t;c=c[E]}s=s[s.length-1],d=c[s],u=u(d),u!=d&&u!=null&&t(c,s,{configurable:!0,writable:!0,value:u})}}function o(s,u){s instanceof String&&(s+="");var c=0,d=!1,E={next:function(){if(!d&&c<s.length){var b=c++;return{value:u(b,s[b]),done:!1}}return d=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(s){return s||function(){return o(this,function(u,c){return c})}});var a=a||{},l=this||self;function h(s){var u=typeof s;return u=u!="object"?u:s?Array.isArray(s)?"array":u:"null",u=="array"||u=="object"&&typeof s.length=="number"}function f(s){var u=typeof s;return u=="object"&&s!=null||u=="function"}function m(s,u,c){return s.call.apply(s.bind,arguments)}function I(s,u,c){if(!s)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,d),s.apply(u,E)}}return function(){return s.apply(u,arguments)}}function A(s,u,c){return A=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:I,A.apply(null,arguments)}function R(s,u){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();return d.push.apply(d,arguments),s.apply(this,d)}}function V(s,u){function c(){}c.prototype=u.prototype,s.aa=u.prototype,s.prototype=new c,s.prototype.constructor=s,s.Qb=function(d,E,b){for(var C=Array(arguments.length-2),H=2;H<arguments.length;H++)C[H-2]=arguments[H];return u.prototype[E].apply(d,C)}}function O(s){let u=s.length;if(0<u){let c=Array(u);for(let d=0;d<u;d++)c[d]=s[d];return c}return[]}function x(s,u){for(let c=1;c<arguments.length;c++){let d=arguments[c];if(h(d)){let E=s.length||0,b=d.length||0;s.length=E+b;for(let C=0;C<b;C++)s[E+C]=d[C]}else s.push(d)}}class G{constructor(u,c){this.i=u,this.j=c,this.h=0,this.g=null}get(){let u;return 0<this.h?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function $(s){return/^[\s\xa0]*$/.test(s)}function Q(){var s=l.navigator;return s&&(s=s.userAgent)?s:""}function tt(s){return tt[" "](s),s}tt[" "]=function(){};var It=Q().indexOf("Gecko")!=-1&&!(Q().toLowerCase().indexOf("webkit")!=-1&&Q().indexOf("Edge")==-1)&&!(Q().indexOf("Trident")!=-1||Q().indexOf("MSIE")!=-1)&&Q().indexOf("Edge")==-1;function J(s,u,c){for(let d in s)u.call(c,s[d],d,s)}function v(s,u){for(let c in s)u.call(void 0,s[c],c,s)}function p(s){let u={};for(let c in s)u[c]=s[c];return u}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y(s,u){let c,d;for(let E=1;E<arguments.length;E++){d=arguments[E];for(c in d)s[c]=d[c];for(let b=0;b<_.length;b++)c=_[b],Object.prototype.hasOwnProperty.call(d,c)&&(s[c]=d[c])}}function w(s){var u=1;s=s.split(":");let c=[];for(;0<u&&s.length;)c.push(s.shift()),u--;return s.length&&c.push(s.join(":")),c}function T(s){l.setTimeout(()=>{throw s},0)}function g(){var s=vi;let u=null;return s.g&&(u=s.g,s.g=s.g.next,s.g||(s.h=null),u.next=null),u}class Ft{constructor(){this.h=this.g=null}add(u,c){let d=sn.get();d.set(u,c),this.h?this.h.next=d:this.g=d,this.h=d}}var sn=new G(()=>new Hl,s=>s.reset());class Hl{constructor(){this.next=this.g=this.h=null}set(u,c){this.h=u,this.g=c,this.next=null}reset(){this.next=this.g=this.h=null}}let on,an=!1,vi=new Ft,Aa=()=>{let s=l.Promise.resolve(void 0);on=()=>{s.then(Jl)}};var Jl=()=>{for(var s;s=g();){try{s.h.call(s.g)}catch(c){T(c)}var u=sn;u.j(s),100>u.h&&(u.h++,s.next=u.g,u.g=s)}an=!1};function Jt(){this.s=this.s,this.C=this.C}Jt.prototype.s=!1,Jt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Jt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function lt(s,u){this.type=s,this.g=this.target=u,this.defaultPrevented=!1}lt.prototype.h=function(){this.defaultPrevented=!0};var Xl=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var s=!1,u=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let c=()=>{};l.addEventListener("test",c,u),l.removeEventListener("test",c,u)}catch{}return s}();function un(s,u){if(lt.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var c=this.type=s.type,d=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=u,u=s.relatedTarget){if(It){t:{try{tt(u.nodeName);var E=!0;break t}catch{}E=!1}E||(u=null)}}else c=="mouseover"?u=s.fromElement:c=="mouseout"&&(u=s.toElement);this.relatedTarget=u,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:Yl[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&un.aa.h.call(this)}}V(un,lt);var Yl={2:"touch",3:"pen",4:"mouse"};un.prototype.h=function(){un.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var cn="closure_listenable_"+(1e6*Math.random()|0),Zl=0;function th(s,u,c,d,E){this.listener=s,this.proxy=null,this.src=u,this.type=c,this.capture=!!d,this.ha=E,this.key=++Zl,this.da=this.fa=!1}function Hn(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Jn(s){this.src=s,this.g={},this.h=0}Jn.prototype.add=function(s,u,c,d,E){var b=s.toString();s=this.g[b],s||(s=this.g[b]=[],this.h++);var C=Ii(s,u,d,E);return-1<C?(u=s[C],c||(u.fa=!1)):(u=new th(u,this.src,b,!!d,E),u.fa=c,s.push(u)),u};function Ei(s,u){var c=u.type;if(c in s.g){var d=s.g[c],E=Array.prototype.indexOf.call(d,u,void 0),b;(b=0<=E)&&Array.prototype.splice.call(d,E,1),b&&(Hn(u),s.g[c].length==0&&(delete s.g[c],s.h--))}}function Ii(s,u,c,d){for(var E=0;E<s.length;++E){var b=s[E];if(!b.da&&b.listener==u&&b.capture==!!c&&b.ha==d)return E}return-1}var Ti="closure_lm_"+(1e6*Math.random()|0),Ai={};function ba(s,u,c,d,E){if(d&&d.once)return Ra(s,u,c,d,E);if(Array.isArray(u)){for(var b=0;b<u.length;b++)ba(s,u[b],c,d,E);return null}return c=Pi(c),s&&s[cn]?s.K(u,c,f(d)?!!d.capture:!!d,E):Sa(s,u,c,!1,d,E)}function Sa(s,u,c,d,E,b){if(!u)throw Error("Invalid event type");var C=f(E)?!!E.capture:!!E,H=Si(s);if(H||(s[Ti]=H=new Jn(s)),c=H.add(u,c,d,C,b),c.proxy)return c;if(d=eh(),c.proxy=d,d.src=s,d.listener=c,s.addEventListener)Xl||(E=C),E===void 0&&(E=!1),s.addEventListener(u.toString(),d,E);else if(s.attachEvent)s.attachEvent(Da(u.toString()),d);else if(s.addListener&&s.removeListener)s.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return c}function eh(){function s(c){return u.call(s.src,s.listener,c)}let u=nh;return s}function Ra(s,u,c,d,E){if(Array.isArray(u)){for(var b=0;b<u.length;b++)Ra(s,u[b],c,d,E);return null}return c=Pi(c),s&&s[cn]?s.L(u,c,f(d)?!!d.capture:!!d,E):Sa(s,u,c,!0,d,E)}function Pa(s,u,c,d,E){if(Array.isArray(u))for(var b=0;b<u.length;b++)Pa(s,u[b],c,d,E);else d=f(d)?!!d.capture:!!d,c=Pi(c),s&&s[cn]?(s=s.i,u=String(u).toString(),u in s.g&&(b=s.g[u],c=Ii(b,c,d,E),-1<c&&(Hn(b[c]),Array.prototype.splice.call(b,c,1),b.length==0&&(delete s.g[u],s.h--)))):s&&(s=Si(s))&&(u=s.g[u.toString()],s=-1,u&&(s=Ii(u,c,d,E)),(c=-1<s?u[s]:null)&&bi(c))}function bi(s){if(typeof s!="number"&&s&&!s.da){var u=s.src;if(u&&u[cn])Ei(u.i,s);else{var c=s.type,d=s.proxy;u.removeEventListener?u.removeEventListener(c,d,s.capture):u.detachEvent?u.detachEvent(Da(c),d):u.addListener&&u.removeListener&&u.removeListener(d),(c=Si(u))?(Ei(c,s),c.h==0&&(c.src=null,u[Ti]=null)):Hn(s)}}}function Da(s){return s in Ai?Ai[s]:Ai[s]="on"+s}function nh(s,u){if(s.da)s=!0;else{u=new un(u,this);var c=s.listener,d=s.ha||s.src;s.fa&&bi(s),s=c.call(d,u)}return s}function Si(s){return s=s[Ti],s instanceof Jn?s:null}var Ri="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pi(s){return typeof s=="function"?s:(s[Ri]||(s[Ri]=function(u){return s.handleEvent(u)}),s[Ri])}function ht(){Jt.call(this),this.i=new Jn(this),this.M=this,this.F=null}V(ht,Jt),ht.prototype[cn]=!0,ht.prototype.removeEventListener=function(s,u,c,d){Pa(this,s,u,c,d)};function gt(s,u){var c,d=s.F;if(d)for(c=[];d;d=d.F)c.push(d);if(s=s.M,d=u.type||u,typeof u=="string")u=new lt(u,s);else if(u instanceof lt)u.target=u.target||s;else{var E=u;u=new lt(d,s),y(u,E)}if(E=!0,c)for(var b=c.length-1;0<=b;b--){var C=u.g=c[b];E=Xn(C,d,!0,u)&&E}if(C=u.g=s,E=Xn(C,d,!0,u)&&E,E=Xn(C,d,!1,u)&&E,c)for(b=0;b<c.length;b++)C=u.g=c[b],E=Xn(C,d,!1,u)&&E}ht.prototype.N=function(){if(ht.aa.N.call(this),this.i){var s=this.i,u;for(u in s.g){for(var c=s.g[u],d=0;d<c.length;d++)Hn(c[d]);delete s.g[u],s.h--}}this.F=null},ht.prototype.K=function(s,u,c,d){return this.i.add(String(s),u,!1,c,d)},ht.prototype.L=function(s,u,c,d){return this.i.add(String(s),u,!0,c,d)};function Xn(s,u,c,d){if(u=s.i.g[String(u)],!u)return!0;u=u.concat();for(var E=!0,b=0;b<u.length;++b){var C=u[b];if(C&&!C.da&&C.capture==c){var H=C.listener,ct=C.ha||C.src;C.fa&&Ei(s.i,C),E=H.call(ct,d)!==!1&&E}}return E&&!d.defaultPrevented}function Ca(s,u,c){if(typeof s=="function")c&&(s=A(s,c));else if(s&&typeof s.handleEvent=="function")s=A(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(u)?-1:l.setTimeout(s,u||0)}function xa(s){s.g=Ca(()=>{s.g=null,s.i&&(s.i=!1,xa(s))},s.l);let u=s.h;s.h=null,s.m.apply(null,u)}class rh extends Jt{constructor(u,c){super(),this.m=u,this.l=c,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:xa(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ln(s){Jt.call(this),this.h=s,this.g={}}V(ln,Jt);var Va=[];function Na(s){J(s.g,function(u,c){this.g.hasOwnProperty(c)&&bi(u)},s),s.g={}}ln.prototype.N=function(){ln.aa.N.call(this),Na(this)},ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Di=l.JSON.stringify,ih=l.JSON.parse,sh=class{stringify(s){return l.JSON.stringify(s,void 0)}parse(s){return l.JSON.parse(s,void 0)}};function Ci(){}Ci.prototype.h=null;function ka(s){return s.h||(s.h=s.i())}function Oa(){}var hn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function xi(){lt.call(this,"d")}V(xi,lt);function Vi(){lt.call(this,"c")}V(Vi,lt);var he={},Ma=null;function Yn(){return Ma=Ma||new ht}he.La="serverreachability";function Fa(s){lt.call(this,he.La,s)}V(Fa,lt);function dn(s){let u=Yn();gt(u,new Fa(u))}he.STAT_EVENT="statevent";function La(s,u){lt.call(this,he.STAT_EVENT,s),this.stat=u}V(La,lt);function _t(s){let u=Yn();gt(u,new La(u,s))}he.Ma="timingevent";function Ba(s,u){lt.call(this,he.Ma,s),this.size=u}V(Ba,lt);function fn(s,u){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){s()},u)}function mn(){this.g=!0}mn.prototype.xa=function(){this.g=!1};function oh(s,u,c,d,E,b){s.info(function(){if(s.g)if(b)for(var C="",H=b.split("&"),ct=0;ct<H.length;ct++){var K=H[ct].split("=");if(1<K.length){var dt=K[0];K=K[1];var ft=dt.split("_");C=2<=ft.length&&ft[1]=="type"?C+(dt+"="+K+"&"):C+(dt+"=redacted&")}}else C=null;else C=b;return"XMLHTTP REQ ("+d+") [attempt "+E+"]: "+u+`
`+c+`
`+C})}function ah(s,u,c,d,E,b,C){s.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+E+"]: "+u+`
`+c+`
`+b+" "+C})}function Ae(s,u,c,d){s.info(function(){return"XMLHTTP TEXT ("+u+"): "+ch(s,c)+(d?" "+d:"")})}function uh(s,u){s.info(function(){return"TIMEOUT: "+u})}mn.prototype.info=function(){};function ch(s,u){if(!s.g)return u;if(!u)return null;try{var c=JSON.parse(u);if(c){for(s=0;s<c.length;s++)if(Array.isArray(c[s])){var d=c[s];if(!(2>d.length)){var E=d[1];if(Array.isArray(E)&&!(1>E.length)){var b=E[0];if(b!="noop"&&b!="stop"&&b!="close")for(var C=1;C<E.length;C++)E[C]=""}}}}return Di(c)}catch{return u}}var Zn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ua={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ni;function tr(){}V(tr,Ci),tr.prototype.g=function(){return new XMLHttpRequest},tr.prototype.i=function(){return{}},Ni=new tr;function Xt(s,u,c,d){this.j=s,this.i=u,this.l=c,this.R=d||1,this.U=new ln(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new qa}function qa(){this.i=null,this.g="",this.h=!1}var za={},ki={};function Oi(s,u,c){s.L=1,s.v=ir(Lt(u)),s.m=c,s.P=!0,ja(s,null)}function ja(s,u){s.F=Date.now(),er(s),s.A=Lt(s.v);var c=s.A,d=s.R;Array.isArray(d)||(d=[String(d)]),ru(c.i,"t",d),s.C=0,c=s.j.J,s.h=new qa,s.g=Eu(s.j,c?u:null,!s.m),0<s.O&&(s.M=new rh(A(s.Y,s,s.g),s.O)),u=s.U,c=s.g,d=s.ca;var E="readystatechange";Array.isArray(E)||(E&&(Va[0]=E.toString()),E=Va);for(var b=0;b<E.length;b++){var C=ba(c,E[b],d||u.handleEvent,!1,u.h||u);if(!C)break;u.g[C.key]=C}u=s.H?p(s.H):{},s.m?(s.u||(s.u="POST"),u["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,u)):(s.u="GET",s.g.ea(s.A,s.u,null,u)),dn(),oh(s.i,s.u,s.A,s.l,s.R,s.m)}Xt.prototype.ca=function(s){s=s.target;let u=this.M;u&&Bt(s)==3?u.j():this.Y(s)},Xt.prototype.Y=function(s){try{if(s==this.g)t:{let ft=Bt(this.g);var u=this.g.Ba();let Re=this.g.Z();if(!(3>ft)&&(ft!=3||this.g&&(this.h.h||this.g.oa()||lu(this.g)))){this.J||ft!=4||u==7||(u==8||0>=Re?dn(3):dn(2)),Mi(this);var c=this.g.Z();this.X=c;e:if(Ga(this)){var d=lu(this.g);s="";var E=d.length,b=Bt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){de(this),pn(this);var C="";break e}this.h.i=new l.TextDecoder}for(u=0;u<E;u++)this.h.h=!0,s+=this.h.i.decode(d[u],{stream:!(b&&u==E-1)});d.length=0,this.h.g+=s,this.C=0,C=this.h.g}else C=this.g.oa();if(this.o=c==200,ah(this.i,this.u,this.A,this.l,this.R,ft,c),this.o){if(this.T&&!this.K){e:{if(this.g){var H,ct=this.g;if((H=ct.g?ct.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(H)){var K=H;break e}}K=null}if(c=K)Ae(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Fi(this,c);else{this.o=!1,this.s=3,_t(12),de(this),pn(this);break t}}if(this.P){c=!0;let St;for(;!this.J&&this.C<C.length;)if(St=lh(this,C),St==ki){ft==4&&(this.s=4,_t(14),c=!1),Ae(this.i,this.l,null,"[Incomplete Response]");break}else if(St==za){this.s=4,_t(15),Ae(this.i,this.l,C,"[Invalid Chunk]"),c=!1;break}else Ae(this.i,this.l,St,null),Fi(this,St);if(Ga(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ft!=4||C.length!=0||this.h.h||(this.s=1,_t(16),c=!1),this.o=this.o&&c,!c)Ae(this.i,this.l,C,"[Invalid Chunked Response]"),de(this),pn(this);else if(0<C.length&&!this.W){this.W=!0;var dt=this.j;dt.g==this&&dt.ba&&!dt.M&&(dt.j.info("Great, no buffering proxy detected. Bytes received: "+C.length),ji(dt),dt.M=!0,_t(11))}}else Ae(this.i,this.l,C,null),Fi(this,C);ft==4&&de(this),this.o&&!this.J&&(ft==4?_u(this.j,this):(this.o=!1,er(this)))}else Rh(this.g),c==400&&0<C.indexOf("Unknown SID")?(this.s=3,_t(12)):(this.s=0,_t(13)),de(this),pn(this)}}}catch{}finally{}};function Ga(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function lh(s,u){var c=s.C,d=u.indexOf(`
`,c);return d==-1?ki:(c=Number(u.substring(c,d)),isNaN(c)?za:(d+=1,d+c>u.length?ki:(u=u.slice(d,d+c),s.C=d+c,u)))}Xt.prototype.cancel=function(){this.J=!0,de(this)};function er(s){s.S=Date.now()+s.I,$a(s,s.I)}function $a(s,u){if(s.B!=null)throw Error("WatchDog timer not null");s.B=fn(A(s.ba,s),u)}function Mi(s){s.B&&(l.clearTimeout(s.B),s.B=null)}Xt.prototype.ba=function(){this.B=null;let s=Date.now();0<=s-this.S?(uh(this.i,this.A),this.L!=2&&(dn(),_t(17)),de(this),this.s=2,pn(this)):$a(this,this.S-s)};function pn(s){s.j.G==0||s.J||_u(s.j,s)}function de(s){Mi(s);var u=s.M;u&&typeof u.ma=="function"&&u.ma(),s.M=null,Na(s.U),s.g&&(u=s.g,s.g=null,u.abort(),u.ma())}function Fi(s,u){try{var c=s.j;if(c.G!=0&&(c.g==s||Li(c.h,s))){if(!s.K&&Li(c.h,s)&&c.G==3){try{var d=c.Da.g.parse(u)}catch{d=null}if(Array.isArray(d)&&d.length==3){var E=d;if(E[0]==0){t:if(!c.u){if(c.g)if(c.g.F+3e3<s.F)cr(c),ar(c);else break t;zi(c),_t(18)}}else c.za=E[1],0<c.za-c.T&&37500>E[2]&&c.F&&c.v==0&&!c.C&&(c.C=fn(A(c.Za,c),6e3));if(1>=Wa(c.h)&&c.ca){try{c.ca()}catch{}c.ca=void 0}}else me(c,11)}else if((s.K||c.g==s)&&cr(c),!$(u))for(E=c.Da.g.parse(u),u=0;u<E.length;u++){let K=E[u];if(c.T=K[0],K=K[1],c.G==2)if(K[0]=="c"){c.K=K[1],c.ia=K[2];let dt=K[3];dt!=null&&(c.la=dt,c.j.info("VER="+c.la));let ft=K[4];ft!=null&&(c.Aa=ft,c.j.info("SVER="+c.Aa));let Re=K[5];Re!=null&&typeof Re=="number"&&0<Re&&(d=1.5*Re,c.L=d,c.j.info("backChannelRequestTimeoutMs_="+d)),d=c;let St=s.g;if(St){let hr=St.g?St.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hr){var b=d.h;b.g||hr.indexOf("spdy")==-1&&hr.indexOf("quic")==-1&&hr.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(Bi(b,b.h),b.h=null))}if(d.D){let Gi=St.g?St.g.getResponseHeader("X-HTTP-Session-Id"):null;Gi&&(d.ya=Gi,X(d.I,d.D,Gi))}}c.G=3,c.l&&c.l.ua(),c.ba&&(c.R=Date.now()-s.F,c.j.info("Handshake RTT: "+c.R+"ms")),d=c;var C=s;if(d.qa=vu(d,d.J?d.ia:null,d.W),C.K){Ha(d.h,C);var H=C,ct=d.L;ct&&(H.I=ct),H.B&&(Mi(H),er(H)),d.g=C}else pu(d);0<c.i.length&&ur(c)}else K[0]!="stop"&&K[0]!="close"||me(c,7);else c.G==3&&(K[0]=="stop"||K[0]=="close"?K[0]=="stop"?me(c,7):qi(c):K[0]!="noop"&&c.l&&c.l.ta(K),c.v=0)}}dn(4)}catch{}}var hh=class{constructor(s,u){this.g=s,this.map=u}};function Ka(s){this.l=s||10,l.PerformanceNavigationTiming?(s=l.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qa(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Wa(s){return s.h?1:s.g?s.g.size:0}function Li(s,u){return s.h?s.h==u:s.g?s.g.has(u):!1}function Bi(s,u){s.g?s.g.add(u):s.h=u}function Ha(s,u){s.h&&s.h==u?s.h=null:s.g&&s.g.has(u)&&s.g.delete(u)}Ka.prototype.cancel=function(){if(this.i=Ja(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function Ja(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let u=s.i;for(let c of s.g.values())u=u.concat(c.D);return u}return O(s.i)}function dh(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(h(s)){for(var u=[],c=s.length,d=0;d<c;d++)u.push(s[d]);return u}u=[],c=0;for(d in s)u[c++]=s[d];return u}function fh(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(h(s)||typeof s=="string"){var u=[];s=s.length;for(var c=0;c<s;c++)u.push(c);return u}u=[],c=0;for(let d in s)u[c++]=d;return u}}}function Xa(s,u){if(s.forEach&&typeof s.forEach=="function")s.forEach(u,void 0);else if(h(s)||typeof s=="string")Array.prototype.forEach.call(s,u,void 0);else for(var c=fh(s),d=dh(s),E=d.length,b=0;b<E;b++)u.call(void 0,d[b],c&&c[b],s)}var Ya=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mh(s,u){if(s){s=s.split("&");for(var c=0;c<s.length;c++){var d=s[c].indexOf("="),E=null;if(0<=d){var b=s[c].substring(0,d);E=s[c].substring(d+1)}else b=s[c];u(b,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function fe(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof fe){this.h=s.h,nr(this,s.j),this.o=s.o,this.g=s.g,rr(this,s.s),this.l=s.l;var u=s.i,c=new yn;c.i=u.i,u.g&&(c.g=new Map(u.g),c.h=u.h),Za(this,c),this.m=s.m}else s&&(u=String(s).match(Ya))?(this.h=!1,nr(this,u[1]||"",!0),this.o=gn(u[2]||""),this.g=gn(u[3]||"",!0),rr(this,u[4]),this.l=gn(u[5]||"",!0),Za(this,u[6]||"",!0),this.m=gn(u[7]||"")):(this.h=!1,this.i=new yn(null,this.h))}fe.prototype.toString=function(){var s=[],u=this.j;u&&s.push(_n(u,tu,!0),":");var c=this.g;return(c||u=="file")&&(s.push("//"),(u=this.o)&&s.push(_n(u,tu,!0),"@"),s.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.s,c!=null&&s.push(":",String(c))),(c=this.l)&&(this.g&&c.charAt(0)!="/"&&s.push("/"),s.push(_n(c,c.charAt(0)=="/"?_h:gh,!0))),(c=this.i.toString())&&s.push("?",c),(c=this.m)&&s.push("#",_n(c,wh)),s.join("")};function Lt(s){return new fe(s)}function nr(s,u,c){s.j=c?gn(u,!0):u,s.j&&(s.j=s.j.replace(/:$/,""))}function rr(s,u){if(u){if(u=Number(u),isNaN(u)||0>u)throw Error("Bad port number "+u);s.s=u}else s.s=null}function Za(s,u,c){u instanceof yn?(s.i=u,vh(s.i,s.h)):(c||(u=_n(u,yh)),s.i=new yn(u,s.h))}function X(s,u,c){s.i.set(u,c)}function ir(s){return X(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function gn(s,u){return s?u?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function _n(s,u,c){return typeof s=="string"?(s=encodeURI(s).replace(u,ph),c&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function ph(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var tu=/[#\/\?@]/g,gh=/[#\?:]/g,_h=/[#\?]/g,yh=/[#\?@]/g,wh=/#/g;function yn(s,u){this.h=this.g=null,this.i=s||null,this.j=!!u}function Yt(s){s.g||(s.g=new Map,s.h=0,s.i&&mh(s.i,function(u,c){s.add(decodeURIComponent(u.replace(/\+/g," ")),c)}))}n=yn.prototype,n.add=function(s,u){Yt(this),this.i=null,s=be(this,s);var c=this.g.get(s);return c||this.g.set(s,c=[]),c.push(u),this.h+=1,this};function eu(s,u){Yt(s),u=be(s,u),s.g.has(u)&&(s.i=null,s.h-=s.g.get(u).length,s.g.delete(u))}function nu(s,u){return Yt(s),u=be(s,u),s.g.has(u)}n.forEach=function(s,u){Yt(this),this.g.forEach(function(c,d){c.forEach(function(E){s.call(u,E,d,this)},this)},this)},n.na=function(){Yt(this);let s=Array.from(this.g.values()),u=Array.from(this.g.keys()),c=[];for(let d=0;d<u.length;d++){let E=s[d];for(let b=0;b<E.length;b++)c.push(u[d])}return c},n.V=function(s){Yt(this);let u=[];if(typeof s=="string")nu(this,s)&&(u=u.concat(this.g.get(be(this,s))));else{s=Array.from(this.g.values());for(let c=0;c<s.length;c++)u=u.concat(s[c])}return u},n.set=function(s,u){return Yt(this),this.i=null,s=be(this,s),nu(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[u]),this.h+=1,this},n.get=function(s,u){return s?(s=this.V(s),0<s.length?String(s[0]):u):u};function ru(s,u,c){eu(s,u),0<c.length&&(s.i=null,s.g.set(be(s,u),O(c)),s.h+=c.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],u=Array.from(this.g.keys());for(var c=0;c<u.length;c++){var d=u[c];let b=encodeURIComponent(String(d)),C=this.V(d);for(d=0;d<C.length;d++){var E=b;C[d]!==""&&(E+="="+encodeURIComponent(String(C[d]))),s.push(E)}}return this.i=s.join("&")};function be(s,u){return u=String(u),s.j&&(u=u.toLowerCase()),u}function vh(s,u){u&&!s.j&&(Yt(s),s.i=null,s.g.forEach(function(c,d){var E=d.toLowerCase();d!=E&&(eu(this,d),ru(this,E,c))},s)),s.j=u}function Eh(s,u){let c=new mn;if(l.Image){let d=new Image;d.onload=R(Zt,c,"TestLoadImage: loaded",!0,u,d),d.onerror=R(Zt,c,"TestLoadImage: error",!1,u,d),d.onabort=R(Zt,c,"TestLoadImage: abort",!1,u,d),d.ontimeout=R(Zt,c,"TestLoadImage: timeout",!1,u,d),l.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=s}else u(!1)}function Ih(s,u){let c=new mn,d=new AbortController,E=setTimeout(()=>{d.abort(),Zt(c,"TestPingServer: timeout",!1,u)},1e4);fetch(s,{signal:d.signal}).then(b=>{clearTimeout(E),b.ok?Zt(c,"TestPingServer: ok",!0,u):Zt(c,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(E),Zt(c,"TestPingServer: error",!1,u)})}function Zt(s,u,c,d,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),d(c)}catch{}}function Th(){this.g=new sh}function Ah(s,u,c){let d=c||"";try{Xa(s,function(E,b){let C=E;f(E)&&(C=Di(E)),u.push(d+b+"="+encodeURIComponent(C))})}catch(E){throw u.push(d+"type="+encodeURIComponent("_badmap")),E}}function wn(s){this.l=s.Ub||null,this.j=s.eb||!1}V(wn,Ci),wn.prototype.g=function(){return new sr(this.l,this.j)},wn.prototype.i=function(s){return function(){return s}}({});function sr(s,u){ht.call(this),this.D=s,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(sr,ht),n=sr.prototype,n.open=function(s,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=u,this.readyState=1,En(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let u={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(u.body=s),(this.D||l).fetch(new Request(this.A,u)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,vn(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;iu(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function iu(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var u=s.value?s.value:new Uint8Array(0);(u=this.v.decode(u,{stream:!s.done}))&&(this.response=this.responseText+=u)}s.done?vn(this):En(this),this.readyState==3&&iu(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,vn(this))},n.Qa=function(s){this.g&&(this.response=s,vn(this))},n.ga=function(){this.g&&vn(this)};function vn(s){s.readyState=4,s.l=null,s.j=null,s.v=null,En(s)}n.setRequestHeader=function(s,u){this.u.append(s,u)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],u=this.h.entries();for(var c=u.next();!c.done;)c=c.value,s.push(c[0]+": "+c[1]),c=u.next();return s.join(`\r
`)};function En(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(sr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function su(s){let u="";return J(s,function(c,d){u+=d,u+=":",u+=c,u+=`\r
`}),u}function Ui(s,u,c){t:{for(d in c){var d=!1;break t}d=!0}d||(c=su(c),typeof s=="string"?c!=null&&encodeURIComponent(String(c)):X(s,u,c))}function et(s){ht.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(et,ht);var bh=/^https?$/i,Sh=["POST","PUT"];n=et.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,u,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);u=u?u.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ni.g(),this.v=this.o?ka(this.o):ka(Ni),this.g.onreadystatechange=A(this.Ea,this);try{this.B=!0,this.g.open(u,String(s),!0),this.B=!1}catch(b){ou(this,b);return}if(s=c||"",c=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var E in d)c.set(E,d[E]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let b of d.keys())c.set(b,d.get(b));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(c.keys()).find(b=>b.toLowerCase()=="content-type"),E=l.FormData&&s instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Sh,u,void 0))||d||E||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,C]of c)this.g.setRequestHeader(b,C);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{cu(this),this.u=!0,this.g.send(s),this.u=!1}catch(b){ou(this,b)}};function ou(s,u){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=u,s.m=5,au(s),or(s)}function au(s){s.A||(s.A=!0,gt(s,"complete"),gt(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,gt(this,"complete"),gt(this,"abort"),or(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),or(this,!0)),et.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?uu(this):this.bb())},n.bb=function(){uu(this)};function uu(s){if(s.h&&typeof a<"u"&&(!s.v[1]||Bt(s)!=4||s.Z()!=2)){if(s.u&&Bt(s)==4)Ca(s.Ea,0,s);else if(gt(s,"readystatechange"),Bt(s)==4){s.h=!1;try{let C=s.Z();t:switch(C){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break t;default:u=!1}var c;if(!(c=u)){var d;if(d=C===0){var E=String(s.D).match(Ya)[1]||null;!E&&l.self&&l.self.location&&(E=l.self.location.protocol.slice(0,-1)),d=!bh.test(E?E.toLowerCase():"")}c=d}if(c)gt(s,"complete"),gt(s,"success");else{s.m=6;try{var b=2<Bt(s)?s.g.statusText:""}catch{b=""}s.l=b+" ["+s.Z()+"]",au(s)}}finally{or(s)}}}}function or(s,u){if(s.g){cu(s);let c=s.g,d=s.v[0]?()=>{}:null;s.g=null,s.v=null,u||gt(s,"ready");try{c.onreadystatechange=d}catch{}}}function cu(s){s.I&&(l.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function Bt(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<Bt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var u=this.g.responseText;return s&&u.indexOf(s)==0&&(u=u.substring(s.length)),ih(u)}};function lu(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Rh(s){let u={};s=(s.g&&2<=Bt(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<s.length;d++){if($(s[d]))continue;var c=w(s[d]);let E=c[0];if(c=c[1],typeof c!="string")continue;c=c.trim();let b=u[E]||[];u[E]=b,b.push(c)}v(u,function(d){return d.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function In(s,u,c){return c&&c.internalChannelParams&&c.internalChannelParams[s]||u}function hu(s){this.Aa=0,this.i=[],this.j=new mn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=In("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=In("baseRetryDelayMs",5e3,s),this.cb=In("retryDelaySeedMs",1e4,s),this.Wa=In("forwardChannelMaxRetries",2,s),this.wa=In("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new Ka(s&&s.concurrentRequestLimit),this.Da=new Th,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=hu.prototype,n.la=8,n.G=1,n.connect=function(s,u,c,d){_t(0),this.W=s,this.H=u||{},c&&d!==void 0&&(this.H.OSID=c,this.H.OAID=d),this.F=this.X,this.I=vu(this,null,this.W),ur(this)};function qi(s){if(du(s),s.G==3){var u=s.U++,c=Lt(s.I);if(X(c,"SID",s.K),X(c,"RID",u),X(c,"TYPE","terminate"),Tn(s,c),u=new Xt(s,s.j,u),u.L=2,u.v=ir(Lt(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(u.v.toString(),"")}catch{}!c&&l.Image&&(new Image().src=u.v,c=!0),c||(u.g=Eu(u.j,null),u.g.ea(u.v)),u.F=Date.now(),er(u)}wu(s)}function ar(s){s.g&&(ji(s),s.g.cancel(),s.g=null)}function du(s){ar(s),s.u&&(l.clearTimeout(s.u),s.u=null),cr(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&l.clearTimeout(s.s),s.s=null)}function ur(s){if(!Qa(s.h)&&!s.s){s.s=!0;var u=s.Ga;on||Aa(),an||(on(),an=!0),vi.add(u,s),s.B=0}}function Ph(s,u){return Wa(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=u.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=fn(A(s.Ga,s,u),yu(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;let E=new Xt(this,this.j,s),b=this.o;if(this.S&&(b?(b=p(b),y(b,this.S)):b=this.S),this.m!==null||this.O||(E.H=b,b=null),this.P)t:{for(var u=0,c=0;c<this.i.length;c++){e:{var d=this.i[c];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(u+=d,4096<u){u=c;break t}if(u===4096||c===this.i.length-1){u=c+1;break t}}u=1e3}else u=1e3;u=mu(this,E,u),c=Lt(this.I),X(c,"RID",s),X(c,"CVER",22),this.D&&X(c,"X-HTTP-Session-Id",this.D),Tn(this,c),b&&(this.O?u="headers="+encodeURIComponent(String(su(b)))+"&"+u:this.m&&Ui(c,this.m,b)),Bi(this.h,E),this.Ua&&X(c,"TYPE","init"),this.P?(X(c,"$req",u),X(c,"SID","null"),E.T=!0,Oi(E,c,null)):Oi(E,c,u),this.G=2}}else this.G==3&&(s?fu(this,s):this.i.length==0||Qa(this.h)||fu(this))};function fu(s,u){var c;u?c=u.l:c=s.U++;let d=Lt(s.I);X(d,"SID",s.K),X(d,"RID",c),X(d,"AID",s.T),Tn(s,d),s.m&&s.o&&Ui(d,s.m,s.o),c=new Xt(s,s.j,c,s.B+1),s.m===null&&(c.H=s.o),u&&(s.i=u.D.concat(s.i)),u=mu(s,c,1e3),c.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),Bi(s.h,c),Oi(c,d,u)}function Tn(s,u){s.H&&J(s.H,function(c,d){X(u,d,c)}),s.l&&Xa({},function(c,d){X(u,d,c)})}function mu(s,u,c){c=Math.min(s.i.length,c);var d=s.l?A(s.l.Na,s.l,s):null;t:{var E=s.i;let b=-1;for(;;){let C=["count="+c];b==-1?0<c?(b=E[0].g,C.push("ofs="+b)):b=0:C.push("ofs="+b);let H=!0;for(let ct=0;ct<c;ct++){let K=E[ct].g,dt=E[ct].map;if(K-=b,0>K)b=Math.max(0,E[ct].g-100),H=!1;else try{Ah(dt,C,"req"+K+"_")}catch{d&&d(dt)}}if(H){d=C.join("&");break t}}}return s=s.i.splice(0,c),u.D=s,d}function pu(s){if(!s.g&&!s.u){s.Y=1;var u=s.Fa;on||Aa(),an||(on(),an=!0),vi.add(u,s),s.v=0}}function zi(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=fn(A(s.Fa,s),yu(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,gu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=fn(A(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,_t(10),ar(this),gu(this))};function ji(s){s.A!=null&&(l.clearTimeout(s.A),s.A=null)}function gu(s){s.g=new Xt(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var u=Lt(s.qa);X(u,"RID","rpc"),X(u,"SID",s.K),X(u,"AID",s.T),X(u,"CI",s.F?"0":"1"),!s.F&&s.ja&&X(u,"TO",s.ja),X(u,"TYPE","xmlhttp"),Tn(s,u),s.m&&s.o&&Ui(u,s.m,s.o),s.L&&(s.g.I=s.L);var c=s.g;s=s.ia,c.L=1,c.v=ir(Lt(u)),c.m=null,c.P=!0,ja(c,s)}n.Za=function(){this.C!=null&&(this.C=null,ar(this),zi(this),_t(19))};function cr(s){s.C!=null&&(l.clearTimeout(s.C),s.C=null)}function _u(s,u){var c=null;if(s.g==u){cr(s),ji(s),s.g=null;var d=2}else if(Li(s.h,u))c=u.D,Ha(s.h,u),d=1;else return;if(s.G!=0){if(u.o)if(d==1){c=u.m?u.m.length:0,u=Date.now()-u.F;var E=s.B;d=Yn(),gt(d,new Ba(d,c)),ur(s)}else pu(s);else if(E=u.s,E==3||E==0&&0<u.X||!(d==1&&Ph(s,u)||d==2&&zi(s)))switch(c&&0<c.length&&(u=s.h,u.i=u.i.concat(c)),E){case 1:me(s,5);break;case 4:me(s,10);break;case 3:me(s,6);break;default:me(s,2)}}}function yu(s,u){let c=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(c*=2),c*u}function me(s,u){if(s.j.info("Error code "+u),u==2){var c=A(s.fb,s),d=s.Xa;let E=!d;d=new fe(d||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||nr(d,"https"),ir(d),E?Eh(d.toString(),c):Ih(d.toString(),c)}else _t(2);s.G=0,s.l&&s.l.sa(u),wu(s),du(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),_t(2)):(this.j.info("Failed to ping google.com"),_t(1))};function wu(s){if(s.G=0,s.ka=[],s.l){let u=Ja(s.h);(u.length!=0||s.i.length!=0)&&(x(s.ka,u),x(s.ka,s.i),s.h.i.length=0,O(s.i),s.i.length=0),s.l.ra()}}function vu(s,u,c){var d=c instanceof fe?Lt(c):new fe(c);if(d.g!="")u&&(d.g=u+"."+d.g),rr(d,d.s);else{var E=l.location;d=E.protocol,u=u?u+"."+E.hostname:E.hostname,E=+E.port;var b=new fe(null);d&&nr(b,d),u&&(b.g=u),E&&rr(b,E),c&&(b.l=c),d=b}return c=s.D,u=s.ya,c&&u&&X(d,c,u),X(d,"VER",s.la),Tn(s,d),d}function Eu(s,u,c){if(u&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return u=s.Ca&&!s.pa?new et(new wn({eb:c})):new et(s.pa),u.Ha(s.J),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Iu(){}n=Iu.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function lr(){}lr.prototype.g=function(s,u){return new wt(s,u)};function wt(s,u){ht.call(this),this.g=new hu(u),this.l=s,this.h=u&&u.messageUrlParams||null,s=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(s?s["X-WebChannel-Content-Type"]=u.messageContentType:s={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.va&&(s?s["X-WebChannel-Client-Profile"]=u.va:s={"X-WebChannel-Client-Profile":u.va}),this.g.S=s,(s=u&&u.Sb)&&!$(s)&&(this.g.m=s),this.v=u&&u.supportsCrossDomainXhr||!1,this.u=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!$(u)&&(this.g.D=u,s=this.h,s!==null&&u in s&&(s=this.h,u in s&&delete s[u])),this.j=new Se(this)}V(wt,ht),wt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},wt.prototype.close=function(){qi(this.g)},wt.prototype.o=function(s){var u=this.g;if(typeof s=="string"){var c={};c.__data__=s,s=c}else this.u&&(c={},c.__data__=Di(s),s=c);u.i.push(new hh(u.Ya++,s)),u.G==3&&ur(u)},wt.prototype.N=function(){this.g.l=null,delete this.j,qi(this.g),delete this.g,wt.aa.N.call(this)};function Tu(s){xi.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var u=s.__sm__;if(u){t:{for(let c in u){s=c;break t}s=void 0}(this.i=s)&&(s=this.i,u=u!==null&&s in u?u[s]:void 0),this.data=u}else this.data=s}V(Tu,xi);function Au(){Vi.call(this),this.status=1}V(Au,Vi);function Se(s){this.g=s}V(Se,Iu),Se.prototype.ua=function(){gt(this.g,"a")},Se.prototype.ta=function(s){gt(this.g,new Tu(s))},Se.prototype.sa=function(s){gt(this.g,new Au)},Se.prototype.ra=function(){gt(this.g,"b")},lr.prototype.createWebChannel=lr.prototype.g,wt.prototype.send=wt.prototype.o,wt.prototype.open=wt.prototype.m,wt.prototype.close=wt.prototype.close,gs=Gt.createWebChannelTransport=function(){return new lr},ps=Gt.getStatEventTarget=function(){return Yn()},ms=Gt.Event=he,wr=Gt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Zn.NO_ERROR=0,Zn.TIMEOUT=8,Zn.HTTP_ERROR=6,Pn=Gt.ErrorCode=Zn,Ua.COMPLETE="complete",fs=Gt.EventType=Ua,Oa.EventType=hn,hn.OPEN="a",hn.CLOSE="b",hn.ERROR="c",hn.MESSAGE="d",ht.prototype.listen=ht.prototype.K,Ce=Gt.WebChannel=Oa,zd=Gt.FetchXmlHttpFactory=wn,et.prototype.listenOnce=et.prototype.L,et.prototype.getLastError=et.prototype.Ka,et.prototype.getLastErrorCode=et.prototype.Ba,et.prototype.getStatus=et.prototype.Z,et.prototype.getResponseJson=et.prototype.Oa,et.prototype.getResponseText=et.prototype.oa,et.prototype.send=et.prototype.ea,et.prototype.setWithCredentials=et.prototype.Ha,ds=Gt.XhrIo=et}).apply(typeof yr<"u"?yr:typeof self<"u"?self:typeof window<"u"?window:{});var tc="@firebase/firestore";var at=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};at.UNAUTHENTICATED=new at(null),at.GOOGLE_CREDENTIALS=new at("google-credentials-uid"),at.FIRST_PARTY=new at("first-party-uid"),at.MOCK_USER=new at("mock-user");var Ze="11.2.0";var ye=new De("@firebase/firestore");function xe(){return ye.logLevel}function k(n,...t){if(ye.logLevel<=z.DEBUG){let e=t.map(ia);ye.debug(`Firestore (${Ze}): ${n}`,...e)}}function $t(n,...t){if(ye.logLevel<=z.ERROR){let e=t.map(ia);ye.error(`Firestore (${Ze}): ${n}`,...e)}}function Le(n,...t){if(ye.logLevel<=z.WARN){let e=t.map(ia);ye.warn(`Firestore (${Ze}): ${n}`,...e)}}function ia(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function F(n="Unexpected state"){let t=`FIRESTORE (${Ze}) INTERNAL ASSERTION FAILED: `+n;throw $t(t),new Error(t)}function W(n,t){n||F()}function L(n,t){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends Ut{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var bt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Sr=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Es=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(at.UNAUTHENTICATED))}shutdown(){}},Is=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ts=class{constructor(t){this.t=t,this.currentUser=at.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){W(this.o===void 0);let r=this.i,i=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve(),o=new bt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new bt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;t.enqueueRetryable(()=>D(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},l=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new bt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(W(typeof r.accessToken=="string"),new Sr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return W(t===null||typeof t=="string"),new at(t)}},As=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=at.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},bs=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new As(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(at.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ss=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Rs=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){W(this.o===void 0);let r=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.R;return this.R=o.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let i=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?i(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(W(typeof e.token=="string"),this.R=e.token,new Ss(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function jd(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var Rr=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=jd(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<e&&(r+=t.charAt(i[o]%t.length))}return r}};function q(n,t){return n<t?-1:n>t?1:0}function Be(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}var ot=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new N(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new N(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new N(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new ot(0,0))}static max(){return new n(new ot(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Pr=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&F(),r===void 0?r=t.length-e:r>t.length-e&&F(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let i=0;i<r;i++){let o=n.compareSegments(t.get(i),e.get(i));if(o!==0)return o}return Math.sign(t.length-e.length)}static compareSegments(t,e){let r=n.isNumericId(t),i=n.isNumericId(e);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(t).compare(n.extractNumericId(e)):t<e?-1:t>e?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return jt.fromString(t.substring(4,t.length-2))}},Z=class n extends Pr{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new N(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new n(e)}static emptyPath(){return new n([])}},Gd=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Et=class n extends Pr{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return Gd.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",i=0,o=()=>{if(r.length===0)throw new N(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},a=!1;for(;i<t.length;){let l=t[i];if(l==="\\"){if(i+1===t.length)throw new N(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let h=t[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new N(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(o(),i++)}if(o(),a)throw new N(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var M=class n{constructor(t){this.path=t}static fromPath(t){return new n(Z.fromString(t))}static fromName(t){return new n(Z.fromString(t).popFirst(5))}static empty(){return new n(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Z.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Z.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new Z(t.slice()))}};var Ps=class{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}};Ps.UNKNOWN_ID=-1;function $d(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=B.fromTimestamp(r===1e9?new ot(e+1,0):new ot(e,r));return new we(i,M.empty(),t)}function Kd(n){return new we(n.readTime,n.key,-1)}var we=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(B.min(),M.empty(),-1)}static max(){return new n(B.max(),M.empty(),-1)}};function Qd(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:q(n.largestBatchId,t.largestBatchId))}var Wd="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ds=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function tn(n){return D(this,null,function*(){if(n.code!==S.FAILED_PRECONDITION||n.message!==Wd)throw n;k("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let i=0,o=0,a=!1;t.forEach(l=>{++i,l.next(()=>{++o,a&&o===i&&e()},h=>r(h))}),a=!0,o===i&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(i=>i?n.resolve(i):r());return e}static forEach(t,e){let r=[];return t.forEach((i,o)=>{r.push(e.call(this,i,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,i)=>{let o=t.length,a=new Array(o),l=0;for(let h=0;h<o;h++){let f=h;e(t[f]).next(m=>{a[f]=m,++l,l===o&&r(a)},m=>i(m))}})}static doWhile(t,e){return new n((r,i)=>{let o=()=>{t()===!0?e().next(()=>{o()},i):r()};o()})}};function Hd(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function en(n){return n.name==="IndexedDbTransactionError"}var sa=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return n.oe=-1,n})();function ai(n){return n==null}function kn(n){return n===0&&1/n==-1/0}function Jd(n){return typeof n=="number"&&Number.isInteger(n)&&!kn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Xd(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=ec(t)),t=Yd(n.get(e),t);return ec(t)}function Yd(n,t){let e=t,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":e+="";break;case"":e+="";break;default:e+=o}}return e}function ec(n){return n+""}var Zd=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Fp=[...Zd,"documentOverlays"],tf=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ef=tf,nf=[...ef,"indexConfiguration","indexState","indexEntries"];var Lp=[...nf,"globals"];function nc(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function ce(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Oc(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var nt=class n{constructor(t,e){this.comparator=t,this.root=e||xt.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,xt.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,xt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Oe(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Oe(this.root,t,this.comparator,!1)}getReverseIterator(){return new Oe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Oe(this.root,t,this.comparator,!0)}},Oe=class{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},xt=class n{constructor(t,e,r,i,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,o){return new n(t??this.key,e??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this,o=r(t,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(t,e,r),null):o===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw F();let t=this.left.check();if(t!==this.right.check())throw F();return t+(this.isRed()?0:1)}};xt.EMPTY=null,xt.RED=!0,xt.BLACK=!1;xt.EMPTY=new class{constructor(){this.size=0}get key(){throw F()}get value(){throw F()}get color(){throw F()}get left(){throw F()}get right(){throw F()}copy(t,e,r,i,o){return this}insert(t,e,r){return new xt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ut=class n{constructor(t){this.comparator=t,this.data=new nt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Dr(this.data.getIterator())}getIteratorFrom(t){return new Dr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Dr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var At=class n{constructor(t){this.fields=t,t.sort(Et.comparator)}static empty(){return new n([])}unionWith(t){let e=new ut(Et.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Be(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Cr=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var pt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Cr("Invalid base64 string: "+o):o}}(t);return new n(e)}static fromUint8Array(t){let e=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};pt.EMPTY_BYTE_STRING=new pt("");var rf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kt(n){if(W(!!n),typeof n=="string"){let t=0,e=rf.exec(n);if(W(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Y(n.seconds),nanos:Y(n.nanos)}}function Y(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Qt(n){return typeof n=="string"?pt.fromBase64String(n):pt.fromUint8Array(n)}function oa(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function ui(n){let t=n.mapValue.fields.__previous_value__;return oa(t)?ui(t):t}function On(n){let t=Kt(n.mapValue.fields.__local_write_time__.timestampValue);return new ot(t.seconds,t.nanos)}var Cs=class{constructor(t,e,r,i,o,a,l,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f}},xr=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var vr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function se(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?oa(n)?4:Fc(n)?9007199254740991:Mc(n)?10:11:F()}function kt(n,t){if(n===t)return!0;let e=se(n);if(e!==se(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return On(n).isEqual(On(t));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=Kt(i.timestampValue),l=Kt(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(i,o){return Qt(i.bytesValue).isEqual(Qt(o.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,o){return Y(i.geoPointValue.latitude)===Y(o.geoPointValue.latitude)&&Y(i.geoPointValue.longitude)===Y(o.geoPointValue.longitude)}(n,t);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return Y(i.integerValue)===Y(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=Y(i.doubleValue),l=Y(o.doubleValue);return a===l?kn(a)===kn(l):isNaN(a)&&isNaN(l)}return!1}(n,t);case 9:return Be(n.arrayValue.values||[],t.arrayValue.values||[],kt);case 10:case 11:return function(i,o){let a=i.mapValue.fields||{},l=o.mapValue.fields||{};if(nc(a)!==nc(l))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!kt(a[h],l[h])))return!1;return!0}(n,t);default:return F()}}function Mn(n,t){return(n.values||[]).find(e=>kt(e,t))!==void 0}function Ue(n,t){if(n===t)return 0;let e=se(n),r=se(t);if(e!==r)return q(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,t.booleanValue);case 2:return function(o,a){let l=Y(o.integerValue||o.doubleValue),h=Y(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(n,t);case 3:return rc(n.timestampValue,t.timestampValue);case 4:return rc(On(n),On(t));case 5:return q(n.stringValue,t.stringValue);case 6:return function(o,a){let l=Qt(o),h=Qt(a);return l.compareTo(h)}(n.bytesValue,t.bytesValue);case 7:return function(o,a){let l=o.split("/"),h=a.split("/");for(let f=0;f<l.length&&f<h.length;f++){let m=q(l[f],h[f]);if(m!==0)return m}return q(l.length,h.length)}(n.referenceValue,t.referenceValue);case 8:return function(o,a){let l=q(Y(o.latitude),Y(a.latitude));return l!==0?l:q(Y(o.longitude),Y(a.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return ic(n.arrayValue,t.arrayValue);case 10:return function(o,a){var l,h,f,m;let I=o.fields||{},A=a.fields||{},R=(l=I.value)===null||l===void 0?void 0:l.arrayValue,V=(h=A.value)===null||h===void 0?void 0:h.arrayValue,O=q(((f=R?.values)===null||f===void 0?void 0:f.length)||0,((m=V?.values)===null||m===void 0?void 0:m.length)||0);return O!==0?O:ic(R,V)}(n.mapValue,t.mapValue);case 11:return function(o,a){if(o===vr.mapValue&&a===vr.mapValue)return 0;if(o===vr.mapValue)return 1;if(a===vr.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),f=a.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let I=0;I<h.length&&I<m.length;++I){let A=q(h[I],m[I]);if(A!==0)return A;let R=Ue(l[h[I]],f[m[I]]);if(R!==0)return R}return q(h.length,m.length)}(n.mapValue,t.mapValue);default:throw F()}}function rc(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return q(n,t);let e=Kt(n),r=Kt(t),i=q(e.seconds,r.seconds);return i!==0?i:q(e.nanos,r.nanos)}function ic(n,t){let e=n.values||[],r=t.values||[];for(let i=0;i<e.length&&i<r.length;++i){let o=Ue(e[i],r[i]);if(o)return o}return q(e.length,r.length)}function qe(n){return xs(n)}function xs(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=Kt(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Qt(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return M.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",i=!0;for(let o of e.values||[])i?i=!1:r+=",",r+=xs(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${xs(e.fields[a])}`;return i+"}"}(n.mapValue):F()}function Tr(n){switch(se(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=ui(n);return t?16+Tr(t):16;case 5:return 2*n.stringValue.length;case 6:return Qt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+Tr(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return ce(r.fields,(o,a)=>{i+=o.length+Tr(a)}),i}(n.mapValue);default:throw F()}}function sc(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function Vs(n){return!!n&&"integerValue"in n}function aa(n){return!!n&&"arrayValue"in n}function oc(n){return!!n&&"nullValue"in n}function ac(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ar(n){return!!n&&"mapValue"in n}function Mc(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function Cn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return ce(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=Cn(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Cn(n.arrayValue.values[e]);return t}return Object.assign({},n)}function Fc(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var vt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Ar(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Cn(e)}setAll(t){let e=Et.emptyPath(),r={},i=[];t.forEach((a,l)=>{if(!e.isImmediateParentOf(l)){let h=this.getFieldsMap(e);this.applyChanges(h,r,i),r={},i=[],e=l.popLast()}a?r[l.lastSegment()]=Cn(a):i.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,i)}delete(t){let e=this.field(t.popLast());Ar(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return kt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Ar(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){ce(e,(i,o)=>t[i]=o);for(let i of r)delete t[i]}clone(){return new n(Cn(this.value))}};function Lc(n){let t=[];return ce(n.fields,(e,r)=>{let i=new Et([e]);if(Ar(r)){let o=Lc(r.mapValue).fields;if(o.length===0)t.push(i);else for(let a of o)t.push(i.child(a))}else t.push(i)}),new At(t)}var Rt=class n{constructor(t,e,r,i,o,a,l){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(t){return new n(t,0,B.min(),B.min(),B.min(),vt.empty(),0)}static newFoundDocument(t,e,r,i){return new n(t,1,e,B.min(),r,i,0)}static newNoDocument(t,e){return new n(t,2,e,B.min(),B.min(),vt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,B.min(),B.min(),vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ze=class{constructor(t,e){this.position=t,this.inclusive=e}};function uc(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){let o=t[i],a=n.position[i];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),e.key):r=Ue(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function cc(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!kt(n.position[e],t.position[e]))return!1;return!0}var je=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function sf(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Vr=class{},st=class n extends Vr{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new ks(t,e,r):e==="array-contains"?new Fs(t,r):e==="in"?new Ls(t,r):e==="not-in"?new Bs(t,r):e==="array-contains-any"?new Us(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Os(t,r):new Ms(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Ue(e,this.value)):e!==null&&se(this.value)===se(e)&&this.matchesComparison(Ue(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Pt=class n extends Vr{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new n(t,e)}matches(t){return Bc(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Bc(n){return n.op==="and"}function Uc(n){return of(n)&&Bc(n)}function of(n){for(let t of n.filters)if(t instanceof Pt)return!1;return!0}function Ns(n){if(n instanceof st)return n.field.canonicalString()+n.op.toString()+qe(n.value);if(Uc(n))return n.filters.map(t=>Ns(t)).join(",");{let t=n.filters.map(e=>Ns(e)).join(",");return`${n.op}(${t})`}}function qc(n,t){return n instanceof st?function(r,i){return i instanceof st&&r.op===i.op&&r.field.isEqual(i.field)&&kt(r.value,i.value)}(n,t):n instanceof Pt?function(r,i){return i instanceof Pt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,l)=>o&&qc(a,i.filters[l]),!0):!1}(n,t):void F()}function zc(n){return n instanceof st?function(e){return`${e.field.canonicalString()} ${e.op} ${qe(e.value)}`}(n):n instanceof Pt?function(e){return e.op.toString()+" {"+e.getFilters().map(zc).join(" ,")+"}"}(n):"Filter"}var ks=class extends st{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},Os=class extends st{constructor(t,e){super(t,"in",e),this.keys=jc("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ms=class extends st{constructor(t,e){super(t,"not-in",e),this.keys=jc("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function jc(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>M.fromName(r.referenceValue))}var Fs=class extends st{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return aa(e)&&Mn(e.arrayValue,this.value)}},Ls=class extends st{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Mn(this.value.arrayValue,e)}},Bs=class extends st{constructor(t,e){super(t,"not-in",e)}matches(t){if(Mn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Mn(this.value.arrayValue,e)}},Us=class extends st{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!aa(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Mn(this.value.arrayValue,r))}};var qs=class{constructor(t,e=null,r=[],i=[],o=null,a=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=l,this.ue=null}};function lc(n,t=null,e=[],r=[],i=null,o=null,a=null){return new qs(n,t,e,r,i,o,a)}function ua(n){let t=L(n);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>Ns(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),ai(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>qe(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>qe(r)).join(",")),t.ue=e}return t.ue}function ca(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!sf(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!qc(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!cc(n.startAt,t.startAt)&&cc(n.endAt,t.endAt)}function zs(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var ve=class{constructor(t,e=null,r=[],i=[],o=null,a="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function af(n,t,e,r,i,o,a,l){return new ve(n,t,e,r,i,o,a,l)}function la(n){return new ve(n)}function hc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Gc(n){return n.collectionGroup!==null}function xn(n){let t=L(n);if(t.ce===null){t.ce=[];let e=new Set;for(let o of t.explicitOrderBy)t.ce.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ut(Et.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.ce.push(new je(o,r))}),e.has(Et.keyField().canonicalString())||t.ce.push(new je(Et.keyField(),r))}return t.ce}function Vt(n){let t=L(n);return t.le||(t.le=uf(t,xn(n))),t.le}function uf(n,t){if(n.limitType==="F")return lc(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new je(i.field,o)});let e=n.endAt?new ze(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ze(n.startAt.position,n.startAt.inclusive):null;return lc(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function js(n,t){let e=n.filters.concat([t]);return new ve(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Gs(n,t,e){return new ve(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function ci(n,t){return ca(Vt(n),Vt(t))&&n.limitType===t.limitType}function $c(n){return`${ua(Vt(n))}|lt:${n.limitType}`}function Ve(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>zc(i)).join(", ")}]`),ai(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>qe(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>qe(i)).join(",")),`Target(${r})`}(Vt(n))}; limitType=${n.limitType})`}function li(n,t){return t.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,t)&&function(r,i){for(let o of xn(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,t)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,t)&&function(r,i){return!(r.startAt&&!function(a,l,h){let f=uc(a,l,h);return a.inclusive?f<=0:f<0}(r.startAt,xn(r),i)||r.endAt&&!function(a,l,h){let f=uc(a,l,h);return a.inclusive?f>=0:f>0}(r.endAt,xn(r),i))}(n,t)}function cf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Kc(n){return(t,e)=>{let r=!1;for(let i of xn(n)){let o=lf(i,t,e);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function lf(n,t,e){let r=n.field.isKeyField()?M.comparator(t.key,e.key):function(o,a,l){let h=a.data.field(o),f=l.data.field(o);return h!==null&&f!==null?Ue(h,f):F()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F()}}var Wt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){ce(this.inner,(e,r)=>{for(let[i,o]of r)t(i,o)})}isEmpty(){return Oc(this.inner)}size(){return this.innerSize}};var hf=new nt(M.comparator);function Ht(){return hf}var Qc=new nt(M.comparator);function Dn(...n){let t=Qc;for(let e of n)t=t.insert(e.key,e);return t}function Wc(n){let t=Qc;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function ge(){return Vn()}function Hc(){return Vn()}function Vn(){return new Wt(n=>n.toString(),(n,t)=>n.isEqual(t))}var df=new nt(M.comparator),ff=new ut(M.comparator);function U(...n){let t=ff;for(let e of n)t=t.add(e);return t}var mf=new ut(q);function pf(){return mf}function ha(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:kn(t)?"-0":t}}function Jc(n){return{integerValue:""+n}}function gf(n,t){return Jd(t)?Jc(t):ha(n,t)}var Ge=class{constructor(){this._=void 0}};function _f(n,t,e){return n instanceof $e?function(i,o){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&oa(o)&&(o=ui(o)),o&&(a.fields.__previous_value__=o),{mapValue:a}}(e,t):n instanceof oe?Yc(n,t):n instanceof Ee?Zc(n,t):function(i,o){let a=Xc(i,o),l=dc(a)+dc(i.Pe);return Vs(a)&&Vs(i.Pe)?Jc(l):ha(i.serializer,l)}(n,t)}function yf(n,t,e){return n instanceof oe?Yc(n,t):n instanceof Ee?Zc(n,t):e}function Xc(n,t){return n instanceof Ke?function(r){return Vs(r)||function(o){return!!o&&"doubleValue"in o}(r)}(t)?t:{integerValue:0}:null}var $e=class extends Ge{},oe=class extends Ge{constructor(t){super(),this.elements=t}};function Yc(n,t){let e=tl(t);for(let r of n.elements)e.some(i=>kt(i,r))||e.push(r);return{arrayValue:{values:e}}}var Ee=class extends Ge{constructor(t){super(),this.elements=t}};function Zc(n,t){let e=tl(t);for(let r of n.elements)e=e.filter(i=>!kt(i,r));return{arrayValue:{values:e}}}var Ke=class extends Ge{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function dc(n){return Y(n.integerValue||n.doubleValue)}function tl(n){return aa(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var $s=class{constructor(t,e){this.field=t,this.transform=e}};function wf(n,t){return n.field.isEqual(t.field)&&function(r,i){return r instanceof oe&&i instanceof oe||r instanceof Ee&&i instanceof Ee?Be(r.elements,i.elements,kt):r instanceof Ke&&i instanceof Ke?kt(r.Pe,i.Pe):r instanceof $e&&i instanceof $e}(n.transform,t.transform)}var Ks=class{constructor(t,e){this.version=t,this.transformResults=e}},re=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function br(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Qe=class{};function el(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Nr(n.key,re.none()):new Ie(n.key,n.data,re.none());{let e=n.data,r=vt.empty(),i=new ut(Et.comparator);for(let o of t.fields)if(!i.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new Ot(n.key,r,new At(i.toArray()),re.none())}}function vf(n,t,e){n instanceof Ie?function(i,o,a){let l=i.value.clone(),h=mc(i.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,t,e):n instanceof Ot?function(i,o,a){if(!br(i.precondition,o))return void o.convertToUnknownDocument(a.version);let l=mc(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(nl(i)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,t,e):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Nn(n,t,e,r){return n instanceof Ie?function(o,a,l,h){if(!br(o.precondition,a))return l;let f=o.value.clone(),m=pc(o.fieldTransforms,h,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,t,e,r):n instanceof Ot?function(o,a,l,h){if(!br(o.precondition,a))return l;let f=pc(o.fieldTransforms,h,a),m=a.data;return m.setAll(nl(o)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(I=>I.field))}(n,t,e,r):function(o,a,l){return br(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,t,e)}function Ef(n,t){let e=null;for(let r of n.fieldTransforms){let i=t.data.field(r.field),o=Xc(r.transform,i||null);o!=null&&(e===null&&(e=vt.empty()),e.set(r.field,o))}return e||null}function fc(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Be(r,i,(o,a)=>wf(o,a))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Ie=class extends Qe{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ot=class extends Qe{constructor(t,e,r,i,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function nl(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function mc(n,t,e){let r=new Map;W(n.length===e.length);for(let i=0;i<e.length;i++){let o=n[i],a=o.transform,l=t.data.field(o.field);r.set(o.field,yf(a,l,e[i]))}return r}function pc(n,t,e){let r=new Map;for(let i of n){let o=i.transform,a=e.data.field(i.field);r.set(i.field,_f(o,a,t))}return r}var Nr=class extends Qe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Qs=class extends Qe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ws=class{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(t.key)&&vf(o,t,r[i])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=Nn(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=Nn(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=Hc();return this.mutations.forEach(i=>{let o=t.get(i.key),a=o.overlayedDocument,l=this.applyToLocalView(a,o.mutatedFields);l=e.has(i.key)?null:l;let h=el(a,l);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(B.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),U())}isEqual(t){return this.batchId===t.batchId&&Be(this.mutations,t.mutations,(e,r)=>fc(e,r))&&Be(this.baseMutations,t.baseMutations,(e,r)=>fc(e,r))}},Hs=class n{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){W(t.mutations.length===r.length);let i=function(){return df}(),o=t.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(t,e,r,i)}};var Js=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Xs=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var rt,j;function If(n){switch(n){default:return F();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function rl(n){if(n===void 0)return $t("GRPC error has no .code"),S.UNKNOWN;switch(n){case rt.OK:return S.OK;case rt.CANCELLED:return S.CANCELLED;case rt.UNKNOWN:return S.UNKNOWN;case rt.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case rt.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case rt.INTERNAL:return S.INTERNAL;case rt.UNAVAILABLE:return S.UNAVAILABLE;case rt.UNAUTHENTICATED:return S.UNAUTHENTICATED;case rt.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case rt.NOT_FOUND:return S.NOT_FOUND;case rt.ALREADY_EXISTS:return S.ALREADY_EXISTS;case rt.PERMISSION_DENIED:return S.PERMISSION_DENIED;case rt.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case rt.ABORTED:return S.ABORTED;case rt.OUT_OF_RANGE:return S.OUT_OF_RANGE;case rt.UNIMPLEMENTED:return S.UNIMPLEMENTED;case rt.DATA_LOSS:return S.DATA_LOSS;default:return F()}}(j=rt||(rt={}))[j.OK=0]="OK",j[j.CANCELLED=1]="CANCELLED",j[j.UNKNOWN=2]="UNKNOWN",j[j.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",j[j.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",j[j.NOT_FOUND=5]="NOT_FOUND",j[j.ALREADY_EXISTS=6]="ALREADY_EXISTS",j[j.PERMISSION_DENIED=7]="PERMISSION_DENIED",j[j.UNAUTHENTICATED=16]="UNAUTHENTICATED",j[j.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",j[j.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",j[j.ABORTED=10]="ABORTED",j[j.OUT_OF_RANGE=11]="OUT_OF_RANGE",j[j.UNIMPLEMENTED=12]="UNIMPLEMENTED",j[j.INTERNAL=13]="INTERNAL",j[j.UNAVAILABLE=14]="UNAVAILABLE",j[j.DATA_LOSS=15]="DATA_LOSS";var gc=null;function Tf(){return new TextEncoder}var Af=new jt([4294967295,4294967295],0);function _c(n){let t=Tf().encode(n),e=new hs;return e.update(t),new Uint8Array(e.digest())}function yc(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new jt([e,r],0),new jt([i,o],0)]}var Ys=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new _e(`Invalid padding: ${e}`);if(r<0)throw new _e(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new _e(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new _e(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ie=jt.fromNumber(this.Te)}de(t,e,r){let i=t.add(e.multiply(jt.fromNumber(r)));return i.compare(Af)===1&&(i=new jt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}Ee(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=_c(t),[r,i]=yc(e);for(let o=0;o<this.hashCount;o++){let a=this.de(r,i,o);if(!this.Ee(a))return!1}return!0}static create(t,e,r){let i=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new n(o,i,e);return r.forEach(l=>a.insert(l)),a}insert(t){if(this.Te===0)return;let e=_c(t),[r,i]=yc(e);for(let o=0;o<this.hashCount;o++){let a=this.de(r,i,o);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},_e=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var kr=class n{constructor(t,e,r,i,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let i=new Map;return i.set(t,Fn.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(B.min(),i,new nt(q),Ht(),U())}},Fn=class n{constructor(t,e,r,i,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,U(),U(),U())}};var Me=class{constructor(t,e,r,i){this.Re=t,this.removedTargetIds=e,this.key=r,this.Ve=i}},Or=class{constructor(t,e){this.targetId=t,this.me=e}},Mr=class{constructor(t,e,r=pt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}},Fr=class{constructor(){this.fe=0,this.ge=wc(),this.pe=pt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=U(),e=U(),r=U();return this.ge.forEach((i,o)=>{switch(o){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:F()}}),new Fn(this.pe,this.ye,t,e,r)}Ce(){this.we=!1,this.ge=wc()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,W(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Zs=class{constructor(t){this.Be=t,this.Le=new Map,this.ke=Ht(),this.qe=Er(),this.Qe=Er(),this.Ke=new nt(q)}$e(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.Ue(e,t.Ve):this.We(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.We(e,t.key,t.Ve)}Ge(t){this.forEachTarget(t,e=>{let r=this.ze(e);switch(t.state){case 0:this.je(e)&&r.De(t.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(t.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(e);break;case 3:this.je(e)&&(r.Ne(),r.De(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),r.De(t.resumeToken));break;default:F()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Le.forEach((r,i)=>{this.je(i)&&e(i)})}Je(t){let e=t.targetId,r=t.me.count,i=this.Ye(e);if(i){let o=i.target;if(zs(o))if(r===0){let a=new M(o.path);this.We(e,a,Rt.newNoDocument(a,B.min()))}else W(r===1);else{let a=this.Ze(e);if(a!==r){let l=this.Xe(t),h=l?this.et(l,t,a):1;if(h!==0){this.He(e);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,f)}gc?.tt(function(m,I,A,R,V){var O,x,G,$,Q,tt;let It={localCacheCount:m,existenceFilterCount:I.count,databaseId:A.database,projectId:A.projectId},J=I.unchangedNames;return J&&(It.bloomFilter={applied:V===0,hashCount:(O=J?.hashCount)!==null&&O!==void 0?O:0,bitmapLength:($=(G=(x=J?.bits)===null||x===void 0?void 0:x.bitmap)===null||G===void 0?void 0:G.length)!==null&&$!==void 0?$:0,padding:(tt=(Q=J?.bits)===null||Q===void 0?void 0:Q.padding)!==null&&tt!==void 0?tt:0,mightContain:v=>{var p;return(p=R?.mightContain(v))!==null&&p!==void 0&&p}}),It}(a,t.me,this.Be.nt(),l,h))}}}}Xe(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=e,a,l;try{a=Qt(r).toUint8Array()}catch(h){if(h instanceof Cr)return Le("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Ys(a,i,o)}catch(h){return Le(h instanceof _e?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.Te===0?null:l}et(t,e,r){return e.me.count===r-this.rt(t,e.targetId)?0:2}rt(t,e){let r=this.Be.getRemoteKeysForTarget(e),i=0;return r.forEach(o=>{let a=this.Be.nt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.We(e,o,null),i++)}),i}it(t){let e=new Map;this.Le.forEach((o,a)=>{let l=this.Ye(a);if(l){if(o.current&&zs(l.target)){let h=new M(l.target.path);this.st(h).has(a)||this.ot(a,h)||this.We(a,h,Rt.newNoDocument(h,t))}o.be&&(e.set(a,o.ve()),o.Ce())}});let r=U();this.Qe.forEach((o,a)=>{let l=!0;a.forEachWhile(h=>{let f=this.Ye(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.ke.forEach((o,a)=>a.setReadTime(t));let i=new kr(t,e,this.Ke,this.ke,r);return this.ke=Ht(),this.qe=Er(),this.Qe=Er(),this.Ke=new nt(q),i}Ue(t,e){if(!this.je(t))return;let r=this.ot(t,e.key)?2:0;this.ze(t).Fe(e.key,r),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t)),this.Qe=this.Qe.insert(e.key,this._t(e.key).add(t))}We(t,e,r){if(!this.je(t))return;let i=this.ze(t);this.ot(t,e)?i.Fe(e,1):i.Me(e),this.Qe=this.Qe.insert(e,this._t(e).delete(t)),this.Qe=this.Qe.insert(e,this._t(e).add(t)),r&&(this.ke=this.ke.insert(e,r))}removeTarget(t){this.Le.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.ze(t).xe()}ze(t){let e=this.Le.get(t);return e||(e=new Fr,this.Le.set(t,e)),e}_t(t){let e=this.Qe.get(t);return e||(e=new ut(q),this.Qe=this.Qe.insert(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new ut(q),this.qe=this.qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.Le.get(t);return e&&e.Se?null:this.Be.ut(t)}He(t){this.Le.set(t,new Fr),this.Be.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}ot(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}};function Er(){return new nt(M.comparator)}function wc(){return new nt(M.comparator)}var bf={asc:"ASCENDING",desc:"DESCENDING"},Sf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rf={and:"AND",or:"OR"},to=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function eo(n,t){return n.useProto3Json||ai(t)?t:{value:t}}function Lr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function il(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Pf(n,t){return Lr(n,t.toTimestamp())}function Nt(n){return W(!!n),B.fromTimestamp(function(e){let r=Kt(e);return new ot(r.seconds,r.nanos)}(n))}function da(n,t){return no(n,t).canonicalString()}function no(n,t){let e=function(i){return new Z(["projects",i.projectId,"databases",i.database])}(n).child("documents");return t===void 0?e:e.child(t)}function sl(n){let t=Z.fromString(n);return W(ll(t)),t}function ro(n,t){return da(n.databaseId,t.path)}function _s(n,t){let e=sl(t);if(e.get(1)!==n.databaseId.projectId)throw new N(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new N(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(al(e))}function ol(n,t){return da(n.databaseId,t)}function Df(n){let t=sl(n);return t.length===4?Z.emptyPath():al(t)}function io(n){return new Z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function al(n){return W(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function vc(n,t,e){return{name:ro(n,t),fields:e.value.mapValue.fields}}function Cf(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:F()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=function(f,m){return f.useProto3Json?(W(m===void 0||typeof m=="string"),pt.fromBase64String(m||"")):(W(m===void 0||m instanceof Buffer||m instanceof Uint8Array),pt.fromUint8Array(m||new Uint8Array))}(n,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(f){let m=f.code===void 0?S.UNKNOWN:rl(f.code);return new N(m,f.message||"")}(a);e=new Mr(r,i,o,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=_s(n,r.document.name),o=Nt(r.document.updateTime),a=r.document.createTime?Nt(r.document.createTime):B.min(),l=new vt({mapValue:{fields:r.document.fields}}),h=Rt.newFoundDocument(i,o,a,l),f=r.targetIds||[],m=r.removedTargetIds||[];e=new Me(f,m,h.key,h)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=_s(n,r.document),o=r.readTime?Nt(r.readTime):B.min(),a=Rt.newNoDocument(i,o),l=r.removedTargetIds||[];e=new Me([],l,a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=_s(n,r.document),o=r.removedTargetIds||[];e=new Me([],o,i,null)}else{if(!("filter"in t))return F();{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new Xs(i,o),l=r.targetId;e=new Or(l,a)}}return e}function xf(n,t){let e;if(t instanceof Ie)e={update:vc(n,t.key,t.value)};else if(t instanceof Nr)e={delete:ro(n,t.key)};else if(t instanceof Ot)e={update:vc(n,t.key,t.data),updateMask:Uf(t.fieldMask)};else{if(!(t instanceof Qs))return F();e={verify:ro(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(o,a){let l=a.transform;if(l instanceof $e)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof oe)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ee)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ke)return{fieldPath:a.field.canonicalString(),increment:l.Pe};throw F()}(0,r))),t.precondition.isNone||(e.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:Pf(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:F()}(n,t.precondition)),e}function Vf(n,t){return n&&n.length>0?(W(t!==void 0),n.map(e=>function(i,o){let a=i.updateTime?Nt(i.updateTime):Nt(o);return a.isEqual(B.min())&&(a=Nt(o)),new Ks(a,i.transformResults||[])}(e,t))):[]}function Nf(n,t){return{documents:[ol(n,t.path)]}}function kf(n,t){let e={structuredQuery:{}},r=t.path,i;t.collectionGroup!==null?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=ol(n,i);let o=function(f){if(f.length!==0)return cl(Pt.create(f,"and"))}(t.filters);o&&(e.structuredQuery.where=o);let a=function(f){if(f.length!==0)return f.map(m=>function(A){return{field:Ne(A.field),direction:Ff(A.dir)}}(m))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let l=eo(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(t.endAt)),{ct:e,parent:i}}function Of(n){let t=Df(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,i=null;if(r>0){W(r===1);let m=e.from[0];m.allDescendants?i=m.collectionId:t=t.child(m.collectionId)}let o=[];e.where&&(o=function(I){let A=ul(I);return A instanceof Pt&&Uc(A)?A.getFilters():[A]}(e.where));let a=[];e.orderBy&&(a=function(I){return I.map(A=>function(V){return new je(ke(V.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction))}(A))}(e.orderBy));let l=null;e.limit&&(l=function(I){let A;return A=typeof I=="object"?I.value:I,ai(A)?null:A}(e.limit));let h=null;e.startAt&&(h=function(I){let A=!!I.before,R=I.values||[];return new ze(R,A)}(e.startAt));let f=null;return e.endAt&&(f=function(I){let A=!I.before,R=I.values||[];return new ze(R,A)}(e.endAt)),af(t,i,a,o,l,"F",h,f)}function Mf(n,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function ul(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=ke(e.unaryFilter.field);return st.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ke(e.unaryFilter.field);return st.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=ke(e.unaryFilter.field);return st.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=ke(e.unaryFilter.field);return st.create(a,"!=",{nullValue:"NULL_VALUE"});default:return F()}}(n):n.fieldFilter!==void 0?function(e){return st.create(ke(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return F()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Pt.create(e.compositeFilter.filters.map(r=>ul(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return F()}}(e.compositeFilter.op))}(n):F()}function Ff(n){return bf[n]}function Lf(n){return Sf[n]}function Bf(n){return Rf[n]}function Ne(n){return{fieldPath:n.canonicalString()}}function ke(n){return Et.fromServerFormat(n.fieldPath)}function cl(n){return n instanceof st?function(e){if(e.op==="=="){if(ac(e.value))return{unaryFilter:{field:Ne(e.field),op:"IS_NAN"}};if(oc(e.value))return{unaryFilter:{field:Ne(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(ac(e.value))return{unaryFilter:{field:Ne(e.field),op:"IS_NOT_NAN"}};if(oc(e.value))return{unaryFilter:{field:Ne(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ne(e.field),op:Lf(e.op),value:e.value}}}(n):n instanceof Pt?function(e){let r=e.getFilters().map(i=>cl(i));return r.length===1?r[0]:{compositeFilter:{op:Bf(e.op),filters:r}}}(n):F()}function Uf(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ll(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ln=class n{constructor(t,e,r,i,o=B.min(),a=B.min(),l=pt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var so=class{constructor(t){this.ht=t}};function qf(n){let t=Of({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Gs(t,t.limit,"L"):t}var Br=class{constructor(){}dt(t,e){this.Et(t,e),e.At()}Et(t,e){if("nullValue"in t)this.Rt(e,5);else if("booleanValue"in t)this.Rt(e,10),e.Vt(t.booleanValue?1:0);else if("integerValue"in t)this.Rt(e,15),e.Vt(Y(t.integerValue));else if("doubleValue"in t){let r=Y(t.doubleValue);isNaN(r)?this.Rt(e,13):(this.Rt(e,15),kn(r)?e.Vt(0):e.Vt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Rt(e,20),typeof r=="string"&&(r=Kt(r)),e.ft(`${r.seconds||""}`),e.Vt(r.nanos||0)}else if("stringValue"in t)this.gt(t.stringValue,e),this.yt(e);else if("bytesValue"in t)this.Rt(e,30),e.wt(Qt(t.bytesValue)),this.yt(e);else if("referenceValue"in t)this.St(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Rt(e,45),e.Vt(r.latitude||0),e.Vt(r.longitude||0)}else"mapValue"in t?Fc(t)?this.Rt(e,Number.MAX_SAFE_INTEGER):Mc(t)?this.bt(t.mapValue,e):(this.Dt(t.mapValue,e),this.yt(e)):"arrayValue"in t?(this.vt(t.arrayValue,e),this.yt(e)):F()}gt(t,e){this.Rt(e,25),this.Ct(t,e)}Ct(t,e){e.ft(t)}Dt(t,e){let r=t.fields||{};this.Rt(e,55);for(let i of Object.keys(r))this.gt(i,e),this.Et(r[i],e)}bt(t,e){var r,i;let o=t.fields||{};this.Rt(e,53);let a="value",l=((i=(r=o[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Rt(e,15),e.Vt(Y(l)),this.gt(a,e),this.Et(o[a],e)}vt(t,e){let r=t.values||[];this.Rt(e,50);for(let i of r)this.Et(i,e)}St(t,e){this.Rt(e,37),M.fromName(t).path.forEach(r=>{this.Rt(e,60),this.Ct(r,e)})}Rt(t,e){t.Vt(e)}yt(t){t.Vt(2)}};Br.Ft=new Br;var oo=class{constructor(){this.ln=new ao}addToCollectionParentIndex(t,e){return this.ln.add(e),P.resolve()}getCollectionParents(t,e){return P.resolve(this.ln.getEntries(e))}addFieldIndex(t,e){return P.resolve()}deleteFieldIndex(t,e){return P.resolve()}deleteAllFieldIndexes(t){return P.resolve()}createTargetIndexes(t,e){return P.resolve()}getDocumentsMatchingTarget(t,e){return P.resolve(null)}getIndexType(t,e){return P.resolve(0)}getFieldIndexes(t,e){return P.resolve([])}getNextCollectionGroupToUpdate(t){return P.resolve(null)}getMinOffset(t,e){return P.resolve(we.min())}getMinOffsetFromCollectionGroup(t,e){return P.resolve(we.min())}updateCollectionGroup(t,e,r){return P.resolve()}updateIndexEntries(t,e){return P.resolve()}},ao=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new ut(Z.comparator),o=!i.has(r);return this.index[e]=i.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new ut(Z.comparator)).toArray()}};var Up=new Uint8Array(0);var Ec={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Tt=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};Tt.DEFAULT_COLLECTION_PERCENTILE=10,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tt.DEFAULT=new Tt(41943040,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tt.DISABLED=new Tt(-1,0,0);var Bn=class n{constructor(t){this.kn=t}next(){return this.kn+=2,this.kn}static qn(){return new n(0)}static Qn(){return new n(-1)}};function Ic([n,t],[e,r]){let i=q(n,e);return i===0?q(t,r):i}var uo=class{constructor(t){this.Gn=t,this.buffer=new ut(Ic),this.zn=0}jn(){return++this.zn}Hn(t){let e=[t,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();Ic(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},co=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(t){k("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>D(this,null,function*(){this.Jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){en(e)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield tn(e)}yield this.Yn(3e5)}))}},lo=class{constructor(t,e){this.Zn=t,this.params=e}calculateTargetCount(t,e){return this.Zn.Xn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return P.resolve(sa.oe);let r=new uo(e);return this.Zn.forEachTarget(t,i=>r.Hn(i.sequenceNumber)).next(()=>this.Zn.er(t,i=>r.Hn(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.Zn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.Zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Ec)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ec):this.tr(t,e))}getCacheSize(t){return this.Zn.getCacheSize(t)}tr(t,e){let r,i,o,a,l,h,f,m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),i=this.params.maximumSequenceNumbersToCollect):i=I,a=Date.now(),this.nthSequenceNumber(t,i))).next(I=>(r=I,l=Date.now(),this.removeTargets(t,r,e))).next(I=>(o=I,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(I=>(f=Date.now(),xe()<=z.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${I} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:I})))}};function zf(n,t){return new lo(n,t)}var ho=class{constructor(){this.changes=new Wt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Rt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?P.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var fo=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var mo=class{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(r!==null&&Nn(r.mutation,i,At.empty(),ot.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,U()).next(()=>r))}getLocalViewOfDocuments(t,e,r=U()){let i=ge();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(o=>{let a=Dn();return o.forEach((l,h)=>{a=a.insert(l,h.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let r=ge();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,U()))}populateOverlays(t,e,r){let i=[];return r.forEach(o=>{e.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(t,i).next(o=>{o.forEach((a,l)=>{e.set(a,l)})})}computeViews(t,e,r,i){let o=Ht(),a=Vn(),l=function(){return Vn()}();return e.forEach((h,f)=>{let m=r.get(f.key);i.has(f.key)&&(m===void 0||m.mutation instanceof Ot)?o=o.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),Nn(m.mutation,f,m.mutation.getFieldMask(),ot.now())):a.set(f.key,At.empty())}),this.recalculateAndSaveOverlays(t,o).next(h=>(h.forEach((f,m)=>a.set(f,m)),e.forEach((f,m)=>{var I;return l.set(f,new fo(m,(I=a.get(f))!==null&&I!==void 0?I:null))}),l))}recalculateAndSaveOverlays(t,e){let r=Vn(),i=new nt((a,l)=>a-l),o=U();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let l of a)l.keys().forEach(h=>{let f=e.get(h);if(f===null)return;let m=r.get(h)||At.empty();m=l.applyToLocalView(f,m),r.set(h,m);let I=(i.get(l.batchId)||U()).add(h);i=i.insert(l.batchId,I)})}).next(()=>{let a=[],l=i.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),f=h.key,m=h.value,I=Hc();m.forEach(A=>{if(!o.has(A)){let R=el(e.get(A),r.get(A));R!==null&&I.set(A,R),o=o.add(A)}}),a.push(this.documentOverlayCache.saveOverlays(t,f,I))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Gc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-o.size):P.resolve(ge()),l=-1,h=o;return a.next(f=>P.forEach(f,(m,I)=>(l<I.largestBatchId&&(l=I.largestBatchId),o.get(m)?P.resolve():this.remoteDocumentCache.getEntry(t,m).next(A=>{h=h.insert(m,A)}))).next(()=>this.populateOverlays(t,f,o)).next(()=>this.computeViews(t,h,f,U())).next(m=>({batchId:l,changes:Wc(m)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(r=>{let i=Dn();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){let o=e.collectionGroup,a=Dn();return this.indexManager.getCollectionParents(t,o).next(l=>P.forEach(l,h=>{let f=function(I,A){return new ve(A,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,r,i).next(m=>{m.forEach((I,A)=>{a=a.insert(I,A)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,i))).next(a=>{o.forEach((h,f)=>{let m=f.getKey();a.get(m)===null&&(a=a.insert(m,Rt.newInvalidDocument(m)))});let l=Dn();return a.forEach((h,f)=>{let m=o.get(h);m!==void 0&&Nn(m.mutation,f,At.empty(),ot.now()),li(e,f)&&(l=l.insert(h,f))}),l})}};var po=class{constructor(t){this.serializer=t,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(t,e){return P.resolve(this.Tr.get(e))}saveBundleMetadata(t,e){return this.Tr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:Nt(i.createTime)}}(e)),P.resolve()}getNamedQuery(t,e){return P.resolve(this.Ir.get(e))}saveNamedQuery(t,e){return this.Ir.set(e.name,function(i){return{name:i.name,query:qf(i.bundledQuery),readTime:Nt(i.readTime)}}(e)),P.resolve()}};var go=class{constructor(){this.overlays=new nt(M.comparator),this.dr=new Map}getOverlay(t,e){return P.resolve(this.overlays.get(e))}getOverlays(t,e){let r=ge();return P.forEach(e,i=>this.getOverlay(t,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,o)=>{this.Tt(t,e,o)}),P.resolve()}removeOverlaysForBatchId(t,e,r){let i=this.dr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.dr.delete(r)),P.resolve()}getOverlaysForCollection(t,e,r){let i=ge(),o=e.length+1,a=new M(e.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){let h=l.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return P.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let o=new nt((f,m)=>f-m),a=this.overlays.getIterator();for(;a.hasNext();){let f=a.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=ge(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}let l=ge(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>l.set(f,m)),!(l.size()>=i)););return P.resolve(l)}Tt(t,e,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.dr.get(i.largestBatchId).delete(r.key);this.dr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Js(e,r));let o=this.dr.get(e);o===void 0&&(o=U(),this.dr.set(e,o)),this.dr.set(e,o.add(r.key))}};var _o=class{constructor(){this.sessionToken=pt.EMPTY_BYTE_STRING}getSessionToken(t){return P.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,P.resolve()}};var Un=class{constructor(){this.Er=new ut(it.Ar),this.Rr=new ut(it.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(t,e){let r=new it(t,e);this.Er=this.Er.add(r),this.Rr=this.Rr.add(r)}mr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.gr(new it(t,e))}pr(t,e){t.forEach(r=>this.removeReference(r,e))}yr(t){let e=new M(new Z([])),r=new it(e,t),i=new it(e,t+1),o=[];return this.Rr.forEachInRange([r,i],a=>{this.gr(a),o.push(a.key)}),o}wr(){this.Er.forEach(t=>this.gr(t))}gr(t){this.Er=this.Er.delete(t),this.Rr=this.Rr.delete(t)}Sr(t){let e=new M(new Z([])),r=new it(e,t),i=new it(e,t+1),o=U();return this.Rr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(t){let e=new it(t,0),r=this.Er.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},it=class{constructor(t,e){this.key=t,this.br=e}static Ar(t,e){return M.comparator(t.key,e.key)||q(t.br,e.br)}static Vr(t,e){return q(t.br,e.br)||M.comparator(t.key,e.key)}};var yo=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Dr=1,this.vr=new ut(it.Ar)}checkEmpty(t){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){let o=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ws(o,e,r,i);this.mutationQueue.push(a);for(let l of i)this.vr=this.vr.add(new it(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return P.resolve(a)}lookupMutationBatch(t,e){return P.resolve(this.Cr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=this.Fr(r),o=i<0?0:i;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(t){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new it(e,0),i=new it(e,Number.POSITIVE_INFINITY),o=[];return this.vr.forEachInRange([r,i],a=>{let l=this.Cr(a.br);o.push(l)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new ut(q);return e.forEach(i=>{let o=new it(i,0),a=new it(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([o,a],l=>{r=r.add(l.br)})}),P.resolve(this.Mr(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,o=r;M.isDocumentKey(o)||(o=o.child(""));let a=new it(new M(o),0),l=new ut(q);return this.vr.forEachWhile(h=>{let f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(l=l.add(h.br)),!0)},a),P.resolve(this.Mr(l))}Mr(t){let e=[];return t.forEach(r=>{let i=this.Cr(r);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){W(this.Or(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.vr;return P.forEach(e.mutations,i=>{let o=new it(i.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.vr=r})}Bn(t){}containsKey(t,e){let r=new it(e,0),i=this.vr.firstAfterOrEqual(r);return P.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,P.resolve()}Or(t,e){return this.Fr(t)}Fr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Cr(t){let e=this.Fr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var wo=class{constructor(t){this.Nr=t,this.docs=function(){return new nt(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.Nr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return P.resolve(r?r.document.mutableCopy():Rt.newInvalidDocument(e))}getEntries(t,e){let r=Ht();return e.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Rt.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let o=Ht(),a=e.path,l=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:f,value:{document:m}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||Qd(Kd(m),r)<=0||(i.has(m.key)||li(e,m))&&(o=o.insert(m.key,m.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(t,e,r,i){F()}Br(t,e){return P.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new vo(this)}getSize(t){return P.resolve(this.size)}},vo=class extends ho{constructor(t){super(),this.hr=t}applyChanges(t){let e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this.hr.addEntry(t,i)):this.hr.removeEntry(r)}),P.waitFor(e)}getFromCache(t,e){return this.hr.getEntry(t,e)}getAllFromCache(t,e){return this.hr.getEntries(t,e)}};var Eo=class{constructor(t){this.persistence=t,this.Lr=new Wt(e=>ua(e),ca),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.kr=0,this.qr=new Un,this.targetCount=0,this.Qr=Bn.qn()}forEachTarget(t,e){return this.Lr.forEach((r,i)=>e(i)),P.resolve()}getLastRemoteSnapshotVersion(t){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return P.resolve(this.kr)}allocateTargetId(t){return this.highestTargetId=this.Qr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.kr&&(this.kr=e),P.resolve()}Un(t){this.Lr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Qr=new Bn(e),this.highestTargetId=e),t.sequenceNumber>this.kr&&(this.kr=t.sequenceNumber)}addTargetData(t,e){return this.Un(e),this.targetCount+=1,P.resolve()}updateTargetData(t,e){return this.Un(e),P.resolve()}removeTargetData(t,e){return this.Lr.delete(e.target),this.qr.yr(e.targetId),this.targetCount-=1,P.resolve()}removeTargets(t,e,r){let i=0,o=[];return this.Lr.forEach((a,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.Lr.delete(a),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),i++)}),P.waitFor(o).next(()=>i)}getTargetCount(t){return P.resolve(this.targetCount)}getTargetData(t,e){let r=this.Lr.get(e)||null;return P.resolve(r)}addMatchingKeys(t,e,r){return this.qr.mr(e,r),P.resolve()}removeMatchingKeys(t,e,r){this.qr.pr(e,r);let i=this.persistence.referenceDelegate,o=[];return i&&e.forEach(a=>{o.push(i.markPotentiallyOrphaned(t,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.qr.yr(e),P.resolve()}getMatchingKeysForTargetId(t,e){let r=this.qr.Sr(e);return P.resolve(r)}containsKey(t,e){return P.resolve(this.qr.containsKey(e))}};var Ur=class{constructor(t,e){this.Kr={},this.overlays={},this.$r=new sa(0),this.Ur=!1,this.Ur=!0,this.Wr=new _o,this.referenceDelegate=t(this),this.Gr=new Eo(this),this.indexManager=new oo,this.remoteDocumentCache=function(i){return new wo(i)}(r=>this.referenceDelegate.zr(r)),this.serializer=new so(e),this.jr=new po(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new go,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Kr[t.toKey()];return r||(r=new yo(e,this.referenceDelegate),this.Kr[t.toKey()]=r),r}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(t,e,r){k("MemoryPersistence","Starting transaction:",t);let i=new Io(this.$r.next());return this.referenceDelegate.Hr(),r(i).next(o=>this.referenceDelegate.Jr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Yr(t,e){return P.or(Object.values(this.Kr).map(r=>()=>r.containsKey(t,e)))}},Io=class extends Ds{constructor(t){super(),this.currentSequenceNumber=t}},To=class n{constructor(t){this.persistence=t,this.Zr=new Un,this.Xr=null}static ei(t){return new n(t)}get ti(){if(this.Xr)return this.Xr;throw F()}addReference(t,e,r){return this.Zr.addReference(r,e),this.ti.delete(r.toString()),P.resolve()}removeReference(t,e,r){return this.Zr.removeReference(r,e),this.ti.add(r.toString()),P.resolve()}markPotentiallyOrphaned(t,e){return this.ti.add(e.toString()),P.resolve()}removeTarget(t,e){this.Zr.yr(e.targetId).forEach(i=>this.ti.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(o=>this.ti.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Hr(){this.Xr=new Set}Jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.ti,r=>{let i=M.fromPath(r);return this.ni(t,i).next(o=>{o||e.removeEntry(i,B.min())})}).next(()=>(this.Xr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ni(t,e).next(r=>{r?this.ti.delete(e.toString()):this.ti.add(e.toString())})}zr(t){return 0}ni(t,e){return P.or([()=>P.resolve(this.Zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Yr(t,e)])}},qr=class n{constructor(t,e){this.persistence=t,this.ri=new Wt(r=>Xd(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=zf(this,e)}static ei(t,e){return new n(t,e)}Hr(){}Jr(t){return P.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Xn(t){let e=this.nr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}nr(t){let e=0;return this.er(t,r=>{e++}).next(()=>e)}er(t,e){return P.forEach(this.ri,(r,i)=>this.ir(t,r,i).next(o=>o?P.resolve():e(i)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.Br(t,a=>this.ir(t,a,e).next(l=>{l||(r++,o.removeEntry(a,B.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.ri.set(e,t.currentSequenceNumber),P.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.ri.set(r,t.currentSequenceNumber),P.resolve()}removeReference(t,e,r){return this.ri.set(r,t.currentSequenceNumber),P.resolve()}updateLimboDocument(t,e){return this.ri.set(e,t.currentSequenceNumber),P.resolve()}zr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Tr(t.data.value)),e}ir(t,e,r){return P.or([()=>this.persistence.Yr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let i=this.ri.get(e);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Ao=class n{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.Wi=r,this.Gi=i}static zi(t,e){let r=U(),i=U();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(t,e.fromCache,r,i)}};var bo=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var So=class{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return Nu()?8:Hd(mr())>0?6:4}()}initialize(t,e){this.Zi=t,this.indexManager=e,this.ji=!0}getDocumentsMatchingQuery(t,e,r,i){let o={result:null};return this.Xi(t,e).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.es(t,e,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new bo;return this.ts(t,e,a).next(l=>{if(o.result=l,this.Hi)return this.ns(t,e,a,l.size)})}).next(()=>o.result)}ns(t,e,r,i){return r.documentReadCount<this.Ji?(xe()<=z.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Ve(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),P.resolve()):(xe()<=z.DEBUG&&k("QueryEngine","Query:",Ve(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Yi*i?(xe()<=z.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Ve(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Vt(e))):P.resolve())}Xi(t,e){if(hc(e))return P.resolve(null);let r=Vt(e);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Gs(e,null,"F"),r=Vt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let a=U(...o);return this.Zi.getDocuments(t,a).next(l=>this.indexManager.getMinOffset(t,r).next(h=>{let f=this.rs(e,l);return this.ss(e,f,a,h.readTime)?this.Xi(t,Gs(e,null,"F")):this.os(t,f,e,h)}))})))}es(t,e,r,i){return hc(e)||i.isEqual(B.min())?P.resolve(null):this.Zi.getDocuments(t,r).next(o=>{let a=this.rs(e,o);return this.ss(e,a,r,i)?P.resolve(null):(xe()<=z.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ve(e)),this.os(t,a,e,$d(i,-1)).next(l=>l))})}rs(t,e){let r=new ut(Kc(t));return e.forEach((i,o)=>{li(t,o)&&(r=r.add(o))}),r}ss(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ts(t,e,r){return xe()<=z.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Ve(e)),this.Zi.getDocumentsMatchingQuery(t,e,we.min(),r)}os(t,e,r,i){return this.Zi.getDocumentsMatchingQuery(t,r,i).next(o=>(e.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Ro=class{constructor(t,e,r,i){this.persistence=t,this._s=e,this.serializer=i,this.us=new nt(q),this.cs=new Wt(o=>ua(o),ca),this.ls=new Map,this.hs=t.getRemoteDocumentCache(),this.Gr=t.getTargetCache(),this.jr=t.getBundleCache(),this.Ps(r)}Ps(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new mo(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.us))}};function jf(n,t,e,r){return new Ro(n,t,e,r)}function hl(n,t){return D(this,null,function*(){let e=L(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,e.Ps(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],l=[],h=U();for(let f of i){a.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}for(let f of o){l.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}return e.localDocuments.getDocuments(r,h).next(f=>({Ts:f,removedBatchIds:a,addedBatchIds:l}))})})})}function Gf(n,t){let e=L(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),o=e.hs.newChangeBuffer({trackRemovals:!0});return function(l,h,f,m){let I=f.batch,A=I.keys(),R=P.resolve();return A.forEach(V=>{R=R.next(()=>m.getEntry(h,V)).next(O=>{let x=f.docVersions.get(V);W(x!==null),O.version.compareTo(x)<0&&(I.applyToRemoteDocument(O,f),O.isValidDocument()&&(O.setReadTime(f.commitVersion),m.addEntry(O)))})}),R.next(()=>l.mutationQueue.removeMutationBatch(h,I))}(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let h=U();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h}(t))).next(()=>e.localDocuments.getDocuments(r,i))})}function dl(n){let t=L(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Gr.getLastRemoteSnapshotVersion(e))}function $f(n,t){let e=L(n),r=t.snapshotVersion,i=e.us;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=e.hs.newChangeBuffer({trackRemovals:!0});i=e.us;let l=[];t.targetChanges.forEach((m,I)=>{let A=i.get(I);if(!A)return;l.push(e.Gr.removeMatchingKeys(o,m.removedDocuments,I).next(()=>e.Gr.addMatchingKeys(o,m.addedDocuments,I)));let R=A.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(I)!==null?R=R.withResumeToken(pt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):m.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(m.resumeToken,r)),i=i.insert(I,R),function(O,x,G){return O.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(A,R,m)&&l.push(e.Gr.updateTargetData(o,R))});let h=Ht(),f=U();if(t.documentUpdates.forEach(m=>{t.resolvedLimboDocuments.has(m)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,m))}),l.push(Kf(o,a,t.documentUpdates).next(m=>{h=m.Is,f=m.ds})),!r.isEqual(B.min())){let m=e.Gr.getLastRemoteSnapshotVersion(o).next(I=>e.Gr.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(m)}return P.waitFor(l).next(()=>a.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(e.us=i,o))}function Kf(n,t,e){let r=U(),i=U();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let a=Ht();return e.forEach((l,h)=>{let f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(l)),h.isNoDocument()&&h.version.isEqual(B.min())?(t.removeEntry(l,h.readTime),a=a.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),a=a.insert(l,h)):k("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{Is:a,ds:i}})}function Qf(n,t){let e=L(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function Wf(n,t){let e=L(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.Gr.getTargetData(r,t).next(o=>o?(i=o,P.resolve(i)):e.Gr.allocateTargetId(r).next(a=>(i=new Ln(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Gr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=e.us.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.us=e.us.insert(r.targetId,r),e.cs.set(t,r.targetId)),r})}function Po(n,t,e){return D(this,null,function*(){let r=L(n),i=r.us.get(t),o=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!en(a))throw a;k("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}r.us=r.us.remove(t),r.cs.delete(i.target)})}function Tc(n,t,e){let r=L(n),i=B.min(),o=U();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,m){let I=L(h),A=I.cs.get(m);return A!==void 0?P.resolve(I.us.get(A)):I.Gr.getTargetData(f,m)}(r,a,Vt(t)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(a,l.targetId).next(h=>{o=h})}).next(()=>r._s.getDocumentsMatchingQuery(a,t,e?i:B.min(),e?o:U())).next(l=>(Hf(r,cf(t),l),{documents:l,Es:o})))}function Hf(n,t,e){let r=n.ls.get(t)||B.min();e.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.ls.set(t,r)}var zr=class{constructor(){this.activeTargetIds=pf()}ps(t){this.activeTargetIds=this.activeTargetIds.add(t)}ys(t){this.activeTargetIds=this.activeTargetIds.delete(t)}gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Do=class{constructor(){this._o=new zr,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this._o.ps(t),this.ao[t]||"not-current"}updateQueryState(t,e,r){this.ao[t]=e}removeLocalQueryTarget(t){this._o.ys(t)}isLocalQueryTarget(t){return this._o.activeTargetIds.has(t)}clearQueryState(t){delete this.ao[t]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(t){return this._o.activeTargetIds.has(t)}start(){return this._o=new zr,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Co=class{uo(t){}shutdown(){}};var jr=class{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(t){this.To.push(t)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.To)t(0)}Po(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.To)t(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ir=null;function ys(){return Ir===null?Ir=function(){return 268435456+Math.round(2147483648*Math.random())}():Ir++,"0x"+Ir.toString(16)}var Jf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var xo=class{constructor(t){this.Eo=t.Eo,this.Ao=t.Ao}Ro(t){this.Vo=t}mo(t){this.fo=t}po(t){this.yo=t}onMessage(t){this.wo=t}close(){this.Ao()}send(t){this.Eo(t)}So(){this.Vo()}bo(){this.fo()}Do(t){this.yo(t)}vo(t){this.wo(t)}};var mt="WebChannelConnection",Vo=class extends class{get Co(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Fo=r+"://"+e.host,this.Mo=`projects/${i}/databases/${o}`,this.xo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${o}`}Oo(e,r,i,o,a){let l=ys(),h=this.No(e,r.toUriEncodedString());k("RestConnection",`Sending RPC '${e}' ${l}:`,h,i);let f={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(f,o,a),this.Lo(e,h,f,i).then(m=>(k("RestConnection",`Received RPC '${e}' ${l}: `,m),m),m=>{throw Le("RestConnection",`RPC '${e}' ${l} failed with error: `,m,"url: ",h,"request:",i),m})}ko(e,r,i,o,a,l){return this.Oo(e,r,i,o,a)}Bo(e,r,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ze}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((o,a)=>e[a]=o),i&&i.headers.forEach((o,a)=>e[a]=o)}No(e,r){let i=Jf[e];return`${this.Fo}/v1/${r}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Lo(t,e,r,i){let o=ys();return new Promise((a,l)=>{let h=new ds;h.setWithCredentials(!0),h.listenOnce(fs.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Pn.NO_ERROR:let m=h.getResponseJson();k(mt,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(m)),a(m);break;case Pn.TIMEOUT:k(mt,`RPC '${t}' ${o} timed out`),l(new N(S.DEADLINE_EXCEEDED,"Request time out"));break;case Pn.HTTP_ERROR:let I=h.getStatus();if(k(mt,`RPC '${t}' ${o} failed with status:`,I,"response text:",h.getResponseText()),I>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);let R=A?.error;if(R&&R.status&&R.message){let V=function(x){let G=x.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(G)>=0?G:S.UNKNOWN}(R.status);l(new N(V,R.message))}else l(new N(S.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new N(S.UNAVAILABLE,"Connection failed."));break;default:F()}}finally{k(mt,`RPC '${t}' ${o} completed.`)}});let f=JSON.stringify(i);k(mt,`RPC '${t}' ${o} sending request:`,i),h.send(e,"POST",f,r,15)})}qo(t,e,r){let i=ys(),o=[this.Fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=gs(),l=ps(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Bo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;let m=o.join("");k(mt,`Creating RPC '${t}' stream ${i}: ${m}`,h);let I=a.createWebChannel(m,h),A=!1,R=!1,V=new xo({Eo:x=>{R?k(mt,`Not sending because RPC '${t}' stream ${i} is closed:`,x):(A||(k(mt,`Opening RPC '${t}' stream ${i} transport.`),I.open(),A=!0),k(mt,`RPC '${t}' stream ${i} sending:`,x),I.send(x))},Ao:()=>I.close()}),O=(x,G,$)=>{x.listen(G,Q=>{try{$(Q)}catch(tt){setTimeout(()=>{throw tt},0)}})};return O(I,Ce.EventType.OPEN,()=>{R||(k(mt,`RPC '${t}' stream ${i} transport opened.`),V.So())}),O(I,Ce.EventType.CLOSE,()=>{R||(R=!0,k(mt,`RPC '${t}' stream ${i} transport closed`),V.Do())}),O(I,Ce.EventType.ERROR,x=>{R||(R=!0,Le(mt,`RPC '${t}' stream ${i} transport errored:`,x),V.Do(new N(S.UNAVAILABLE,"The operation could not be completed")))}),O(I,Ce.EventType.MESSAGE,x=>{var G;if(!R){let $=x.data[0];W(!!$);let Q=$,tt=Q?.error||((G=Q[0])===null||G===void 0?void 0:G.error);if(tt){k(mt,`RPC '${t}' stream ${i} received error:`,tt);let It=tt.status,J=function(_){let y=rt[_];if(y!==void 0)return rl(y)}(It),v=tt.message;J===void 0&&(J=S.INTERNAL,v="Unknown error status: "+It+" with message "+tt.message),R=!0,V.Do(new N(J,v)),I.close()}else k(mt,`RPC '${t}' stream ${i} received:`,$),V.vo($)}}),O(l,ms.STAT_EVENT,x=>{x.stat===wr.PROXY?k(mt,`RPC '${t}' stream ${i} detected buffering proxy`):x.stat===wr.NOPROXY&&k(mt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{V.bo()},0),V}};function ws(){return typeof document<"u"?document:null}function hi(n){return new to(n,!0)}var Gr=class{constructor(t,e,r=1e3,i=1.5,o=6e4){this.li=t,this.timerId=e,this.Qo=r,this.Ko=i,this.$o=o,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(t){this.cancel();let e=Math.floor(this.Uo+this.Ho()),r=Math.max(0,Date.now()-this.Go),i=Math.max(0,e-r);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),t())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}};var $r=class{constructor(t,e,r,i,o,a,l,h){this.li=t,this.Yo=r,this.Zo=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new Gr(t,e)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}stop(){return D(this,null,function*(){this.i_()&&(yield this.close(0))})}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(t){this.l_(),this.stream.send(t)}u_(){return D(this,null,function*(){if(this.s_())return this.close(0)})}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(t,e){return D(this,null,function*(){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,t!==4?this.r_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?($t(e.toString()),$t("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.po(e)})}P_(){}auth(){this.state=1;let t=this.T_(this.Xo),e=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Xo===e&&this.I_(r,i)},r=>{t(()=>{let i=new N(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.d_(i)})})}I_(t,e){let r=this.T_(this.Xo);this.stream=this.E_(t,e),this.stream.Ro(()=>{r(()=>this.listener.Ro())}),this.stream.mo(()=>{r(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{r(()=>this.d_(i))}),this.stream.onMessage(i=>{r(()=>++this.n_==1?this.A_(i):this.onNext(i))})}o_(){this.state=5,this.r_.jo(()=>D(this,null,function*(){this.state=0,this.start()}))}d_(t){return k("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}T_(t){return e=>{this.li.enqueueAndForget(()=>this.Xo===t?e():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},No=class extends $r{constructor(t,e,r,i,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,a),this.serializer=o}E_(t,e){return this.connection.qo("Listen",t,e)}A_(t){return this.onNext(t)}onNext(t){this.r_.reset();let e=Cf(this.serializer,t),r=function(o){if(!("targetChange"in o))return B.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?Nt(a.readTime):B.min()}(t);return this.listener.R_(e,r)}V_(t){let e={};e.database=io(this.serializer),e.addTarget=function(o,a){let l,h=a.target;if(l=zs(h)?{documents:Nf(o,h)}:{query:kf(o,h).ct},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=il(o,a.resumeToken);let f=eo(o,a.expectedCount);f!==null&&(l.expectedCount=f)}else if(a.snapshotVersion.compareTo(B.min())>0){l.readTime=Lr(o,a.snapshotVersion.toTimestamp());let f=eo(o,a.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,t);let r=Mf(this.serializer,t);r&&(e.labels=r),this.c_(e)}m_(t){let e={};e.database=io(this.serializer),e.removeTarget=t,this.c_(e)}},ko=class extends $r{constructor(t,e,r,i,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,a),this.serializer=o}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(t,e){return this.connection.qo("Write",t,e)}A_(t){return W(!!t.streamToken),this.lastStreamToken=t.streamToken,W(!t.writeResults||t.writeResults.length===0),this.listener.p_()}onNext(t){W(!!t.streamToken),this.lastStreamToken=t.streamToken,this.r_.reset();let e=Vf(t.writeResults,t.commitTime),r=Nt(t.commitTime);return this.listener.y_(r,e)}w_(){let t={};t.database=io(this.serializer),this.c_(t)}g_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>xf(this.serializer,r))};this.c_(e)}};var Oo=class extends class{}{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new N(S.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(t,e,r,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Oo(t,no(e,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new N(S.UNKNOWN,o.toString())})}ko(t,e,r,i,o){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.ko(t,no(e,r),i,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new N(S.UNKNOWN,a.toString())})}terminate(){this.S_=!0,this.connection.terminate()}},Mo=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(t){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.M_("Offline")))}set(t){this.N_(),this.D_=0,t==="Online"&&(this.C_=!1),this.M_(t)}M_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}x_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?($t(e),this.C_=!1):k("OnlineStateTracker",e)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}};var Fo=class{constructor(t,e,r,i,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=o,this.Q_.uo(a=>{r.enqueueAndForget(()=>D(this,null,function*(){Te(this)&&(k("RemoteStore","Restarting streams for network reachability change."),yield function(h){return D(this,null,function*(){let f=L(h);f.k_.add(4),yield Qn(f),f.K_.set("Unknown"),f.k_.delete(4),yield di(f)})}(this))}))}),this.K_=new Mo(r,i)}};function di(n){return D(this,null,function*(){if(Te(n))for(let t of n.q_)yield t(!0)})}function Qn(n){return D(this,null,function*(){for(let t of n.q_)yield t(!1)})}function fl(n,t){let e=L(n);e.L_.has(t.targetId)||(e.L_.set(t.targetId,t),ga(e)?pa(e):nn(e).s_()&&ma(e,t))}function fa(n,t){let e=L(n),r=nn(e);e.L_.delete(t),r.s_()&&ml(e,t),e.L_.size===0&&(r.s_()?r.a_():Te(e)&&e.K_.set("Unknown"))}function ma(n,t){if(n.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}nn(n).V_(t)}function ml(n,t){n.U_.xe(t),nn(n).m_(t)}function pa(n){n.U_=new Zs({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>n.L_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),nn(n).start(),n.K_.F_()}function ga(n){return Te(n)&&!nn(n).i_()&&n.L_.size>0}function Te(n){return L(n).k_.size===0}function pl(n){n.U_=void 0}function Xf(n){return D(this,null,function*(){n.K_.set("Online")})}function Yf(n){return D(this,null,function*(){n.L_.forEach((t,e)=>{ma(n,t)})})}function Zf(n,t){return D(this,null,function*(){pl(n),ga(n)?(n.K_.O_(t),pa(n)):n.K_.set("Unknown")})}function tm(n,t,e){return D(this,null,function*(){if(n.K_.set("Online"),t instanceof Mr&&t.state===2&&t.cause)try{yield function(i,o){return D(this,null,function*(){let a=o.cause;for(let l of o.targetIds)i.L_.has(l)&&(yield i.remoteSyncer.rejectListen(l,a),i.L_.delete(l),i.U_.removeTarget(l))})}(n,t)}catch(r){k("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Kr(n,r)}else if(t instanceof Me?n.U_.$e(t):t instanceof Or?n.U_.Je(t):n.U_.Ge(t),!e.isEqual(B.min()))try{let r=yield dl(n.localStore);e.compareTo(r)>=0&&(yield function(o,a){let l=o.U_.it(a);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let m=o.L_.get(f);m&&o.L_.set(f,m.withResumeToken(h.resumeToken,a))}}),l.targetMismatches.forEach((h,f)=>{let m=o.L_.get(h);if(!m)return;o.L_.set(h,m.withResumeToken(pt.EMPTY_BYTE_STRING,m.snapshotVersion)),ml(o,h);let I=new Ln(m.target,h,f,m.sequenceNumber);ma(o,I)}),o.remoteSyncer.applyRemoteEvent(l)}(n,e))}catch(r){k("RemoteStore","Failed to raise snapshot:",r),yield Kr(n,r)}})}function Kr(n,t,e){return D(this,null,function*(){if(!en(t))throw t;n.k_.add(1),yield Qn(n),n.K_.set("Offline"),e||(e=()=>dl(n.localStore)),n.asyncQueue.enqueueRetryable(()=>D(this,null,function*(){k("RemoteStore","Retrying IndexedDB access"),yield e(),n.k_.delete(1),yield di(n)}))})}function gl(n,t){return t().catch(e=>Kr(n,e,t))}function fi(n){return D(this,null,function*(){let t=L(n),e=ae(t),r=t.B_.length>0?t.B_[t.B_.length-1].batchId:-1;for(;em(t);)try{let i=yield Qf(t.localStore,r);if(i===null){t.B_.length===0&&e.a_();break}r=i.batchId,nm(t,i)}catch(i){yield Kr(t,i)}_l(t)&&yl(t)})}function em(n){return Te(n)&&n.B_.length<10}function nm(n,t){n.B_.push(t);let e=ae(n);e.s_()&&e.f_&&e.g_(t.mutations)}function _l(n){return Te(n)&&!ae(n).i_()&&n.B_.length>0}function yl(n){ae(n).start()}function rm(n){return D(this,null,function*(){ae(n).w_()})}function im(n){return D(this,null,function*(){let t=ae(n);for(let e of n.B_)t.g_(e.mutations)})}function sm(n,t,e){return D(this,null,function*(){let r=n.B_.shift(),i=Hs.from(r,t,e);yield gl(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield fi(n)})}function om(n,t){return D(this,null,function*(){t&&ae(n).f_&&(yield function(r,i){return D(this,null,function*(){if(function(a){return If(a)&&a!==S.ABORTED}(i.code)){let o=r.B_.shift();ae(r).__(),yield gl(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield fi(r)}})}(n,t)),_l(n)&&yl(n)})}function Ac(n,t){return D(this,null,function*(){let e=L(n);e.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");let r=Te(e);e.k_.add(3),yield Qn(e),r&&e.K_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.k_.delete(3),yield di(e)})}function am(n,t){return D(this,null,function*(){let e=L(n);t?(e.k_.delete(2),yield di(e)):t||(e.k_.add(2),yield Qn(e),e.K_.set("Unknown"))})}function nn(n){return n.W_||(n.W_=function(e,r,i){let o=L(e);return o.b_(),new No(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Ro:Xf.bind(null,n),mo:Yf.bind(null,n),po:Zf.bind(null,n),R_:tm.bind(null,n)}),n.q_.push(t=>D(this,null,function*(){t?(n.W_.__(),ga(n)?pa(n):n.K_.set("Unknown")):(yield n.W_.stop(),pl(n))}))),n.W_}function ae(n){return n.G_||(n.G_=function(e,r,i){let o=L(e);return o.b_(),new ko(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Ro:()=>Promise.resolve(),mo:rm.bind(null,n),po:om.bind(null,n),p_:im.bind(null,n),y_:sm.bind(null,n)}),n.q_.push(t=>D(this,null,function*(){t?(n.G_.__(),yield fi(n)):(yield n.G_.stop(),n.B_.length>0&&(k("RemoteStore",`Stopping write stream with ${n.B_.length} pending writes`),n.B_=[]))}))),n.G_}var Lo=class n{constructor(t,e,r,i,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new bt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,o){let a=Date.now()+r,l=new n(t,e,a,i,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function mi(n,t){if($t("AsyncQueue",`${t}: ${n}`),en(n))return new N(S.UNAVAILABLE,`${t}: ${n}`);throw n}var Qr=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=Dn(),this.sortedSet=new nt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Wr=class{constructor(){this.z_=new nt(M.comparator)}track(t){let e=t.doc.key,r=this.z_.get(e);r?t.type!==0&&r.type===3?this.z_=this.z_.insert(e,t):t.type===3&&r.type!==1?this.z_=this.z_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.z_=this.z_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.z_=this.z_.remove(e):t.type===1&&r.type===2?this.z_=this.z_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):F():this.z_=this.z_.insert(e,t)}j_(){let t=[];return this.z_.inorderTraversal((e,r)=>{t.push(r)}),t}},We=class n{constructor(t,e,r,i,o,a,l,h,f){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,r,i,o){let a=[];return e.forEach(l=>{a.push({type:0,doc:l})}),new n(t,e,Qr.emptySet(e),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ci(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}};var Bo=class{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(t=>t.Z_())}},Uo=class{constructor(){this.queries=bc(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(e,r){let i=L(e),o=i.queries;i.queries=bc(),o.forEach((a,l)=>{for(let h of l.J_)h.onError(r)})})(this,new N(S.ABORTED,"Firestore shutting down"))}};function bc(){return new Wt(n=>$c(n),ci)}function wl(n,t){return D(this,null,function*(){let e=L(n),r=3,i=t.query,o=e.queries.get(i);o?!o.Y_()&&t.Z_()&&(r=2):(o=new Bo,r=t.Z_()?0:1);try{switch(r){case 0:o.H_=yield e.onListen(i,!0);break;case 1:o.H_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let l=mi(a,`Initialization of query '${Ve(t.query)}' failed`);return void t.onError(l)}e.queries.set(i,o),o.J_.push(t),t.ea(e.onlineState),o.H_&&t.ta(o.H_)&&_a(e)})}function vl(n,t){return D(this,null,function*(){let e=L(n),r=t.query,i=3,o=e.queries.get(r);if(o){let a=o.J_.indexOf(t);a>=0&&(o.J_.splice(a,1),o.J_.length===0?i=t.Z_()?0:1:!o.Y_()&&t.Z_()&&(i=2))}switch(i){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function um(n,t){let e=L(n),r=!1;for(let i of t){let o=i.query,a=e.queries.get(o);if(a){for(let l of a.J_)l.ta(i)&&(r=!0);a.H_=i}}r&&_a(e)}function cm(n,t,e){let r=L(n),i=r.queries.get(t);if(i)for(let o of i.J_)o.onError(e);r.queries.delete(t)}function _a(n){n.X_.forEach(t=>{t.next()})}var qo,Sc;(Sc=qo||(qo={})).na="default",Sc.Cache="cache";var Hr=class{constructor(t,e,r){this.query=t,this.ra=e,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=r||{}}ta(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new We(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ia?this.oa(t)&&(this.ra.next(t),e=!0):this._a(t,this.onlineState)&&(this.aa(t),e=!0),this.sa=t,e}onError(t){this.ra.error(t)}ea(t){this.onlineState=t;let e=!1;return this.sa&&!this.ia&&this._a(this.sa,t)&&(this.aa(this.sa),e=!0),e}_a(t,e){if(!t.fromCache||!this.Z_())return!0;let r=e!=="Offline";return(!this.options.ua||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}oa(t){if(t.docChanges.length>0)return!0;let e=this.sa&&this.sa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}aa(t){t=We.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ia=!0,this.ra.next(t)}Z_(){return this.options.source!==qo.Cache}};var Jr=class{constructor(t){this.key=t}},Xr=class{constructor(t){this.key=t}},zo=class{constructor(t,e){this.query=t,this.Ea=e,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=U(),this.mutatedKeys=U(),this.Va=Kc(t),this.ma=new Qr(this.Va)}get fa(){return this.Ea}ga(t,e){let r=e?e.pa:new Wr,i=e?e.ma:this.ma,o=e?e.mutatedKeys:this.mutatedKeys,a=i,l=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((m,I)=>{let A=i.get(m),R=li(this.query,I)?I:null,V=!!A&&this.mutatedKeys.has(A.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),x=!1;A&&R?A.data.isEqual(R.data)?V!==O&&(r.track({type:3,doc:R}),x=!0):this.ya(A,R)||(r.track({type:2,doc:R}),x=!0,(h&&this.Va(R,h)>0||f&&this.Va(R,f)<0)&&(l=!0)):!A&&R?(r.track({type:0,doc:R}),x=!0):A&&!R&&(r.track({type:1,doc:A}),x=!0,(h||f)&&(l=!0)),x&&(R?(a=a.add(R),o=O?o.add(m):o.delete(m)):(a=a.delete(m),o=o.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{ma:a,pa:r,ss:l,mutatedKeys:o}}ya(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){let o=this.ma;this.ma=t.ma,this.mutatedKeys=t.mutatedKeys;let a=t.pa.j_();a.sort((m,I)=>function(R,V){let O=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F()}};return O(R)-O(V)}(m.type,I.type)||this.Va(m.doc,I.doc)),this.wa(r),i=i!=null&&i;let l=e&&!i?this.Sa():[],h=this.Ra.size===0&&this.current&&!i?1:0,f=h!==this.Aa;return this.Aa=h,a.length!==0||f?{snapshot:new We(this.query,t.ma,o,a,t.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),ba:l}:{ba:l}}ea(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new Wr,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(t){return!this.Ea.has(t)&&!!this.ma.has(t)&&!this.ma.get(t).hasLocalMutations}wa(t){t&&(t.addedDocuments.forEach(e=>this.Ea=this.Ea.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ea=this.Ea.delete(e)),this.current=t.current)}Sa(){if(!this.current)return[];let t=this.Ra;this.Ra=U(),this.ma.forEach(r=>{this.Da(r.key)&&(this.Ra=this.Ra.add(r.key))});let e=[];return t.forEach(r=>{this.Ra.has(r)||e.push(new Xr(r))}),this.Ra.forEach(r=>{t.has(r)||e.push(new Jr(r))}),e}va(t){this.Ea=t.Es,this.Ra=U();let e=this.ga(t.documents);return this.applyChanges(e,!0)}Ca(){return We.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}},jo=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Go=class{constructor(t){this.key=t,this.Fa=!1}},$o=class{constructor(t,e,r,i,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Ma={},this.xa=new Wt(l=>$c(l),ci),this.Oa=new Map,this.Na=new Set,this.Ba=new nt(M.comparator),this.La=new Map,this.ka=new Un,this.qa={},this.Qa=new Map,this.Ka=Bn.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}};function lm(n,t,e=!0){return D(this,null,function*(){let r=Sl(n),i,o=r.xa.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Ca()):i=yield El(r,t,e,!0),i})}function hm(n,t){return D(this,null,function*(){let e=Sl(n);yield El(e,t,!0,!1)})}function El(n,t,e,r){return D(this,null,function*(){let i=yield Wf(n.localStore,Vt(t)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e),l;return r&&(l=yield dm(n,t,o,a==="current",i.resumeToken)),n.isPrimaryClient&&e&&fl(n.remoteStore,i),l})}function dm(n,t,e,r,i){return D(this,null,function*(){n.Ua=(I,A,R)=>function(O,x,G,$){return D(this,null,function*(){let Q=x.view.ga(G);Q.ss&&(Q=yield Tc(O.localStore,x.query,!1).then(({documents:v})=>x.view.ga(v,Q)));let tt=$&&$.targetChanges.get(x.targetId),It=$&&$.targetMismatches.get(x.targetId)!=null,J=x.view.applyChanges(Q,O.isPrimaryClient,tt,It);return Pc(O,x.targetId,J.ba),J.snapshot})}(n,I,A,R);let o=yield Tc(n.localStore,t,!0),a=new zo(t,o.Es),l=a.ga(o.documents),h=Fn.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),f=a.applyChanges(l,n.isPrimaryClient,h);Pc(n,e,f.ba);let m=new jo(t,e,a);return n.xa.set(t,m),n.Oa.has(e)?n.Oa.get(e).push(t):n.Oa.set(e,[t]),f.snapshot})}function fm(n,t,e){return D(this,null,function*(){let r=L(n),i=r.xa.get(t),o=r.Oa.get(i.targetId);if(o.length>1)return r.Oa.set(i.targetId,o.filter(a=>!ci(a,t))),void r.xa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Po(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),e&&fa(r.remoteStore,i.targetId),Ko(r,i.targetId)}).catch(tn))):(Ko(r,i.targetId),yield Po(r.localStore,i.targetId,!0))})}function mm(n,t){return D(this,null,function*(){let e=L(n),r=e.xa.get(t),i=e.Oa.get(r.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),fa(e.remoteStore,r.targetId))})}function pm(n,t,e){return D(this,null,function*(){let r=Im(n);try{let i=yield function(a,l){let h=L(a),f=ot.now(),m=l.reduce((R,V)=>R.add(V.key),U()),I,A;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let V=Ht(),O=U();return h.hs.getEntries(R,m).next(x=>{V=x,V.forEach((G,$)=>{$.isValidDocument()||(O=O.add(G))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,V)).next(x=>{I=x;let G=[];for(let $ of l){let Q=Ef($,I.get($.key).overlayedDocument);Q!=null&&G.push(new Ot($.key,Q,Lc(Q.value.mapValue),re.exists(!0)))}return h.mutationQueue.addMutationBatch(R,f,G,l)}).next(x=>{A=x;let G=x.applyToLocalDocumentSet(I,O);return h.documentOverlayCache.saveOverlays(R,x.batchId,G)})}).then(()=>({batchId:A.batchId,changes:Wc(I)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(a,l,h){let f=a.qa[a.currentUser.toKey()];f||(f=new nt(q)),f=f.insert(l,h),a.qa[a.currentUser.toKey()]=f}(r,i.batchId,e),yield Wn(r,i.changes),yield fi(r.remoteStore)}catch(i){let o=mi(i,"Failed to persist write");e.reject(o)}})}function Il(n,t){return D(this,null,function*(){let e=L(n);try{let r=yield $f(e.localStore,t);t.targetChanges.forEach((i,o)=>{let a=e.La.get(o);a&&(W(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Fa=!0:i.modifiedDocuments.size>0?W(a.Fa):i.removedDocuments.size>0&&(W(a.Fa),a.Fa=!1))}),yield Wn(e,r,t)}catch(r){yield tn(r)}})}function Rc(n,t,e){let r=L(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let i=[];r.xa.forEach((o,a)=>{let l=a.view.ea(t);l.snapshot&&i.push(l.snapshot)}),function(a,l){let h=L(a);h.onlineState=l;let f=!1;h.queries.forEach((m,I)=>{for(let A of I.J_)A.ea(l)&&(f=!0)}),f&&_a(h)}(r.eventManager,t),i.length&&r.Ma.R_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function gm(n,t,e){return D(this,null,function*(){let r=L(n);r.sharedClientState.updateQueryState(t,"rejected",e);let i=r.La.get(t),o=i&&i.key;if(o){let a=new nt(M.comparator);a=a.insert(o,Rt.newNoDocument(o,B.min()));let l=U().add(o),h=new kr(B.min(),new Map,new nt(q),a,l);yield Il(r,h),r.Ba=r.Ba.remove(o),r.La.delete(t),ya(r)}else yield Po(r.localStore,t,!1).then(()=>Ko(r,t,e)).catch(tn)})}function _m(n,t){return D(this,null,function*(){let e=L(n),r=t.batch.batchId;try{let i=yield Gf(e.localStore,t);Al(e,r,null),Tl(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Wn(e,i)}catch(i){yield tn(i)}})}function ym(n,t,e){return D(this,null,function*(){let r=L(n);try{let i=yield function(a,l){let h=L(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,l).next(I=>(W(I!==null),m=I.keys(),h.mutationQueue.removeMutationBatch(f,I))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(r.localStore,t);Al(r,t,e),Tl(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Wn(r,i)}catch(i){yield tn(i)}})}function Tl(n,t){(n.Qa.get(t)||[]).forEach(e=>{e.resolve()}),n.Qa.delete(t)}function Al(n,t,e){let r=L(n),i=r.qa[r.currentUser.toKey()];if(i){let o=i.get(t);o&&(e?o.reject(e):o.resolve(),i=i.remove(t)),r.qa[r.currentUser.toKey()]=i}}function Ko(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Oa.get(t))n.xa.delete(r),e&&n.Ma.Wa(r,e);n.Oa.delete(t),n.isPrimaryClient&&n.ka.yr(t).forEach(r=>{n.ka.containsKey(r)||bl(n,r)})}function bl(n,t){n.Na.delete(t.path.canonicalString());let e=n.Ba.get(t);e!==null&&(fa(n.remoteStore,e),n.Ba=n.Ba.remove(t),n.La.delete(e),ya(n))}function Pc(n,t,e){for(let r of e)r instanceof Jr?(n.ka.addReference(r.key,t),wm(n,r)):r instanceof Xr?(k("SyncEngine","Document no longer in limbo: "+r.key),n.ka.removeReference(r.key,t),n.ka.containsKey(r.key)||bl(n,r.key)):F()}function wm(n,t){let e=t.key,r=e.path.canonicalString();n.Ba.get(e)||n.Na.has(r)||(k("SyncEngine","New document in limbo: "+e),n.Na.add(r),ya(n))}function ya(n){for(;n.Na.size>0&&n.Ba.size<n.maxConcurrentLimboResolutions;){let t=n.Na.values().next().value;n.Na.delete(t);let e=new M(Z.fromString(t)),r=n.Ka.next();n.La.set(r,new Go(e)),n.Ba=n.Ba.insert(e,r),fl(n.remoteStore,new Ln(Vt(la(e.path)),r,"TargetPurposeLimboResolution",sa.oe))}}function Wn(n,t,e){return D(this,null,function*(){let r=L(n),i=[],o=[],a=[];r.xa.isEmpty()||(r.xa.forEach((l,h)=>{a.push(r.Ua(h,t,e).then(f=>{var m;if((f||e)&&r.isPrimaryClient){let I=f?!f.fromCache:(m=e?.targetChanges.get(h.targetId))===null||m===void 0?void 0:m.current;r.sharedClientState.updateQueryState(h.targetId,I?"current":"not-current")}if(f){i.push(f);let I=Ao.zi(h.targetId,f);o.push(I)}}))}),yield Promise.all(a),r.Ma.R_(i),yield function(h,f){return D(this,null,function*(){let m=L(h);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>P.forEach(f,A=>P.forEach(A.Wi,R=>m.persistence.referenceDelegate.addReference(I,A.targetId,R)).next(()=>P.forEach(A.Gi,R=>m.persistence.referenceDelegate.removeReference(I,A.targetId,R)))))}catch(I){if(!en(I))throw I;k("LocalStore","Failed to update sequence numbers: "+I)}for(let I of f){let A=I.targetId;if(!I.fromCache){let R=m.us.get(A),V=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(V);m.us=m.us.insert(A,O)}}})}(r.localStore,o))})}function vm(n,t){return D(this,null,function*(){let e=L(n);if(!e.currentUser.isEqual(t)){k("SyncEngine","User change. New user:",t.toKey());let r=yield hl(e.localStore,t);e.currentUser=t,function(o,a){o.Qa.forEach(l=>{l.forEach(h=>{h.reject(new N(S.CANCELLED,a))})}),o.Qa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Wn(e,r.Ts)}})}function Em(n,t){let e=L(n),r=e.La.get(t);if(r&&r.Fa)return U().add(r.key);{let i=U(),o=e.Oa.get(t);if(!o)return i;for(let a of o){let l=e.xa.get(a);i=i.unionWith(l.view.fa)}return i}}function Sl(n){let t=L(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Il.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Em.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=gm.bind(null,t),t.Ma.R_=um.bind(null,t.eventManager),t.Ma.Wa=cm.bind(null,t.eventManager),t}function Im(n){let t=L(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=_m.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ym.bind(null,t),t}var Rl=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return D(this,null,function*(){this.serializer=hi(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),yield this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)})}Ja(e,r){return null}Ya(e,r){return null}Ha(e){return jf(this.persistence,new So,e.initialUser,this.serializer)}ja(e){return new Ur(To.ei,this.serializer)}za(e){return new Do}terminate(){return D(this,null,function*(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Qo=class extends Rl{constructor(t){super(),this.cacheSizeBytes=t}Ja(t,e){W(this.persistence.referenceDelegate instanceof qr);let r=this.persistence.referenceDelegate.garbageCollector;return new co(r,t.asyncQueue,e)}ja(t){let e=this.cacheSizeBytes!==void 0?Tt.withCacheSize(this.cacheSizeBytes):Tt.DEFAULT;return new Ur(r=>qr.ei(r,e),this.serializer)}};var Tm=(()=>{class n{initialize(e,r){return D(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Rc(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=vm.bind(null,this.syncEngine),yield am(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Uo}()}createDatastore(e){let r=hi(e.databaseInfo.databaseId),i=function(a){return new Vo(a)}(e.databaseInfo);return function(a,l,h,f){return new Oo(a,l,h,f)}(e.authCredentials,e.appCheckCredentials,i,r)}createRemoteStore(e){return function(i,o,a,l,h){return new Fo(i,o,a,l,h)}(this.localStore,this.datastore,e.asyncQueue,r=>Rc(this.syncEngine,r,0),function(){return jr.p()?new jr:new Co}())}createSyncEngine(e,r){return function(o,a,l,h,f,m,I){let A=new $o(o,a,l,h,f,m);return I&&(A.$a=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return D(this,null,function*(){var e,r;yield function(o){return D(this,null,function*(){let a=L(o);k("RemoteStore","RemoteStore shutting down."),a.k_.add(5),yield Qn(a),a.Q_.shutdown(),a.K_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var Yr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Xa(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Xa(this.observer.error,t):$t("Uncaught Error in snapshot listener:",t.toString()))}eu(){this.muted=!0}Xa(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Wo=class{constructor(t,e,r,i,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=at.UNAUTHENTICATED,this.clientId=Rr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>D(this,null,function*(){k("FirestoreClient","Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(k("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new bt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=mi(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function vs(n,t){return D(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(i=>D(this,null,function*(){r.isEqual(i)||(yield hl(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function Dc(n,t){return D(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield Pl(n);k("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>Ac(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Ac(t.remoteStore,i)),n._onlineComponents=t})}function Pl(n){return D(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k("FirestoreClient","Using user provided OfflineComponentProvider");try{yield vs(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(i){return i.name==="FirebaseError"?i.code===S.FAILED_PRECONDITION||i.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;Le("Error using user provided cache. Falling back to memory cache: "+e),yield vs(n,new Rl)}}else k("FirestoreClient","Using default OfflineComponentProvider"),yield vs(n,new Qo(void 0));return n._offlineComponents})}function Dl(n){return D(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(k("FirestoreClient","Using user provided OnlineComponentProvider"),yield Dc(n,n._uninitializedComponentsProvider._online)):(k("FirestoreClient","Using default OnlineComponentProvider"),yield Dc(n,new Tm))),n._onlineComponents})}function Am(n){return Pl(n).then(t=>t.localStore)}function bm(n){return Dl(n).then(t=>t.syncEngine)}function Cl(n){return D(this,null,function*(){let t=yield Dl(n),e=t.eventManager;return e.onListen=lm.bind(null,t.syncEngine),e.onUnlisten=fm.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=hm.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=mm.bind(null,t.syncEngine),e})}function Sm(n,t){let e=new bt;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,o,a){return D(this,null,function*(){try{let l=yield function(f,m){let I=L(f);return I.persistence.runTransaction("read document","readonly",A=>I.localDocuments.getDocument(A,m))}(i,o);l.isFoundDocument()?a.resolve(l):l.isNoDocument()?a.resolve(null):a.reject(new N(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){let h=mi(l,`Failed to get document '${o} from cache`);a.reject(h)}})}(yield Am(n),t,e)})),e.promise}function Rm(n,t,e={}){let r=new bt;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(o,a,l,h,f){let m=new Yr({next:A=>{m.eu(),a.enqueueAndForget(()=>vl(o,I));let R=A.docs.has(l);!R&&A.fromCache?f.reject(new N(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&A.fromCache&&h&&h.source==="server"?f.reject(new N(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(A)},error:A=>f.reject(A)}),I=new Hr(la(l.path),m,{includeMetadataChanges:!0,ua:!0});return wl(o,I)}(yield Cl(n),n.asyncQueue,t,e,r)})),r.promise}function Pm(n,t,e={}){let r=new bt;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(o,a,l,h,f){let m=new Yr({next:A=>{m.eu(),a.enqueueAndForget(()=>vl(o,I)),A.fromCache&&h.source==="server"?f.reject(new N(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(A)},error:A=>f.reject(A)}),I=new Hr(l,m,{includeMetadataChanges:!0,ua:!0});return wl(o,I)}(yield Cl(n),n.asyncQueue,t,e,r)})),r.promise}function xl(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Cc=new Map;function Vl(n,t,e){if(!e)throw new N(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Dm(n,t,e,r){if(t===!0&&r===!0)throw new N(S.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function xc(n){if(!M.isDocumentKey(n))throw new N(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Vc(n){if(M.isDocumentKey(n))throw new N(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function pi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":F()}function Mt(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new N(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=pi(n);throw new N(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}var Zr=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new N(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new N(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Dm("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xl((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},He=class{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Zr({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new N(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Zr(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Es;switch(r.type){case"firstParty":return new bs(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new N(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return D(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Cc.get(e);r&&(k("ComponentProvider","Removing Datastore"),Cc.delete(e),r.terminate())}(this),Promise.resolve()}};function Cm(n,t,e,r={}){var i;let o=(n=Mt(n,He))._getSettings(),a=`${t}:${e}`;if(o.host!=="firestore.googleapis.com"&&o.host!==a&&Le("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let l,h;if(typeof r.mockUserToken=="string")l=r.mockUserToken,h=at.MOCK_USER;else{l=Vu(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new N(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new at(f)}n._authCredentials=new Is(new Sr(l,h))}}var Je=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},yt=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ie(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},ie=class n extends Je{constructor(t,e,r){super(t,e,la(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new yt(this.firestore,null,new M(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function gi(n,t,...e){if(n=Dt(n),Vl("collection","path",t),n instanceof He){let r=Z.fromString(t,...e);return Vc(r),new ie(n,null,r)}{if(!(n instanceof yt||n instanceof ie))throw new N(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Z.fromString(t,...e));return Vc(r),new ie(n.firestore,null,r)}}function _i(n,t,...e){if(n=Dt(n),arguments.length===1&&(t=Rr.newId()),Vl("doc","path",t),n instanceof He){let r=Z.fromString(t,...e);return xc(r),new yt(n,null,new M(r))}{if(!(n instanceof yt||n instanceof ie))throw new N(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Z.fromString(t,...e));return xc(r),new yt(n.firestore,n instanceof ie?n.converter:null,new M(r))}}var ti=class{constructor(t=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new Gr(this,"async_queue_retry"),this.fu=()=>{let r=ws();r&&k("AsyncQueue","Visibility state changed to "+r.visibilityState),this.r_.Jo()},this.gu=t;let e=ws();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.yu(t)}enterRestrictedMode(t){if(!this.du){this.du=!0,this.Vu=t||!1;let e=ws();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.fu)}}enqueue(t){if(this.pu(),this.du)return new Promise(()=>{});let e=new bt;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Iu.push(t),this.wu()))}wu(){return D(this,null,function*(){if(this.Iu.length!==0){try{yield this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(t){if(!en(t))throw t;k("AsyncQueue","Operation failed with retryable error: "+t)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}})}yu(t){let e=this.gu.then(()=>(this.Ru=!0,t().catch(r=>{this.Au=r,this.Ru=!1;let i=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw $t("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Ru=!1,r))));return this.gu=e,e}enqueueAfterDelay(t,e,r){this.pu(),this.mu.indexOf(t)>-1&&(e=0);let i=Lo.createAndSchedule(this,t,e,r,o=>this.Su(o));return this.Eu.push(i),i}pu(){this.Au&&F()}verifyOperationInProgress(){}bu(){return D(this,null,function*(){let t;do t=this.gu,yield t;while(t!==this.gu)})}Du(t){for(let e of this.Eu)if(e.timerId===t)return!0;return!1}vu(t){return this.bu().then(()=>{this.Eu.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.Eu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.bu()})}Cu(t){this.mu.push(t)}Su(t){let e=this.Eu.indexOf(t);this.Eu.splice(e,1)}};var ue=class extends He{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=new ti,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return D(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new ti(t),this._firestoreClient=void 0,yield t}})}};function Nl(n,t){let e=typeof n=="object"?n:Hu(),r=typeof n=="string"?n:t||"(default)",i=Qu(e,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=xu("firestore");o&&Cm(i,...o)}return i}function yi(n){if(n._terminated)throw new N(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||xm(n),n._firestoreClient}function xm(n){var t,e,r;let i=n._freezeSettings(),o=function(l,h,f,m){return new Cs(l,h,f,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,xl(m.experimentalLongPollingOptions),m.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Wo(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(l){let h=l?._online.build();return{_offline:l?._offline.build(h),_online:h}}(n._componentsProvider))}var qn=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(pt.fromBase64String(t))}catch(e){throw new N(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Xe=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new N(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Et(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Ye=class{constructor(t){this._methodName=t}};var zn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new N(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new N(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}};var jn=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,t._values)}};var Vm=/^__.*__$/,Ho=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Ot(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ie(t,this.data,e,this.fieldTransforms)}},ei=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Ot(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function kl(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F()}}var ni=class n{constructor(t,e,r,i,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Fu(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:r,Nu:!1});return i.Bu(t),i}Lu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:r,Nu:!1});return i.Fu(),i}ku(t){return this.xu({path:void 0,Nu:!0})}qu(t){return ii(t,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Fu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Bu(this.path.get(t))}Bu(t){if(t.length===0)throw this.qu("Document fields must not be empty");if(kl(this.Mu)&&Vm.test(t))throw this.qu('Document fields cannot begin and end with "__"')}},Jo=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||hi(t)}$u(t,e,r,i=!1){return new ni({Mu:t,methodName:e,Ku:r,path:Et.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function wa(n){let t=n._freezeSettings(),e=hi(n._databaseId);return new Jo(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Nm(n,t,e,r,i,o={}){let a=n.$u(o.merge||o.mergeFields?2:0,t,e,i);va("Data must be an object, but it was:",a,r);let l=Ol(r,a),h,f;if(o.merge)h=new At(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){let m=[];for(let I of o.mergeFields){let A=Yo(t,I,e);if(!a.contains(A))throw new N(S.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);Fl(m,A)||m.push(A)}h=new At(m),f=a.fieldTransforms.filter(I=>h.covers(I.field))}else h=null,f=a.fieldTransforms;return new Ho(new vt(l),h,f)}var ri=class n extends Ye{_toFieldTransform(t){if(t.Mu!==2)throw t.Mu===1?t.qu(`${this._methodName}() can only appear at the top level of your update data`):t.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function km(n,t,e){return new ni({Mu:3,Ku:t.settings.Ku,methodName:n._methodName,Nu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Xo=class n extends Ye{constructor(t,e){super(t),this.Uu=e}_toFieldTransform(t){let e=km(this,t,!0),r=this.Uu.map(o=>rn(o,e)),i=new oe(r);return new $s(t.path,i)}isEqual(t){return t instanceof n&&Pe(this.Uu,t.Uu)}};function Om(n,t,e,r){let i=n.$u(1,t,e);va("Data must be an object, but it was:",i,r);let o=[],a=vt.empty();ce(r,(h,f)=>{let m=Ea(t,h,e);f=Dt(f);let I=i.Lu(m);if(f instanceof ri)o.push(m);else{let A=rn(f,I);A!=null&&(o.push(m),a.set(m,A))}});let l=new At(o);return new ei(a,l,i.fieldTransforms)}function Mm(n,t,e,r,i,o){let a=n.$u(1,t,e),l=[Yo(t,r,e)],h=[i];if(o.length%2!=0)throw new N(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let A=0;A<o.length;A+=2)l.push(Yo(t,o[A])),h.push(o[A+1]);let f=[],m=vt.empty();for(let A=l.length-1;A>=0;--A)if(!Fl(f,l[A])){let R=l[A],V=h[A];V=Dt(V);let O=a.Lu(R);if(V instanceof ri)f.push(R);else{let x=rn(V,O);x!=null&&(f.push(R),m.set(R,x))}}let I=new At(f);return new ei(m,I,a.fieldTransforms)}function Fm(n,t,e,r=!1){return rn(e,n.$u(r?4:3,t))}function rn(n,t){if(Ml(n=Dt(n)))return va("Unsupported field value:",t,n),Ol(n,t);if(n instanceof Ye)return function(r,i){if(!kl(i.Mu))throw i.qu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Nu&&t.Mu!==4)throw t.qu("Nested arrays are not supported");return function(r,i){let o=[],a=0;for(let l of r){let h=rn(l,i.ku(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,t)}return function(r,i){if((r=Dt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return gf(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=ot.fromDate(r);return{timestampValue:Lr(i.serializer,o)}}if(r instanceof ot){let o=new ot(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Lr(i.serializer,o)}}if(r instanceof zn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof qn)return{bytesValue:il(i.serializer,r._byteString)};if(r instanceof yt){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.qu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:da(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof jn)return function(a,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw l.qu("VectorValues must only contain numeric values.");return ha(l.serializer,h)})}}}}}}(r,i);throw i.qu(`Unsupported field value: ${pi(r)}`)}(n,t)}function Ol(n,t){let e={};return Oc(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ce(n,(r,i)=>{let o=rn(i,t.Ou(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function Ml(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ot||n instanceof zn||n instanceof qn||n instanceof yt||n instanceof Ye||n instanceof jn)}function va(n,t,e){if(!Ml(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let r=pi(e);throw r==="an object"?t.qu(n+" a custom object"):t.qu(n+" "+r)}}function Yo(n,t,e){if((t=Dt(t))instanceof Xe)return t._internalPath;if(typeof t=="string")return Ea(n,t);throw ii("Field path arguments must be of type string or ",n,!1,void 0,e)}var Lm=new RegExp("[~\\*/\\[\\]]");function Ea(n,t,e){if(t.search(Lm)>=0)throw ii(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Xe(...t.split("."))._internalPath}catch{throw ii(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function ii(n,t,e,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new N(S.INVALID_ARGUMENT,l+n+h)}function Fl(n,t){return n.some(e=>e.isEqual(t))}var si=class{constructor(t,e,r,i,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Zo(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Ia("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Zo=class extends si{data(){return super.data()}};function Ia(n,t){return typeof t=="string"?Ea(n,t):t instanceof Xe?t._internalPath:t._delegate._internalPath}function Bm(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Gn=class{},ta=class extends Gn{};function Ll(n,t,...e){let r=[];t instanceof Gn&&r.push(t),r=r.concat(e),function(o){let a=o.filter(h=>h instanceof ea).length,l=o.filter(h=>h instanceof oi).length;if(a>1||a>0&&l>0)throw new N(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var oi=class n extends ta{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return Ul(t._query,e),new Je(t.firestore,t.converter,js(t._query,e))}_parse(t){let e=wa(t.firestore);return function(o,a,l,h,f,m,I){let A;if(f.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new N(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){kc(I,m);let R=[];for(let V of I)R.push(Nc(h,o,V));A={arrayValue:{values:R}}}else A=Nc(h,o,I)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||kc(I,m),A=Fm(l,a,I,m==="in"||m==="not-in");return st.create(f,m,A)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Bl(n,t,e){let r=t,i=Ia("where",n);return oi._create(i,r,e)}var ea=class n extends Gn{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:Pt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,o){let a=i,l=o.getFlattenedFilters();for(let h of l)Ul(a,h),a=js(a,h)}(t._query,e),new Je(t.firestore,t.converter,js(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function Nc(n,t,e){if(typeof(e=Dt(e))=="string"){if(e==="")throw new N(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gc(t)&&e.indexOf("/")!==-1)throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(Z.fromString(e));if(!M.isDocumentKey(r))throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return sc(n,new M(r))}if(e instanceof yt)return sc(n,e._key);throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${pi(e)}.`)}function kc(n,t){if(!Array.isArray(n)||n.length===0)throw new N(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ul(n,t){let e=function(i,o){for(let a of i)for(let l of a.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new N(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new N(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var na=class{convertValue(t,e="none"){switch(se(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Y(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Qt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return ce(t,(i,o)=>{r[i]=this.convertValue(o,e)}),r}convertVectorValue(t){var e,r,i;let o=(i=(r=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>Y(a.doubleValue));return new jn(o)}convertGeoPoint(t){return new zn(Y(t.latitude),Y(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=ui(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(On(t));default:return null}}convertTimestamp(t){let e=Kt(t);return new ot(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=Z.fromString(t);W(ll(r));let i=new xr(r.get(1),r.get(3)),o=new M(r.popFirst(5));return i.isEqual(e)||$t(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function Um(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var ne=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},$n=class extends si{constructor(t,e,r,i,o,a){super(t,e,r,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Fe(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(Ia("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},Fe=class extends $n{data(t={}){return super.data(t)}},ra=class{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new ne(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Fe(this._firestore,this._userDataWriter,r.key,r,new ne(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new N(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{let h=new Fe(i._firestore,i._userDataWriter,l.doc.key,l.doc,new ne(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let h=new Fe(i._firestore,i._userDataWriter,l.doc.key,l.doc,new ne(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter),f=-1,m=-1;return l.type!==0&&(f=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),m=a.indexOf(l.doc.key)),{type:qm(l.type),doc:h,oldIndex:f,newIndex:m}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function qm(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F()}}function ql(n){n=Mt(n,yt);let t=Mt(n.firestore,ue);return Rm(yi(t),n._key).then(e=>zm(t,n,e))}var Kn=class extends na{constructor(t){super(),this.firestore=t}convertBytes(t){return new qn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new yt(this.firestore,null,e)}};function zl(n){n=Mt(n,yt);let t=Mt(n.firestore,ue),e=yi(t),r=new Kn(t);return Sm(e,n._key).then(i=>new $n(t,r,n._key,i,new ne(i!==null&&i.hasLocalMutations,!0),n.converter))}function Ta(n){n=Mt(n,Je);let t=Mt(n.firestore,ue),e=yi(t),r=new Kn(t);return Bm(n._query),Pm(e,n._query).then(i=>new ra(t,r,n,i))}function jl(n,t,e,...r){n=Mt(n,yt);let i=Mt(n.firestore,ue),o=wa(i),a;return a=typeof(t=Dt(t))=="string"||t instanceof Xe?Mm(o,"updateDoc",n._key,t,e,r):Om(o,"updateDoc",n._key,t),$l(i,[a.toMutation(n._key,re.exists(!0))])}function Gl(n,t){let e=Mt(n.firestore,ue),r=_i(n),i=Um(n.converter,t);return $l(e,[Nm(wa(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,re.exists(!1))]).then(()=>r)}function $l(n,t){return function(r,i){let o=new bt;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return pm(yield bm(r),i,o)})),o.promise}(yi(n),t)}function zm(n,t,e){let r=e.docs.get(t._key),i=new Kn(n);return new $n(n,i,t._key,r,new ne(e.hasPendingWrites,e.fromCache),t.converter)}function Kl(...n){return new Xo("arrayUnion",n)}(function(t,e=!0){(function(i){Ze=i})(Wu),Sn(new qt("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),l=new ue(new Ts(r.getProvider("auth-internal")),new Rs(r.getProvider("app-check-internal")),function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new N(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xr(f.options.projectId,m)}(a,i),a);return o=Object.assign({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),ee(tc,"4.7.6",t),ee(tc,"4.7.6","esm2017")})();var jm="firebase",Gm="11.2.0";ee(jm,Gm,"app");var Ql={apiKey:"AIzaSyAVJIMz4fZa52bhaEviW9KZDe0T0FyrvoM",authDomain:"mks-coaching.firebaseapp.com",projectId:"mks-coaching",storageBucket:"mks-coaching.firebasestorage.app",messagingSenderId:"473942184193",appId:"1:473942184193:web:3bcabc4621d1c2058a0b00"};var wi=class{poid;createdAt;constructor(t,e){this.poid=t,this.createdAt=e}toString(){let t="{";return t+=`poid: ${this.poid},`,t+=`createdAt: ${this.createdAt.toString()}`,t+"}"}toJson(){return{unPoid:this.poid,createdAt:this.createdAt}}};var le=class n{docId;nom;prenom;email;age;createdAt;poids;role;static construct(){return new n("","","","",0,new ot(0,0),new Array,"client")}constructor(t,e,r,i,o,a,l,h){this.docId=t,this.nom=e,this.prenom=r,this.email=i,this.age=o,this.createdAt=a,this.poids=[],l.forEach(f=>{this.poids.push(new wi(f.unPoid,f.createdAt))}),this.role=h}toString(){return`User: ${this.nom} ${this.prenom} (${this.email}), \xC2ge: ${this.age}, Cr\xE9\xE9 le: ${this.createdAt.toDate().toLocaleDateString()}. Mesures : [${this.poids.toString()}]`}toJSON(){let t;t=Array.from(this.poids,r=>r.toJson());let e;return e={nom:this.nom,prenom:this.prenom,email:this.email,age:this.age,pseudo:"",createdAt:this.createdAt,role:"client",poids:t},e}};var Wl=class n{static prefix="UserService:";static app=ls(Ql);static db=Nl(n.app);constructor(){}static getUserDocIdFromUID(t){return D(this,null,function*(){let e=Ll(gi(n.db,"user"),Bl("UID","==",t)),r=yield Ta(e);if(r.empty)throw new Error(`getUserDocIdFromUID(${t})`);{let i=r.docs.at(0);return Promise.resolve(new le(i.id,i.data().nom,i.data().prenom,i.data().email,i.data().age,i.data().createdAt,i.data().poids,i.data().role))}})}static createUser(t){return D(this,null,function*(){return yield Gl(gi(this.db,"user"),t.toJSON())})}static getUsers(){return D(this,null,function*(){let t=yield Ta(gi(n.db,"user")),e=[];t.forEach(i=>{e.push(new le(i.id,i.get("nom"),i.get("prenom"),i.get("email"),i.get("age"),i.get("createdAt"),i.get("poids"),i.get("role")))});let r=Array.from(t.docs,i=>new le(i.id,i.get("nom"),i.get("prenom"),i.get("email"),i.get("age"),i.get("createdAt"),i.get("poids"),i.get("role"))).filter(i=>i.role==="client");return Promise.resolve(r)})}static searchMyUserByDocId(t){return D(this,null,function*(){console.log("Service getDetails()");let e=_i(n.db,"user",t);try{console.log("is data cached ?");let r=yield zl(e);return console.log("data is cached !"),new le(r.id,r.data().nom,r.data().prenom,r.data().email,r.data().age,r.data().createdAt,r.data().poids,r.data().role)}catch{console.log("errror getting cached document, dw, expected behavior, it means data was not cached"),console.log("retrieving Document data from server");let i=yield ql(e);if(i.exists())return console.log("found it"),new le(i.id,i.data().nom,i.data().prenom,i.data().email,i.data().age,i.data().createdAt,i.data().poids,i.data().role);throw new Error("No such document! userId did not match any documents in the database")}})}static addMesure(t,e){return D(this,null,function*(){let r=_i(n.db,"user",t);yield jl(r,{poids:Kl(e.toJson())}).then(()=>{console.log(`UserService: user ${t} updated`)})})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=Ru({token:n,factory:n.\u0275fac,providedIn:"root"})};export{xh as a,Mh as b,$m as c,mr as d,Km as e,Qm as f,Wm as g,Hm as h,Jm as i,Ut as j,bn as k,Xm as l,Pe as m,Ym as n,Zm as o,tp as p,ep as q,Dt as r,qt as s,z as t,De as u,Sn as v,Qu as w,Ep as x,Wu as y,ls as z,Hu as A,ee as B,ot as C,gi as D,Nl as E,Ta as F,Ql as G,wi as H,le as I,Wl as J};
